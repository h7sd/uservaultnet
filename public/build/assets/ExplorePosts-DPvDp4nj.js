import{k as A,l as T,_ as E,d as N,c as a,a as e,e as u,w as l,r as o,W as R,F as f,g as M,b as h,h as G,G as V,o as s,p as y,t as k,i as C,m as b,j as g}from"./global.properties-ieI6Xwik.js";import{u as q}from"./index-Dl0ZWYHh.js";import{A as j,T as D,S as W}from"./AdGridItem-DIuPUQRu.js";import{F as z}from"./FollowRecommendationList-BYFEBsjn.js";import{T as H}from"./TimelinePublication-Cg7erd3h.js";import{T as J}from"./TimelinePublicationSkeleton-BKOwceKg.js";import{F as K}from"./FluidEmptyState-5rqvt3kR.js";import{p as O}from"./application-DnsIlr-S.js";import{T as Q}from"./TabsLink-BPZzEP7Z.js";import{T as X}from"./TimelineCallout-Bqj_2KBQ.js";import{S as Y}from"./ScrollTopButton-g6R9lYqi.js";import{F as Z}from"./FeedUpdate-BDou7I4a.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./TranslationService-ew0KueNY.js";import"./swiper-element-bundle-DBu82uhE.js";import"./ViewsCounter-7KyRmWQv.js";import"./PublicationQuote-1qpVpjjc.js";import"./AvatarExtraSmall-CzXHXk-G.js";import"./ProgressiveImageLoader-DUluSfqC.js";import"./SpinnerIcon-D3U9frcO.js";import"./VideoDurationTime-CY2-hNg2.js";import"./inbox.store-DKf8FrGP.js";import"./index-CaocF3Et.js";const tt=A("explore_posts_store",{state:function(){return{updateAttempts:0,posts:[],update:[],filter:{page:1}}},actions:{updateFeed:async function(){await T().explore().params({filter:{onset:this.posts.at(0).id}}).sendTo("posts").then(t=>{this.update=t.data.data}).catch(t=>{t.response&&(state.update=[])})},applyUpdate:function(){this.update.forEach(t=>{this.posts.slice(0,this.update.length).some(r=>r.id===t.id)||this.posts.unshift(t)}),this.update=[]},makeLoadRequest:async function(){return await T().explore().with({filter:this.filter}).sendTo("posts")},fetchPosts:async function(){await this.makeLoadRequest().then(t=>{this.posts=t.data.data})},loadMorePosts:async function(){return await this.makeLoadRequest().then(t=>{let n=t.data.data;return n.length?(this.posts=this.posts.concat(n),!0):!1}).catch(()=>!1)},getLastPostId:function(){return this.posts.at(-1).id},resetFilter:function(){this.filter={page:1}}}}),et=N({setup:function(){const t=M({isLoading:!0,isLoadingContent:!1,noMoreContent:!1,isUpdating:!1});let n=null,r=0;const i=tt(),d=h(()=>i.update),c=h(()=>i.posts);return q({callback:async()=>{!t.isLoadingContent&&!t.noMoreContent&&(t.isLoadingContent=!0,i.filter.page+=1,t.noMoreContent=!await i.loadMorePosts(),t.isLoadingContent=!1)}}),G(async()=>{t.isLoading=!0,i.resetFilter(),await i.fetchPosts(),t.isLoading=!1,c.value.length&&(n=setInterval(async()=>{t.isUpdating||(d.value.length==0&&r>10?clearInterval(n):(t.isUpdating=!0,await i.updateFeed(),t.isUpdating=!1,r++))},60*1e3*10))}),V(()=>{n&&clearInterval(n)}),{state:t,posts:c,newPosts:d,applyNewPosts:()=>{i.applyUpdate()}}},components:{SidedContentLayout:W,TimelineContainer:D,FollowRecommendationList:z,AdGridItem:j,TimelinePublication:H,FluidEmptyState:K,TimelinePublicationSkeleton:J,ContentTabs:O,TabsLink:Q,TimelineCallout:X,ScrollTopButton:Y,FeedUpdate:Z}}),ot={key:0,class:"block"},nt={key:1,class:"block"},st={key:1},it={key:2},at={key:3};function lt(t,n,r,i,d,c){const _=o("TabsLink"),L=o("ContentTabs"),m=o("Border"),P=o("TimelineCallout"),S=o("TimelinePublicationSkeleton"),F=o("FeedUpdate"),w=o("TimelinePublication"),v=o("FluidEmptyState"),I=o("TimelineContainer"),U=o("FollowRecommendationList"),B=o("AdGridItem"),x=o("SidedContentLayout"),$=o("ScrollTopButton");return s(),a(f,null,[e(x,null,{content:l(()=>[e(I,null,{default:l(()=>[e(L,{cols:2},{default:l(()=>[e(_,{link:{name:"explore_posts"}},{default:l(()=>[y(k(t.$t("labels.explore")),1)]),_:1}),e(_,{link:{name:"explore_people"}},{default:l(()=>[y(k(t.$t("labels.people")),1)]),_:1})]),_:1}),e(m),e(P,{iconName:"star-04",iconType:"solid",title:t.$t("info.explore_posts.title"),desc:t.$t("info.explore_posts.desc")},null,8,["title","desc"]),e(m),t.state.isLoading?(s(),a("div",ot,[(s(),a(f,null,C(3,p=>e(S,{key:p})),64))])):(s(),a("div",nt,[t.newPosts.length?(s(),u(F,{key:0,posts:t.newPosts,onClick:t.applyNewPosts},null,8,["posts","onClick"])):b("",!0),t.posts.length?(s(),a("div",st,[(s(!0),a(f,null,C(t.posts,p=>(s(),u(w,{key:p.id,postData:p},null,8,["postData"]))),128))])):(s(),a("div",it,[e(v,{text:t.$t("empty_state.empty")},null,8,["text"])])),t.state.isLoadingContent?(s(),a("div",at,[e(m),n[0]||(n[0]=g("div",{class:"flex justify-center my-4"},[g("div",{class:"colibri-primary-animation"})],-1))])):b("",!0)]))]),_:1})]),sidebar:l(()=>[e(U),e(B)]),_:1}),(s(),u(R,{to:"body"},[e($)]))],64)}const Bt=E(et,[["render",lt]]);export{Bt as default};
