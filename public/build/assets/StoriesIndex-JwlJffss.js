import{k as g,e as d,c as i,d as a,s as u,i as w,p as y,v as h,j as O,r as D,M as V,o as M,w as Q,Z as F,z as T,E as q,t as I,l as v,F as C,f as P,P as U,x as Z,y as H,q as L,Q as J,b as A,D as K,G as z,R as W,H as X}from"./vendor-20TtR0Rd.js";import{r as Y}from"./swiper-element-bundle-DBu82uhE.js";import{a as j,j as x,i as ee,d as N,A as G,f as R}from"./application-C3zsOS77.js";import{_,b as l,d as te}from"./global.properties-DKM1fd6s.js";import oe from"./PrimarySpinAnimation-BR9KagKt.js";import ae from"./Name-Bo6CiLqw.js";import{S as se}from"./SheetTitle-CCLXWnJ3.js";import"./media-D4ZD3EDk.js";import"./editor-CpZ7vO5P.js";import"./SpinnerIcon-BFpWBik4.js";const ne=g({props:{lqipBase64:{type:String,required:!0}},components:{PrimarySpinAnimation:oe}}),re={class:"size-full relative"},ie=["src"],le={class:"shadow-xs absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 size-9 bg-white/50 backdrop-blur-2xl rounded-full inline-flex-center justify-center z-10"};function de(e,o,s,t,c,p){const n=d("PrimarySpinAnimation");return a(),i("div",re,[u("img",{class:"size-full object-cover",src:e.lqipBase64,alt:"Base64 LQIP"},null,8,ie),u("div",le,[w(n)])])}const E=_(ne,[["render",de]]),ue=g({props:{frameData:{type:Object,required:!0}},setup:function(e){const o=D(null),s=D(!0),t=D(e.frameData),c=V("playerState");M(()=>{localStorage.getItem("stories_videos_muted")?o.value.muted=!0:o.value.muted=!1,Q(()=>c.isPaused,()=>{r()}),l.on("story:unmute",n),l.on("story:mute",p)}),F(()=>{l.off("story:unmute",n),l.off("story:mute",p)});const p=()=>{o.value.muted=!0},n=()=>{o.value.muted=!1},r=()=>{c.isPaused?o.value.pause():o.value.play()};return{isLoading:s,frameData:t,storyVideo:o,onLoaded:()=>{s.value=!1,o.value.play(),l.emit("story:play")}}},components:{StoryMediaLoader:E}}),ce={class:"h-full w-full overflow-hidden"},pe=["src"];function me(e,o,s,t,c,p){const n=d("StoryMediaLoader");return a(),i("div",ce,[e.isLoading?(a(),y(n,{key:0,lqipBase64:e.frameData.media.lqip_base64},null,8,["lqipBase64"])):h("",!0),u("video",{class:O([[e.isLoading?"opacity-0":"opacity-100"],"w-full h-full object-cover"]),ref:"storyVideo","webkit-playsinline":"",muted:"",playsinline:"",onLoadedmetadata:o[0]||(o[0]=(...r)=>e.onLoaded&&e.onLoaded(...r)),onLoadeddata:o[1]||(o[1]=(...r)=>e.onLoaded&&e.onLoaded(...r))},[u("source",{src:e.frameData.media.source_url,type:"video/mp4"},null,8,pe)],34)])}const ye=_(ue,[["render",me]]),fe=g({props:{frameData:{type:Object,required:!0}},setup:function(e,o){const s=D(!0);return{isLoading:s,onLoaded:()=>{s.value=!1,l.emit("story:play")}}},components:{StoryMediaLoader:E}}),he={class:"h-full w-full overflow-hidden"},Se=["src"];function ve(e,o,s,t,c,p){const n=d("StoryMediaLoader");return a(),i("div",he,[T(w(n,{lqipBase64:e.frameData.media.lqip_base64},null,8,["lqipBase64"]),[[q,e.isLoading]]),T(u("img",{class:"w-full",src:e.frameData.media.source_url,onLoad:o[0]||(o[0]=(...r)=>e.onLoaded&&e.onLoaded(...r)),alt:"Image"},null,40,Se),[[q,!e.isLoading]])])}const we=_(fe,[["render",ve]]),_e=g({setup:function(){const e=V("playerState");return{playerState:e,showViews:()=>{l.emit("story:show-views")},storyViewsCount:v(()=>e.frameData.views_count),storyViews:v(()=>e.frameData.relations.views),hasViews:v(()=>e.frameData.views_count.raw>0)}},components:{PrimaryIconButton:j}}),$e={class:"inline-flex items-center flex-1 gap-1 opacity-70 hover:opacity-100"},ge={class:"text-par-s text-white/90"};function be(e,o,s,t,c,p){const n=d("PrimaryIconButton");return a(),i("div",{class:"px-4 cursor-pointer",onClick:o[0]||(o[0]=(...r)=>e.showViews&&e.showViews(...r))},[u("div",$e,[w(n,{iconName:"eye",buttonColor:"text-white",hoverText:"hover:text-white"}),u("span",ge,I(e.$t("story.views_number",{n:e.storyViewsCount.formatted},e.storyViewsCount.raw)),1)])])}const ke=_(_e,[["render",be]]),Ce=g({setup:function(){const e=V("playerState");return{hasContent:v(()=>e.frameData.content.length),storyContent:v(()=>e.frameData.content),showContent:()=>{l.emit("story:show-content")}}}}),De=["innerHTML"];function Ie(e,o,s,t,c,p){return e.hasContent?(a(),i("div",{key:0,class:"text-par-m text-white px-4 cursor-pointer mb-2",onClick:o[0]||(o[0]=(...n)=>e.showContent&&e.showContent(...n))},[u("span",{innerHTML:e.storyContent.substr(0,90)},null,8,De)])):h("",!0)}const Ve=_(Ce,[["render",Ie]]),Me=g({props:{storyData:{type:Object,required:!0}}}),Pe={class:"flex gap-1 mb-3 overflow-hidden"},Le={key:0,class:"h-full bg-white w-full"},Ae={key:2,class:"h-full bg-white w-0"};function Be(e,o,s,t,c,p){return a(),i("div",Pe,[(a(!0),i(C,null,P(e.storyData.relations.frames,(n,r)=>(a(),i("div",{class:"h-0.5 bg-white/60 flex-1 min-w-1",key:r},[n.playable.played?(a(),i("div",Le)):n.playable.playing?(a(),i("div",{key:1,class:"h-full bg-white",style:U({width:`${n.playable.progress}%`})},null,4)):(a(),i("div",Ae))]))),128))])}const ze=_(Me,[["render",Be]]),Ne=g({emits:["pause","play"],setup:function(e,o){const s=A({isMuted:!1,mainMenu:te()}),t=V("playerState");M(()=>{localStorage.getItem("stories_videos_muted")&&(s.isMuted=!0)});const c=()=>{o.emit("pause")},p=()=>{o.emit("play")};return{state:s,playerState:t,storyAuthor:v(()=>t.storyAuthor),isVideo:v(()=>t.frameData.type=="video"),pause:c,play:p,toggleVideosVolume:()=>{localStorage.getItem("stories_videos_muted")?(localStorage.removeItem("stories_videos_muted"),s.isMuted=!1,l.emit("story:unmute")):(localStorage.setItem("stories_videos_muted",1),s.isMuted=!0,l.emit("story:mute"))},deleteStory:()=>{l.emit("story:delete",t.frameData.id)},showViews:()=>{l.emit("story:show-views")},openMenu:()=>{s.mainMenu.open(),c()},canReport:v(()=>t.permissions.can_report),canHide:v(()=>t.permissions.can_hide),canDelete:v(()=>t.permissions.can_delete),canSeeViews:v(()=>t.isOwner),leaveStories:()=>{l.emit("story:leave")}}},components:{PrimaryIconButton:j,AvatarSmall:G,ActionSheet:N,ActionSheetItem:ee,ActionSheetGroup:x}}),Te={class:"flex items-center gap-1"},qe={class:"flex gap-2 items-center overflow-hidden flex-1"},He={class:"shrink-0"},Oe={class:"flex-1 overflow-hidden leading-none truncate"},Fe={class:"text-par-n font-medium text-white mb-0.5"},je={class:"text-cap-l text-white ml-1 opacity-80"},xe={class:"inline-flex gap-1 items-center"};function Ge(e,o,s,t,c,p){const n=d("PrimaryIconButton"),r=d("AvatarSmall"),S=d("VerificationBadge"),m=d("ActionSheetItem"),$=d("ActionSheetGroup"),f=d("ActionSheet");return a(),i(C,null,[u("div",Te,[w(n,{onClick:e.leaveStories,iconName:"chevron-left",iconSize:"7",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"]),u("div",qe,[u("div",He,[w(r,{avatarSrc:e.storyAuthor.avatar_url},null,8,["avatarSrc"])]),u("div",Oe,[u("span",Fe,[Z(I(e.storyAuthor.name)+" ",1),e.storyAuthor.verified?(a(),y(S,{key:0,size:"xs"})):h("",!0)]),u("span",je,I(e.playerState.frameData.date.time_ago??""),1)])]),u("div",xe,[e.playerState.isPaused?(a(),y(n,{key:0,onClick:e.play,iconName:"play",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])):h("",!0),e.isVideo?(a(),i(C,{key:1},[e.state.isMuted?(a(),y(n,{key:0,onClick:e.toggleVideosVolume,iconName:"volume-x",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])):(a(),y(n,{key:1,onClick:e.toggleVideosVolume,iconName:"volume-max",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"]))],64)):h("",!0),w(n,{onClick:H(e.openMenu,["stop"]),iconName:"dots-horizontal",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])])]),(a(),y(J,{to:"body"},[e.state.mainMenu.status?(a(),y(f,{key:0,isMuted:!0,onClose:e.state.mainMenu.close},{default:L(()=>[u("div",{onClick:o[0]||(o[0]=H((...b)=>e.state.mainMenu.close&&e.state.mainMenu.close(...b),["stop"]))},[w($,null,{default:L(()=>[e.canDelete?(a(),y(m,{key:0,onClick:e.deleteStory,itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.story.delete_story")},null,8,["onClick","textLabel"])):h("",!0),e.canSeeViews?(a(),y(m,{key:1,onClick:e.showViews,iconName:"eye",textLabel:e.$t("dd.story.show_views")},null,8,["onClick","textLabel"])):h("",!0),e.canHide?(a(),y(m,{key:2,onClick:e.$comingSoon,iconName:"eye-off",textLabel:e.$t("dd.story.hide_stories",{name:e.storyAuthor.name})},null,8,["onClick","textLabel"])):h("",!0),e.canReport?(a(),y(m,{key:3,onClick:e.$comingSoon,itemColor:"text-red-900",iconName:"annotation-alert",textLabel:e.$t("dd.story.report_story")},null,8,["onClick","textLabel"])):h("",!0)]),_:1})])]),_:1},8,["onClose"])):h("",!0)]))],64)}const Re=_(Ne,[["render",Ge]]),Ee=g({props:{viewItem:{type:Object,required:!0}},components:{AvatarSmall:G,Name:ae}}),Qe={class:"px-4 py-2 relative after:content-[''] after:absolute after:bottom-0 after:left-16 after:right-0 after:border-b after:border-bord-pr last:after:border-none"},Ue={class:"flex items-center"},Ze={class:"flex items-center gap-2.5"},Je={class:"shrink-0"},Ke={class:"text-lab-sc text-par-n ml-auto lowercase"},We={class:"text-lab-sc text-par-n w-12 text-right"};function Xe(e,o,s,t,c,p){const n=d("AvatarSmall"),r=d("Name");return a(),i("div",Qe,[u("div",Ue,[u("div",Ze,[u("div",Je,[w(n,{avatarSrc:e.viewItem.relations.user.avatar_url},null,8,["avatarSrc"])]),w(r,{name:e.viewItem.relations.user.name,isVerified:e.viewItem.relations.user.verified||!0},null,8,["name","isVerified"])]),u("span",Ke,I(e.viewItem.date.is_today?e.$t("labels.today"):e.$t("labels.yesterday")),1),u("span",We,I(e.viewItem.date.time),1)])])}const Ye=_(Ee,[["render",Xe]]),et={},tt={class:"px-4 py-2"};function ot(e,o){return a(),i("div",tt,o[0]||(o[0]=[K('<div class="flex items-center"><div class="shrink-0"><span class="skeleton-circle size-8"></span></div><span class="skeleton h-3 w-20 ml-2"></span><span class="skeleton h-3 w-6 ml-auto"></span></div>',1)]))}const at=_(et,[["render",ot]]),st=g({emits:["hide"],setup:function(){const e=R(),o=V("playerState"),s=A({isLoading:!0}),t=D([]);return M(async()=>{t.value=await e.fetchAndReturnStoryViews(o.frameData.id),s.isLoading=!1}),{state:s,views:t}},components:{ViewItemSkeleton:at,ViewItem:Ye,ActionSheet:N,ActionSheetGroup:x,SheetTitle:se}}),nt={class:"pb-2 px-4"},rt={key:0,class:"block"},it={key:1,class:"block max-h-80 overflow-y-auto"},lt={key:1,class:"py-16"},dt={class:"text-lab-pr2 text-par-s text-center"};function ut(e,o,s,t,c,p){const n=d("SheetTitle"),r=d("Border"),S=d("ViewItemSkeleton"),m=d("ViewItem"),$=d("ActionSheet");return a(),y($,{onClose:o[0]||(o[0]=f=>e.$emit("hide"))},{default:L(()=>[u("div",nt,[w(n,{title:`${e.$t("story.who_watched_story")} ${e.views.length}`},null,8,["title"])]),w(r),e.state.isLoading?(a(),i("div",rt,[(a(),i(C,null,P(5,f=>w(S,{key:f})),64))])):(a(),i("div",it,[e.views.length?(a(!0),i(C,{key:0},P(e.views,f=>(a(),y(m,{viewItem:f,key:f.id},null,8,["viewItem"]))),128)):(a(),i("div",lt,[u("p",dt,I(e.$t("story.no_view_yet")),1)]))]))]),_:1})}const ct=_(st,[["render",ut]]),pt=g({emits:["hide"],setup:function(){const e=V("playerState");return{storyContent:v(()=>e.frameData.content)}},components:{ActionSheet:N}}),mt={class:"px-4 max-h-80 overflow-y-auto pb-4"},yt=["innerHTML"];function ft(e,o,s,t,c,p){const n=d("ActionSheet");return a(),y(n,{onClose:o[0]||(o[0]=r=>e.$emit("hide"))},{default:L(()=>[u("div",mt,[u("p",{class:"text-par-m text-lab-pr markdown-text",innerHTML:e.$mdInline(e.storyContent)},null,8,yt)])]),_:1})}const ht=_(pt,[["render",ft]]),St=g({setup:function(){const e=A({isContentModalOpen:!1,isViewsModalOpen:!1}),o=()=>{e.isContentModalOpen=!0,l.emit("story:pause")},s=()=>{e.isViewsModalOpen=!0,l.emit("story:pause")};return M(()=>{l.on("story:show-content",o),l.on("story:show-views",s)}),z(()=>{l.off("story:show-content",o),l.off("story:show-views",s)}),{state:e,handleHideContent:()=>{e.isContentModalOpen=!1,l.emit("story:play")},handleHideViews:()=>{e.isViewsModalOpen=!1,l.emit("story:play")}}},components:{StoryViewsModal:ct,StoryContentModal:ht}});function vt(e,o,s,t,c,p){const n=d("StoryContentModal"),r=d("StoryViewsModal");return a(),i(C,null,[e.state.isContentModalOpen?(a(),y(n,{key:0,onHide:e.handleHideContent},null,8,["onHide"])):h("",!0),e.state.isViewsModalOpen?(a(),y(r,{key:1,onHide:e.handleHideViews},null,8,["onHide"])):h("",!0)],64)}const wt=_(St,[["render",vt]]),_t=g({props:{storyItem:{type:Object,required:!0}},emits:["finish","view"],setup:function(e,o){const s=D(e.storyItem),t=A({isInitialized:!1,frameIndex:0,frameData:null,isPaused:!1,startTime:null,storyAuthor:s.value.relations.user,permissions:s.value.permissions,isOwner:s.value.meta.is_owner,animationFrameId:null});W("playerState",t),M(()=>{s.value.relations.frames=s.value.relations.frames.map(b=>(b.playable={playing:!1,played:!1,progress:0,leftDuration:0,duration:b.duration_seconds},b)),t.frameData=s.value.relations.frames[0],t.frameData.playable.playing=!0,t.isInitialized=!0,l.on("story:play",$),l.on("story:pause",f),c()}),F(()=>{m()}),z(()=>{l.off("story:play",$),l.off("story:pause",f)});const c=()=>{t.isOwner||o.emit("view",t.frameData.id)},p=()=>{f(),t.frameData.playable={playing:!1,played:!1,progress:0,leftDuration:0,duration:t.frameData.duration_seconds},t.frameIndex-=1,t.frameData=s.value.relations.frames[t.frameIndex],t.frameData.playable={playing:!0,played:!1,progress:0,leftDuration:0,duration:t.frameData.duration_seconds}},n=()=>{f(),t.frameData.playable={playing:!1,played:!0,progress:0,leftDuration:0,duration:t.frameData.duration_seconds},t.frameIndex+=1,t.frameData=s.value.relations.frames[t.frameIndex],t.frameData.playable.playing=!0,c()},r=()=>{t.frameIndex<s.value.relations.frames.length-1?n():(f(),o.emit("finish"))},S=()=>{let b=t.frameData.playable.duration;t.frameData.playable.leftDuration>0?t.startTime=Date.now()-(b-t.frameData.playable.leftDuration)*1e3:t.startTime=Date.now();const k=()=>{if(t.isPaused)return m(),!1;const B=(Date.now()-t.startTime)/1e3;if(t.frameData.playable.leftDuration=b-B,t.frameData.playable.progress=Math.min(B/b*100,100),B<b){if(t.isPaused)return m(),!1;requestAnimationFrame(k)}else return f(),m(),r(),!1};t.animationFrameId=requestAnimationFrame(k)},m=()=>{cancelAnimationFrame(t.animationFrameId),t.animationFrameId=null},$=()=>{t.isPaused=!1,S()},f=()=>{t.isPaused=!0};return{storyData:s,playerState:t,showNextItem:n,showPrevItem:p,pauseStory:f,playStory:$,toggleStory:()=>{t.isPaused?$():f()},hasNextItems:v(()=>t.frameIndex<s.value.relations.frames.length-1),isVideo:v(()=>t.frameData.type=="video"),hasPrevItems:v(()=>t.frameIndex>0)}},components:{StoryPlayback:ze,StoryHeader:Re,StoryVideo:ye,StoryImage:we,StoryViews:ke,StoryContent:Ve,StoryModals:wt}}),$t={class:"w-full h-full items-center overflow-hidden relative"},gt={class:"absolute top-0 left-0 right-0 z-10 text-white pt-4 px-4 pb-6 from-black/60 to-transparent bg-gradient-to-b"},bt={key:3,class:"absolute bottom-0 left-0 right-0 z-10 text-white pt-8 pb-4 from-black/60 to-transparent bg-gradient-to-t"};function kt(e,o,s,t,c,p){const n=d("StoryPlayback"),r=d("StoryHeader"),S=d("StoryVideo"),m=d("StoryImage"),$=d("StoryContent"),f=d("StoryViews"),b=d("StoryModals");return a(),i("div",$t,[u("div",gt,[e.playerState.isInitialized?(a(),i(C,{key:0},[(a(),y(n,{storyData:e.storyData,key:e.storyData.story_uuid},null,8,["storyData"])),w(r,{onPause:e.pauseStory,onPlay:e.playStory},null,8,["onPause","onPlay"])],64)):h("",!0)]),e.hasPrevItems?(a(),i("div",{key:0,class:"absolute w-20 left-0 z-10 top-22 bottom-22 cursor-pointer",onClick:o[0]||(o[0]=(...k)=>e.showPrevItem&&e.showPrevItem(...k))})):h("",!0),e.hasNextItems?(a(),i("div",{key:1,class:"absolute w-20 right-0 z-10 top-22 bottom-22 cursor-pointer",onClick:o[1]||(o[1]=(...k)=>e.showNextItem&&e.showNextItem(...k))})):h("",!0),e.playerState.isInitialized?(a(),i("div",{key:2,class:"h-full w-full cursor-pointer relative",onClick:o[2]||(o[2]=(...k)=>e.toggleStory&&e.toggleStory(...k))},[e.isVideo?(a(),y(S,{frameData:e.playerState.frameData,key:e.playerState.frameData.id},null,8,["frameData"])):(a(),y(m,{frameData:e.playerState.frameData,key:e.playerState.frameData.id},null,8,["frameData"]))])):h("",!0),e.playerState.isInitialized?(a(),i("div",bt,[w($),e.playerState.isOwner?(a(),y(f,{key:0})):h("",!0)])):h("",!0),e.playerState.isInitialized?(a(),y(b,{key:4})):h("",!0)])}const Ct=_(_t,[["render",kt]]);Y();const Dt=g({props:{story_uuid:{type:String,required:!0}},setup:function(e){const o=R(),s=X(),t=D(0),c=v(()=>o.stories);var p;const n=v(()=>c.value[t.value]),r=async m=>{await o.deleteStory(n.value.story_uuid,m),c.value.length||S()};M(async()=>{try{await o.fetchStory(e.story_uuid)}catch(m){alert(m.message),S()}p=document.querySelector("swiper-container"),Object.assign(p,{slidesPerView:1,centeredSlides:!0,spaceBetween:0,allowTouchMove:!0,effect:!1,speed:600,keyboard:{enabled:!0,onlyInViewport:!0}}),l.on("story:delete",r),l.on("story:leave",S),p.initialize()}),z(()=>{l.off("story:delete",r),l.off("story:leave",S)});const S=()=>{s.push({name:"home_index"})};return{stories:c,currentStory:n,activeSlideIndex:t,handleStoryView:m=>{const $=n.value.relations.frames.find(f=>f.id===m);$&&$.activity.is_seen===!1&&o.recordStoryView(n.value.story_uuid,m)},slideToStory:m=>{p.swiper.slideTo(m)},closeStories:S,handleStoryFinish:()=>{t.value<c.value.length-1?p.swiper.slideNext():S()},handleSlideChange:m=>{t.value=m.target.swiper.activeIndex}}},components:{StoryPlayer:Ct}}),It=["onClick"],Vt={key:1,class:"w-full h-full"};function Mt(e,o,s,t,c,p){const n=d("StoryPlayer");return a(),i("div",{class:O(["inset-0 bg-black z-50 fixed",{"pb-5":e.$isStandalone()}])},[u("swiper-container",{onSwiperslidechange:o[0]||(o[0]=(...r)=>e.handleSlideChange&&e.handleSlideChange(...r)),class:"h-full",init:"false"},[(a(!0),i(C,null,P(e.stories,(r,S)=>(a(),i("swiper-slide",{onClick:m=>e.slideToStory(S),class:"w-full h-full",key:r.story_uuid},[e.activeSlideIndex==S?(a(),y(n,{storyItem:r,onView:e.handleStoryView,key:`${r.story_uuid}-${r.relations.frames.length}`,onFinish:e.handleStoryFinish},null,8,["storyItem","onView","onFinish"])):(a(),i("div",Vt))],8,It))),128))],32)],2)}const Ft=_(Dt,[["render",Mt]]);export{Ft as default};
