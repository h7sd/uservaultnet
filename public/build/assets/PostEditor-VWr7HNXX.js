const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PostImagePreview-CteVFqnL.js","assets/MediaDeleteButton-BCkZbKmQ.js","assets/application-C3zsOS77.js","assets/global.properties-DKM1fd6s.js","assets/editor-CpZ7vO5P.js","assets/media-D4ZD3EDk.js","assets/vendor-20TtR0Rd.js","assets/swiper-element-bundle-DBu82uhE.js","assets/application-3Wj8EdJU.css","assets/PostVideoPreview-CFQSw9R5.js","assets/VideoDurationTime-DjdOjCKw.js","assets/PostDocumentPreview-CcH0T1rZ.js","assets/PostGifPreview-BJbRCpaz.js","assets/GiphyAttribution-79F8UUld.js","assets/GIFPicker-DH2PZrr0.js","assets/index-BiajNNMq.js","assets/TimelineEmptyState-D4R0nEYT.js","assets/PollEditor-B43M-489.js","assets/index-CZvQntMR.js","assets/index-ciglwFMH.js","assets/SheetTitle-CCLXWnJ3.js","assets/ClearButton-BVb3OBYL.js"])))=>i.map(i=>d[i]);
import{_ as $,a as m,e as H,P as E,c as I,f as L}from"./global.properties-DKM1fd6s.js";import{k as N,e as u,c as f,d as a,s as o,p as P,v as c,i as p,z as R,K as U,F as O,P as z,t as S,x as j,j as K,B as v,r as k,H as q,l as g,b as J,o as Q}from"./vendor-20TtR0Rd.js";import{u as W}from"./index-ciglwFMH.js";import{a as X,b as Y,u as Z,c as x}from"./application-C3zsOS77.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./swiper-element-bundle-DBu82uhE.js";const ee=N({setup:function(){const e=Z(),s=k(null),M=k(null),C=k(null),D=k(null),V=x(),_=q(),b=k(null),{autoResize:T}=W(),r=g(()=>e.draftPost),w=g(()=>V.userData),n=J({postSubmitting:!1,uploadProgress:0,isGifPickerOpen:!1}),l=t=>{b.value=t,debounce(()=>{b.value=null},3e3);try{L.uiFeedback(),navigator.vibrate([150,50,150])}catch{}},F=()=>({content:r.value.content});Q(async function(){await e.fetchDraftPost()});const h=(t,d="image")=>{const A=new FormData;A.append(d,t),I().postEditor().with(A).withHeaders({"Content-Type":"multipart/form-data"}).uploadProgress(y=>{n.uploadProgress=Math.round(y.loaded/y.total*100)}).sendTo(`media/${d}/upload`).then(y=>{e.fetchDraftPost(),n.uploadProgress=0,B()}).catch(y=>{l(y.response.data.message),n.uploadProgress=0,B()})},i=async()=>{n.postSubmitting=!0,await I().postEditor().with(F()).sendTo("create").then(t=>{e.finishEditing(),T(D.value),G(),toastSuccess(__t("toast.post_published"))}).catch(t=>{l(t.response.data.message)}),n.postSubmitting=!1},B=()=>{s.value.value=""},G=()=>{_.go(-1)};return{leaveEditor:G,state:n,PostTypeUtils:E,PostType:H,userData:w,submitForm:i,validationError:b,postData:r,contentInput:D,videoFileInput:M,imageFileInput:s,audioFileInput:C,textInputHandler:function(){T(D.value)},onImageSelect:function(t){h(t.target.files[0],"image")},onAudioSelect:function(t){h(t.target.files[0],"audio")},onVideoSelect:function(t){h(t.target.files[0],"video")},selectImage:function(){s.value.click()},selectAudio:function(){C.value.click()},selectVideo:function(){M.value.click()},postHasMedia:g(()=>{var t,d;return(d=(t=r.value.relations)==null?void 0:t.media)==null?void 0:d.length}),postHasPoll:g(()=>{var t;return(t=r.value.relations)==null?void 0:t.poll}),postMedia:g(()=>r.value.relations.media),selectGif:t=>{I().postEditor().with({id:t.id}).sendTo("gif/create").then(d=>{e.fetchDraftPost()}).catch(d=>{l(d.response.data.message)}),n.isGifPickerOpen=!1},createPoll:()=>{I().postEditor().sendTo("poll/create").then(t=>{e.fetchDraftPost()}).catch(t=>{l(t.response.data.message)})},submitButtonStatus:g(()=>n.postSubmitting||n.uploadProgress),postMediaButtonStatus:(t=null)=>n.postSubmitting||n.uploadProgress?!0:E.isText(r.value.type)||E.isImage(r.value.type)&&E.isImage(t)?!1:!!r.value.type,deletePostMedia:t=>{t.deleted=!0,I().postEditor().with({id:t.id}).delete("media/delete").then(d=>{e.fetchDraftPost()})},toggleGifPicker:()=>{n.isGifPickerOpen=!n.isGifPickerOpen}}},components:{Toolbar:Y,PrimaryIconButton:X,PostImagePreview:v(()=>m(()=>import("./PostImagePreview-CteVFqnL.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),PostVideoPreview:v(()=>m(()=>import("./PostVideoPreview-CFQSw9R5.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8,10]))),PostDocumentPreview:v(()=>m(()=>import("./PostDocumentPreview-CcH0T1rZ.js"),__vite__mapDeps([11,3,4,5,6,1,2,7,8]))),PostGifPreview:v(()=>m(()=>import("./PostGifPreview-BJbRCpaz.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,13]))),GIFPicker:v(()=>m(()=>import("./GIFPicker-DH2PZrr0.js"),__vite__mapDeps([14,15,2,3,4,5,6,7,8,16]))),PollEditor:v(()=>m(()=>import("./PollEditor-B43M-489.js"),__vite__mapDeps([17,6,18,3,4,5,2,7,8,19,20,21])))}}),te={class:"shrink-0"},oe={class:"flex-1 overflow-y-auto"},se={class:"flex flex-col h-full"},ne={class:"flex-1"},ie=["placeholder"],ae={class:"shrink-0"},le={key:0},re={class:"flex"},de={class:"flex-1 bg-fill-tr h-1"},ue={class:"shrink-0 px-6 pt-4 pb-4 mb-safe-bottom"},pe={class:"flex gap-2 items-center mb-2 -translate-x-1.5"},ce={class:"ml-auto opacity-80"},me={key:0,class:"text-par-s text-red-900 mb-2"},fe={key:1,class:"text-par-s text-lab-sc"},Pe={key:2,class:"text-par-s text-lab-sc"},ve=["href"],ge={class:"hidden"};function be(e,s,M,C,D,V){const _=u("Toolbar"),b=u("Border"),T=u("PostImagePreview"),r=u("PostVideoPreview"),w=u("PostDocumentPreview"),n=u("PostGifPreview"),l=u("PrimaryIconButton"),F=u("GIFPicker"),h=u("PollEditor");return a(),f(O,null,[o("div",{class:K(["flex flex-col fixed inset-0 z-50 bg-bg-pr",{"pb-5":e.$isStandalone()}])},[o("div",te,[p(_,{title:e.$t("editor.new_post"),onClose:e.leaveEditor},null,8,["title","onClose"])]),p(b,{height:"h-2",opacity:"opacity-60"}),o("div",oe,[o("div",se,[o("div",ne,[R(o("textarea",{ref:"contentInput","onUpdate:modelValue":s[0]||(s[0]=i=>e.postData.content=i),onInput:s[1]||(s[1]=(...i)=>e.textInputHandler&&e.textInputHandler(...i)),class:"resize-none py-4 px-6 h-full w-full leading-normal bg-transparent text-title-3 text-lab-pr2 outline-hidden placeholder:font-light placeholder:text-title-3",placeholder:e.$t("editor.post_text_input_placeholder")},null,40,ie),[[U,e.postData.content]])]),o("div",ae,[e.postHasMedia?(a(),f(O,{key:0},[e.PostTypeUtils.isImage(e.postData.type)?(a(),P(T,{key:0,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):c("",!0),e.PostTypeUtils.isVideo(e.postData.type)?(a(),P(r,{key:1,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):e.PostTypeUtils.isDocument(e.postData.type)||e.PostTypeUtils.isAudio(e.postData.type)?(a(),P(w,{key:2,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):e.PostTypeUtils.isGif(e.postData.type)?(a(),P(n,{key:3,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):c("",!0)],64)):c("",!0)])])]),e.state.uploadProgress?(a(),f("div",le,[o("div",re,[o("div",de,[o("div",{class:"bg-green-900 min-w-10 h-full",style:z({width:e.state.uploadProgress+"%"})},null,4)])])])):c("",!0),o("div",ue,[o("div",pe,[p(l,{onClick:e.selectImage,disabled:e.postMediaButtonStatus(e.PostType.IMAGE),iconName:"image-01",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.selectVideo,disabled:e.postMediaButtonStatus(e.PostType.VIDEO),iconName:"video-recorder",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.selectAudio,disabled:e.postMediaButtonStatus(e.PostType.AUDIO),iconName:"music-note-01",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.createPoll,disabled:e.postMediaButtonStatus(e.PostType.POLL),iconName:"bar-chart-12",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.toggleGifPicker,disabled:e.postMediaButtonStatus(e.PostType.GIF),iconName:"gif",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),o("div",ce,[p(l,{disabled:e.submitButtonStatus,onClick:e.submitForm,iconName:"send-03",buttonColor:"text-lab-pr2"},null,8,["disabled","onClick"])])]),e.validationError?(a(),f("p",me,S(e.validationError),1)):c("",!0),e.userData.is_author?(a(),f("p",fe,S(e.$t("editor.post_privacy")),1)):(a(),f("p",Pe,[j(S(e.$t("editor.post_author_note"))+" ",1),o("a",{href:e.$getRoute("become_author"),class:"hover:underline text-brand-900"},S(e.$t("labels.learn_more")),9,ve)]))]),o("div",ge,[o("input",{onChange:s[2]||(s[2]=(...i)=>e.onImageSelect&&e.onImageSelect(...i)),type:"file",accept:"image/*",ref:"imageFileInput"},null,544),o("input",{onChange:s[3]||(s[3]=(...i)=>e.onVideoSelect&&e.onVideoSelect(...i)),type:"file",accept:"video/*",ref:"videoFileInput"},null,544),o("input",{onChange:s[4]||(s[4]=(...i)=>e.onAudioSelect&&e.onAudioSelect(...i)),type:"file",accept:"audio/*",ref:"audioFileInput"},null,544)])],2),e.state.isGifPickerOpen?(a(),P(F,{key:0,onSelect:e.selectGif,onClose:s[5]||(s[5]=i=>e.state.isGifPickerOpen=!1)},null,8,["onSelect"])):c("",!0),e.postHasPoll?(a(),P(h,{key:1,onLeave:e.leaveEditor},null,8,["onLeave"])):c("",!0)],64)}const Se=$(ee,[["render",be]]);export{Se as default};
