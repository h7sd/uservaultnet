import{_ as k,d as C,r as p,c,o as u,j as t,m as g,a as i,e as B,w as _,t as y,v as O,K as T,F as V,i as w,q as $,g as E,b as x,I as q,l as P}from"./global.properties-ieI6Xwik.js";import{A as R}from"./index-CZvQntMR.js";import{i as H,j,d as F,a as M,k as N,u as G}from"./application-B35z453N.js";import{u as L}from"./index-CaocF3Et.js";import{S as Q}from"./SheetTitle-Cb1vf6Xi.js";import{C as z}from"./ClearButton-pgQ229dk.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./swiper-element-bundle-DBu82uhE.js";const D=C({props:{removable:{type:Boolean,default:!0},placeholder:{type:String,default:""},modelValue:{type:String,required:!0}},emits:["update:modelValue","remove"],setup:function(e,o){return{updateModelValue:n=>{o.emit("update:modelValue",n.target.value)}}},components:{ClearButton:z}}),U={class:"flex overflow-hidden items-center"},K={class:"flex-1"},J=["value","placeholder"],W={key:0,class:"shrink-0 size-11 inline-flex items-center justify-center"};function X(e,o,n,m,a,h){const l=p("ClearButton");return u(),c("div",U,[t("div",K,[t("input",{onInput:o[0]||(o[0]=(...s)=>e.updateModelValue&&e.updateModelValue(...s)),value:e.modelValue,class:"block w-full bg-transparent outline-hidden text-par-l text-lab-pr h-12 px-4 placeholder:text-lab-tr focus:placeholder:text-lab-sc",placeholder:e.placeholder},null,40,J)]),e.removable?(u(),c("div",W,[i(l,{onClick:o[1]||(o[1]=s=>e.$emit("remove"))})])):g("",!0)])}const Y=k(D,[["render",X]]),Z=C({emits:["leave"],setup:function(e,o){const n=G(),m=$(null),a=E({postSubmitting:!1,validationError:null}),h=$(""),l=$([]),{autoResize:s}=L();n.pollHasChoices()?l.value=n.pollChoices:l.value=[{choice_text:""},{choice_text:""},{choice_text:""}];const b=function(){s(m.value)},v=x(()=>l.value.length<10);q(l,r=>{n.setPollChoices(r)},{deep:!0});const f=x(()=>l.value.length>2);return{pollOptions:l,canAddOption:v,canRemoveOption:f,questionTextInputField:m,questionInputHandler:b,pollQuestion:h,state:a,addOption:()=>{v.value&&l.value.push({choice_text:""})},removeOption:r=>{f.value&&R.make(l.value).removeItem(r)},removePoll:async()=>{n.finishEditing(),await P().postEditor().delete("poll/delete").then(()=>{n.fetchDraftPost()})},publishPoll:async()=>{if(a.postSubmitting)return!1;a.postSubmitting=!0,await P().postEditor().with({content:h.value,poll_options:l.value}).sendTo("create").then(r=>{n.finishEditing(),s(m.value),toastSuccess(__t("toast.post_published")),o.emit("leave")}).catch(r=>{a.validationError=r.response.data.message,debounce(()=>{a.validationError=null},3e3)}),a.postSubmitting=!1}}},components:{PollOptionInput:Y,PrimaryTextButton:N,PrimaryIconButton:M,ActionSheet:F,SheetTitle:Q,ActionSheetGroup:j,ActionSheetItem:H}}),ee={class:"h-full overflow-y-auto"},te={class:"text-center px-4 mb-4"},oe={class:"mb-4"},le={class:"mb-2 px-4"},ne={class:"text-lab-pr3 text-par-s mb-1.5"},se={class:"flex max-h-72 overflow-y-auto"},ie=["placeholder"],ae={class:"mb-4"},re={class:"mb-2 px-4"},pe={class:"text-lab-pr3 text-par-s mb-1.5"},ue={class:"block"},de=["title"],ce={key:0,class:"mb-4 px-4"},me={class:"text-red-900 text-par-s"},he={class:"mb-4"},ve={class:"px-4 py-2"},fe={class:"flex items-center justify-center"};function _e(e,o,n,m,a,h){const l=p("SheetTitle"),s=p("ActionSheetGroup"),b=p("PollOptionInput"),v=p("PrimaryIconButton"),f=p("ActionSheetItem"),r=p("PrimaryTextButton"),A=p("ActionSheet");return u(),B(A,{isMuted:!0,isLocked:!0},{default:_(()=>[t("div",ee,[t("div",te,[i(l,{title:e.$t("editor.new_poll")},null,8,["title"])]),t("div",oe,[t("div",le,[t("h4",ne,y(e.$t("editor.poll_question")),1)]),i(s,null,{default:_(()=>[t("div",se,[O(t("textarea",{ref:"questionTextInputField",placeholder:e.$t("editor.post_poll_input_placeholder"),"onUpdate:modelValue":o[0]||(o[0]=d=>e.pollQuestion=d),onInput:o[1]||(o[1]=(...d)=>e.questionInputHandler&&e.questionInputHandler(...d)),class:"w-full h-24 min-h-24 outline-hidden resize-vertical px-4 py-4 text-par-l text-lab-pr placeholder:text-lab-tr focus:placeholder:text-lab-sc"},null,40,ie),[[T,e.pollQuestion,void 0,{trim:!0}]])])]),_:1})]),t("div",ae,[t("div",re,[t("h4",pe,y(e.$t("labels.answer_options")),1)]),i(s,null,{default:_(()=>[t("div",ue,[(u(!0),c(V,null,w(e.pollOptions,(d,S)=>(u(),c("div",{key:S,class:"relative after:content-[''] after:absolute after:left-4 after:right-0 after:bottom-0 after:h-[1px] after:bg-bord-pr last:after:hidden"},[i(b,{onRemove:I=>e.removeOption(S),modelValue:d.choice_text,"onUpdate:modelValue":I=>d.choice_text=I,removable:e.canRemoveOption,placeholder:e.$t("labels.option_number",{number:S+1})},null,8,["onRemove","modelValue","onUpdate:modelValue","removable","placeholder"])]))),128))])]),_:1}),e.canAddOption?(u(),c("div",{key:0,class:"flex justify-center pt-4",title:e.$t("editor.add_option")},[i(v,{disabled:e.state.postSubmitting,iconName:"plus",onClick:e.addOption,iconType:"solid"},null,8,["disabled","onClick"])],8,de)):g("",!0)]),e.state.validationError?(u(),c("div",ce,[t("div",me,y(e.state.validationError),1)])):g("",!0),t("div",he,[i(s,null,{default:_(()=>[i(f,{loading:e.state.postSubmitting,onClick:e.publishPoll,textLabel:e.$t("editor.publish"),iconName:"send-03",iconType:"solid"},null,8,["loading","onClick","textLabel"])]),_:1})]),t("div",ve,[t("div",fe,[i(r,{disabled:e.state.postSubmitting,onClick:e.removePoll,buttonRole:"marginal",buttonText:e.$t("editor.remove_poll")},null,8,["disabled","onClick","buttonText"])])])])]),_:1})}const ke=k(Z,[["render",_e]]);export{ke as default};
