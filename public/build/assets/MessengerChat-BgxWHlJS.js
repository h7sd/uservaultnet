const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReactionsPicker-CgljJK1r.js","assets/global.properties-ieI6Xwik.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/smileys-and-emotions-Beo3QNJK.js","assets/swiper-element-bundle-DBu82uhE.js","assets/PanelHeader-pG5k2GZi.js","assets/application-DnsIlr-S.js","assets/inbox.store-DKf8FrGP.js","assets/index-CaocF3Et.js","assets/ReactionsViewer-DCDPlTYr.js","assets/LinkSnapshot-D4bCBbRO.js","assets/LinkSnapshot-D9dLwJZT.js","assets/EmojisPicker-C7BYMySD.js","assets/ChatInfo-DdN3nLYM.js","assets/chat.store-DbSkwILP.js","assets/ModalRowButton-DQqFuzSn.js","assets/ParticipantItem-DEyxw5wt.js","assets/AvatarNormal-QOljNkCM.js","assets/ChatHeaderSkeleton-BtBb8mwX.js","assets/AvatarMedium-BDR98hYM.js","assets/TranslationService-ew0KueNY.js"])))=>i.map(i=>d[i]);
import{_ as S,d as A,c as a,j as s,a as c,r as l,p as E,e as b,m,F as M,t as f,w as j,q as T,b as h,H as Z,o as t,C as W,Q as H,n as U,u as L,v as q,x as ne,y as O,z as F,g as Y,K as ae,a4 as oe,h as x,B as K,S as ee,i as X,M as ie,G as le,V as w,A as re,s as ce}from"./global.properties-ieI6Xwik.js";import{u as N}from"./chat.store-DbSkwILP.js";import{P as Q,A as te,f as de,D as pe,b as ue,c as me,d as se}from"./application-DnsIlr-S.js";import{C as he}from"./ChatHeaderSkeleton-BtBb8mwX.js";import{A as ge}from"./AvatarMedium-BDR98hYM.js";import{D as _e,a as ve,T as fe,c as ye}from"./TranslationService-ew0KueNY.js";import{u as ke}from"./index-CaocF3Et.js";const be=A({emits:["info"],props:{typingUser:{type:Object,default:{is_typing:!1,user:null}}},setup:function(e,n){const o=N(),_=T(o.chatData),p=Z();return{chatData:_,isTyping:h(()=>e.typingUser.is_typing===!0),openInfo:()=>{_.value.type=="group"?p.push({name:"messenger_group_show",params:{chat_id:_.value.chat_id,group_id:_.value.chat_info.id}}):n.emit("info")}}},components:{AvatarSmall:te,PrimaryIconButton:Q}}),Ce={class:"h-16 flex justify-between items-center px-6"},$e={class:"ml-3"},De={class:"text-par-l font-bold mb-1 text-lab-pr"},we=["innerHTML"],Me={class:"block text-par-s text-lab-sc"},Te={class:"inline-flex gap-2.5"};function Se(e,n,o,_,p,v){const g=l("AvatarSmall"),r=l("VerificationBadge"),u=l("PrimaryIconButton"),d=l("RouterLink");return t(),a("div",Ce,[s("div",{onClick:n[0]||(n[0]=(...y)=>e.openInfo&&e.openInfo(...y)),class:"inline-flex items-center cursor-pointer leading-none"},[c(g,{avatarSrc:e.chatData.chat_info.avatar_url},null,8,["avatarSrc"]),s("div",$e,[s("h4",De,[s("span",{innerHTML:e.chatData.chat_info.name},null,8,we),n[1]||(n[1]=E()),e.chatData.chat_info.verified?(t(),b(r,{key:0,size:"sm"})):m("",!0)]),s("span",Me,[e.chatData.is_group?(t(),a(M,{key:0},[E(f(e.$t("chat.participants_count",{count:e.chatData.chat_info.participants_count.formatted})),1)],64)):(t(),a(M,{key:1},[e.isTyping?(t(),a(M,{key:0},[E(f(e.$t("chat.typing")),1)],64)):(t(),a(M,{key:1},[E(f(e.$t("labels.was_online_at",{time:e.chatData.chat_info.last_active.formatted})),1)],64))],64))])])]),s("div",Te,[c(u,{onClick:e.$comingSoon,iconName:"search-lg"},null,8,["onClick"]),e.chatData.is_group?(t(),b(d,{key:0,to:{name:"messenger_group_show",params:{chat_id:e.chatData.id}}},{default:j(()=>[c(u,{iconName:"info-circle",iconType:"line"})]),_:1},8,["to"])):(t(),a(M,{key:1},[c(u,{onClick:e.$comingSoon,disabled:!0,iconName:"phone",iconType:"line"},null,8,["onClick"]),c(u,{onClick:e.openInfo,iconName:"layout-right",iconType:"line"},null,8,["onClick"])],64))])])}const Re=S(be,[["render",Se]]),Ee={},Pe={class:"h-12 flex justify-between items-center px-6 mb-4"};function Ae(e,n){return t(),a("div",Pe,n[0]||(n[0]=[W('<div class="shrink-0"><div class="skeleton-circle size-12"></div></div><div class="px-4 flex-1"><div class="skeleton-circle w-full h-12"></div></div><div class="shrink-0 inline-flex gap-2"><div class="skeleton-circle size-12"></div><div class="skeleton-circle size-12"></div><div class="skeleton-circle size-12"></div></div>',3)]))}const Be=S(Ee,[["render",Ae]]),Ie={},Le={class:"block opacity-70"};function He(e,n){return t(),a("div",Le,n[0]||(n[0]=[W('<div class="flex justify-center"><div class="w-content"><div class="flex justify-center mb-4"><div class="skeleton-circle size-large-avatar"></div></div><div class="flex flex-col items-center"><div class="skeleton h-4 w-24 mb-2"></div><div class="skeleton h-2 w-16 mb-2"></div><div class="skeleton h-3 w-8/12 mb-2"></div><div class="skeleton h-3 w-3/12 mb-2"></div><div class="skeleton h-3 w-16 mb-4"></div></div></div></div>',1)]))}const ze=S(Ie,[["render",He]]),Oe={},Fe={class:"flex items-center gap-2 px-6"};function Ne(e,n){return t(),a("div",Fe,n[0]||(n[0]=[W('<div class="shrink-0"><div class="size-small-avatar skeleton-circle"></div></div><div class="flex-1"><div class="w-content"><div class="h-3 w-32 skeleton mb-2"></div><div class="h-3 w-full skeleton"></div></div></div>',2)]))}const je=S(Oe,[["render",Ne]]),Ve=A({setup:function(){const e=N(),n=T(e.chatData);return{chatData:n,isDirect:e.isDirect,hasDescription:e.hasDescription,isFollowedBy:h(()=>n.value.is_group?!1:n.value.chat_info.meta.relationship.follow.followed_by)}},components:{PrimaryPillButton:de,AvatarMedium:ge}}),Ge={class:"block"},Ue={class:"flex justify-center"},qe={class:"w-content"},Ke={class:"flex justify-center mb-2"},We={class:"text-center flex flex-col gap-1"},Ye={class:"text-par-l font-bold text-lab-pr"},Qe={class:"block text-par-s text-lab-sc"},Je={key:0,class:"block text-par-s text-lab-sc"},Xe=["innerHTML"],Ze={key:2,class:"block text-par-s text-lab-sc"},xe={key:0,class:"flex justify-center mt-4"};function et(e,n,o,_,p,v){const g=l("AvatarMedium"),r=l("VerificationBadge"),u=l("PrimaryPillButton"),d=l("RouterLink");return t(),a("div",Ge,[s("div",Ue,[s("div",qe,[s("div",Ke,[c(g,{avatarSrc:e.chatData.chat_info.avatar_url},null,8,["avatarSrc"])]),s("div",We,[s("h2",Ye,[E(f(e.chatData.chat_info.name)+" ",1),e.chatData.chat_info.verified?(t(),b(r,{key:0,size:"md"})):m("",!0)]),s("span",Qe,[e.chatData.is_group?(t(),a(M,{key:0},[E(f(e.$t("labels.group"))+" â€” "+f(e.$t("chat.participants_count",{count:e.chatData.chat_info.participants_count.formatted})),1)],64)):(t(),a(M,{key:1},[E(f(e.$t("labels.was_online_at",{time:e.chatData.chat_info.last_active.formatted})),1)],64))]),e.chatData.is_group?m("",!0):(t(),a(M,{key:0},[e.isFollowedBy?(t(),a("span",Je,f(e.$t("labels.following_you_on",{app_name:e.$embedder("config.app.name")})),1)):m("",!0)],64)),e.hasDescription?(t(),a("span",{key:1,class:"block text-par-l text-lab-pr2 markdown-text",innerHTML:e.$mdInline(e.chatData.chat_info.description,{breaks:!1})},null,8,Xe)):m("",!0),e.chatData.is_group?m("",!0):(t(),a("span",Ze,f(e.chatData.chat_info.followers_count.formatted)+" "+f(e.$t("labels.followers_count",e.chatData.chat_info.followers_count.raw)),1))]),e.isDirect?(t(),a("div",xe,[c(d,{to:{name:"profile_index",params:{id:e.chatData.chat_info.username}}},{default:j(()=>[c(u,{buttonType:"submit",buttonSize:"md",buttonText:e.$t("labels.view_profile")},null,8,["buttonText"])]),_:1},8,["to"])])):m("",!0)])])])}const tt=S(Ve,[["render",et]]),st=A({props:{replyData:{type:Object,required:!0}},setup:function(e){return{messageColor:h(()=>e.replyData.participant.color)}}}),nt={class:"flex"},at={class:"shrink-0 overflow-hidden"},ot={class:"flex relative items-stretch overflow-hidden"},it={class:"cursor-pointer pl-2 py-0.5 relative z-10 overflow-hidden"},lt=["innerHTML"];function rt(e,n,o,_,p,v){return t(),a("div",nt,[s("div",at,[s("div",ot,[s("div",{class:"w-[3px] shrink-0 relative z-10 rounded-xs",style:H({backgroundColor:e.messageColor})},null,4),s("div",it,[s("h3",{class:"text-cap-l font-semibold leading-none mb-0.5",style:H({color:e.messageColor})},f(e.replyData.user.name),5),s("p",{class:"text-par-m text-lab-sc break-words",innerHTML:e.replyData.content},null,8,lt)])])])])}const ct=S(st,[["render",rt]]),dt=A({props:{messageData:{type:Object,required:!0},isCompacted:{type:Boolean,required:!0}},emits:["delete","reply","copy"],setup:function(e,n){const o=Y({isDropdownOpen:!1,isReactionPickerOpen:!1,isTranslating:!1,isTranslated:!1}),_=T(""),p=se(),v=N(),g=T(p.userData),r=T(e.messageData),u=function(){o.isDropdownOpen=!1,y.value&&debounce(()=>{o.isReactionPickerOpen=!0},50)},d=function(){o.isReactionPickerOpen=!1},y=h(()=>!r.value.meta.is_deleted),C=()=>{d(),y.value&&(o.isDropdownOpen=!o.isDropdownOpen)},D=h(()=>g.value.id==r.value.user_id);return{state:o,isSender:D,closeReactionsPicker:d,openReactionsPicker:u,messageData:r,messageUser:h(()=>r.value.relations.user),messageColor:h(()=>r.value.relations.participant.color),replyData:h(()=>r.value.relations.parent),messageContent:h(()=>o.isTranslated?_.value:r.value.content),toggleMainDropdown:C,addReaction:k=>{d(),y.value&&v.addReaction(k,r.value.id)},displayMessageControls:h(()=>o.isDropdownOpen||o.isReactionPickerOpen),hasReactions:h(()=>r.value.relations.reactions.length),hasLinkSnapshot:h(()=>{var k;return(k=r.value.relations)==null?void 0:k.link_snapshot}),isNotDeleted:y,isTranslatable:h(()=>r.value.meta.is_translatable),deleteMessage:()=>{n.emit("delete",{messageId:r.value.id,isSender:D.value})},replyToMessage:()=>{n.emit("reply",r.value)},copyMessageText:()=>{n.emit("copy",r.value)},isMessageSeen:h(()=>v.otherParticipants?v.otherParticipants.some(function(k){return k.last_read_message_id>=r.value.id}):!1),translate:async()=>{if(o.isTranslating||o.isTranslated)return!1;o.isTranslating=!0;const k=await ye().translate(r.value.content);k&&(_.value=k,o.isTranslated=!0),o.isTranslating=!1},cancelTranslation:()=>{o.isTranslated=!1,_.value=""}}},components:{AvatarSmall:te,DropdownButton:me,DropdownMenu:ue,DropdownMenuItem:pe,PrimaryIconButton:Q,ChatMessageReply:ct,TranslationService:fe,TextTranslateButton:ve,DropdownReactions:_e,ReactionsPicker:O(()=>F(()=>import("./ReactionsPicker-CgljJK1r.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ReactionsViewer:O(()=>F(()=>import("./ReactionsViewer-DCDPlTYr.js"),__vite__mapDeps([9,1,2]))),LinkSnapshot:O(()=>F(()=>import("./LinkSnapshot-D4bCBbRO.js"),__vite__mapDeps([10,11,1,2])))}}),pt=["title"],ut={class:"flex-1 group"},mt={class:"flex overflow-hidden"},ht={key:0,class:"w-small-avatar shrink-0"},gt={key:1,class:"shrink-0"},_t={class:"flex-1 ml-3"},vt={class:"w-96"},ft={key:0,class:"leading-none"},yt={class:"block"},kt={key:0,class:"mt-1.5"},bt={class:"block"},Ct={key:0,class:"leading-none my-1"},$t=["innerHTML"],Dt={key:2,class:"flex mt-1"},wt={class:"text-lab-sc text-par-m leading-snug"},Mt={key:3,class:"mt-2"},Tt={key:1,class:"w-96 mt-3"},St={key:1,class:"block mt-1"},Rt={class:"shrink-0 transform -scale-x-100"},Et={class:"shrink-0 relative"},Pt={class:"absolute right-0 top-8 origin-top-left z-20"},At={class:"shrink-0 relative"},Bt={class:"opacity-80 hover:opacity-100"},It={key:0,class:"absolute top-10 right-0 z-50"},Lt={key:1,class:"shrink-0 size-8 inline-flex-center ml-2"},Ht={key:1,class:"size-icon-small text-lab-sc"},zt={class:"shrink-0"},Ot={class:"text-cap-l text-lab-sc"};function Ft(e,n,o,_,p,v){const g=l("AvatarSmall"),r=l("VerificationBadge"),u=l("ChatMessageReply"),d=l("TextTranslateButton"),y=l("TranslationService"),C=l("LinkSnapshot"),D=l("ReactionsViewer"),k=l("PrimaryIconButton"),B=l("ReactionsPicker"),z=l("PrimaryTransition"),P=l("DropdownButton"),I=l("DropdownReactions"),R=l("DropdownMenuItem"),i=l("Border"),$=l("DropdownMenu"),V=l("SvgIcon"),J=ne("outside-click");return t(),a("div",{onDblclick:n[0]||(n[0]=L((...G)=>e.replyToMessage&&e.replyToMessage(...G),["stop"])),title:e.$t("chat.double_click_to_reply"),class:U(["flex group px-6 items-start",[e.displayMessageControls?"bg-brand-900/5":"hover:bg-fill-fv",e.isCompacted?"py-1":"py-2"]]),onContextmenu:n[1]||(n[1]=L((...G)=>e.toggleMainDropdown&&e.toggleMainDropdown(...G),["prevent"]))},[s("div",ut,[s("div",mt,[e.isCompacted?(t(),a("div",ht)):(t(),a("div",gt,[c(g,{avatarSrc:e.messageUser.avatar_url},null,8,["avatarSrc"])])),s("div",_t,[s("div",vt,[e.isCompacted?m("",!0):(t(),a("div",ft,[s("strong",{class:"text-par-n font-semibold",style:H({color:e.messageColor})},[E(f(e.messageUser.name)+" ",1),e.messageUser.verified?(t(),b(r,{key:0,size:"xs"})):m("",!0)],4)])),s("div",yt,[e.messageData.has_parent?(t(),a("div",kt,[c(u,{replyData:e.replyData},null,8,["replyData"])])):m("",!0),s("div",bt,[e.isTranslatable&&e.state.isTranslated?(t(),a("div",Ct,[c(d,{onClick:e.cancelTranslation,buttonText:e.$t("labels.show_untranslated")},null,8,["onClick","buttonText"])])):m("",!0),e.isNotDeleted?(t(),a("div",{key:1,class:"text-par-l markdown-text leading-snug font-medium text-lab-pr2",innerHTML:e.$mdInline(e.messageContent)},null,8,$t)):(t(),a("div",Dt,[s("p",wt,f(e.$t("chat.message_is_deleted")),1)])),e.isTranslatable&&e.isNotDeleted&&e.state.isTranslated?(t(),a("div",Mt,[c(y)])):m("",!0)]),e.hasLinkSnapshot?(t(),a("div",Tt,[c(C,{linkSnapshot:e.messageData.relations.link_snapshot},null,8,["linkSnapshot"])])):m("",!0)]),e.isNotDeleted&&e.hasReactions?(t(),a("div",St,[c(D,{onAdd:e.addReaction,reactions:e.messageData.relations.reactions},null,8,["onAdd","reactions"])])):m("",!0)])])])]),e.isNotDeleted?(t(),a("div",{key:0,class:U(["shrink-0 inline-flex items-center leading-none",[e.displayMessageControls?"visible":"invisible group-hover:visible"]])},[s("div",Rt,[c(k,{onClick:L(e.replyToMessage,["stop"]),iconName:"share-06",iconSize:"icon-small",iconType:"line"},null,8,["onClick"])]),s("div",Et,[c(k,{onClick:L(e.openReactionsPicker,["stop"]),iconName:"heart-rounded",iconSize:"icon-small",iconType:"line"},null,8,["onClick"]),c(z,null,{default:j(()=>[s("div",Pt,[e.state.isReactionPickerOpen?q((t(),b(B,{key:0,onAdd:e.addReaction},null,8,["onAdd"])),[[J,e.closeReactionsPicker]]):m("",!0)])]),_:1})]),s("div",At,[s("div",Bt,[c(P,{onClick:L(e.toggleMainDropdown,["stop"])},null,8,["onClick"])]),e.state.isDropdownOpen?(t(),a("div",It,[q((t(),b($,{onClick:e.toggleMainDropdown},{default:j(()=>[c(I,{onAdd:e.addReaction},null,8,["onAdd"]),c(R,{onClick:e.openReactionsPicker,iconName:"heart-rounded",textLabel:e.$t("dd.add_reaction")},null,8,["onClick","textLabel"]),e.isTranslatable?(t(),a(M,{key:0},[e.state.isTranslated?(t(),b(R,{key:0,onClick:e.cancelTranslation,iconName:"translate-01",textLabel:e.$t("dd.show_untranslated")},null,8,["onClick","textLabel"])):(t(),b(R,{key:1,onClick:e.translate,iconName:"translate-01",textLabel:e.$t("dd.translate")},null,8,["onClick","textLabel"]))],64)):m("",!0),c(R,{onClick:e.replyToMessage,iconName:"pencil-line",textLabel:e.$t("dd.message.reply",{name:e.messageUser.name})},null,8,["onClick","textLabel"]),c(R,{onClick:e.copyMessageText,iconName:"type-01",textLabel:e.$t("dd.copy_text")},null,8,["onClick","textLabel"]),c(i),c(R,{onClick:e.deleteMessage,itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.message.delete_message")},null,8,["onClick","textLabel"])]),_:1},8,["onClick"])),[[J,e.toggleMainDropdown]])])):m("",!0)])],2)):m("",!0),e.isSender?(t(),a("div",Lt,[e.isMessageSeen?(t(),a("span",{key:0,class:"size-icon-small",style:H({color:e.messageColor})},[c(V,{type:"line",name:"message-double-check"})],4)):(t(),a("span",Ht,[c(V,{type:"line",name:"message-check"})]))])):m("",!0),s("div",zt,[s("time",Ot,f(e.messageData.date.time_ago),1)])],42,pt)}const Nt=S(dt,[["render",Ft]]),jt=A({props:{typingUser:{type:Object,default:{is_typing:!1,user:null}}},setup:function(e){return{isTyping:h(()=>e.typingUser.is_typing===!0)}}}),Vt={key:0,class:"flex items-center px-6 bg-green-100 py-2"},Gt={class:"shrink-0"},Ut={class:"text-par-s text-black font-medium"};function qt(e,n,o,_,p,v){return e.isTyping?(t(),a("div",Vt,[s("div",Gt,[s("p",Ut,f(e.$t("chat.user_is_typing",{name:e.typingUser.user.name})),1)]),n[0]||(n[0]=s("div",{class:"shrink-0 ml-6"},[s("div",{class:"colibri-primary-animation"})],-1))])):m("",!0)}const Kt=S(jt,[["render",qt]]),Wt=A({props:{messageData:{type:Object,required:!0}},emits:["cancel"],setup:function(e,n){const o=T(e.messageData);return{messageData:o,cancelMessageReply:()=>{n.emit("cancel")},messageColor:h(()=>o.value.relations.participant.color)}},components:{PrimaryIconButton:Q}}),Yt={class:"block"},Qt={class:"flex overflow-hidden"},Jt={class:"size-small-avatar shrink-0"},Xt={class:"flex-1 overflow-hidden ml-2"},Zt={class:"overflow-hidden"},xt={class:"text-par-s text-lab-sc leading-none ml-1 font-normal"},es=["innerHTML"],ts={class:"size-small-avatar shrink-0"};function ss(e,n,o,_,p,v){const g=l("SvgIcon"),r=l("PrimaryIconButton");return t(),a("div",Yt,[s("div",Qt,[s("div",Jt,[s("div",{style:H({backgroundColor:e.messageColor}),class:"transform -scale-x-100 size-small-avatar inline-flex-center overflow-hidden rounded-full"},[c(g,{name:"share-06",type:"line",classes:"size-icon-small text-white"})],4)]),s("div",Xt,[s("div",Zt,[s("h3",{class:"text-par-s font-semibold leading-none",style:H({color:e.messageColor})},[E(f(e.messageData.relations.user.name)+" ",1),s("span",xt,f(e.messageData.date.time_ago),1)],4),s("p",{class:"text-par-m truncate text-lab-pr2 max-w-content",innerHTML:e.messageData.content},null,8,es)])]),s("div",ts,[c(r,{onClick:e.cancelMessageReply,name:"x-close"},null,8,["onClick"])])])])}const ns=S(Wt,[["render",ss]]),as=A({emits:["typing"],setup:function(e,n){const o=T(null),_=N(),p=T(null),v=T(""),{autoResize:g,insertSymbolAtCaret:r}=ke(),u=Y({isSubmitting:!1,isEmojisPickerOpen:!1}),d=function(){g(p.value),n.emit("typing")};return x(()=>{K.on("messenger-message:reply",C=>{o.value=C.messageData,p.value&&p.value.focus()})}),{state:u,repliedMessage:o,messageInputHandler:d,submitForm:async function(C){if(!u.isSubmitting){if(C.shiftKey)d();else if(C.preventDefault(),u.isEmojisPickerOpen=!1,v.value.length)try{u.isSubmitting=!0;let D={content:v.value};o.value&&(D.parent_id=o.value.id),await _.sendMessage(D),u.isSubmitting=!1,ee.chatMessageSent(),v.value="",o.value=null,d()}catch(D){alert(D)}}},autoResize:g,messageInputField:p,inputMessageText:v,hasTyped:h(()=>v.value.length>0),insertMessageEmoji:C=>{v.value=r(p.value,C),p.value.focus()},isReplaying:h(()=>o.value!==null),cancelMessageReply:()=>{o.value=null}}},components:{EmojisPicker:O(()=>F(()=>import("./EmojisPicker-C7BYMySD.js"),__vite__mapDeps([12,6,1,2,7,8]))),MessageReplyPreview:ns}}),os={key:0,class:"mb-3"},is={class:"block relative leading-none"},ls={class:"absolute left-4 top-3"},rs={class:"relative"},cs=["disabled"],ds={key:0,class:"block absolute bottom-6 left-0 w-80 z-50"},ps=["placeholder"],us={class:"absolute right-4 top-3"},ms={class:"flex gap-4"},hs=["disabled"],gs={key:1,disabled:!0,class:"outline-hidden size-icon-normal text-brand-900 disabled:opacity-60 disabled:cursor-wait"};function _s(e,n,o,_,p,v){const g=l("MessageReplyPreview"),r=l("SvgIcon"),u=l("EmojisPicker");return t(),a("div",{class:U(["py-4 px-6 bg-bg-pr",[e.isReplaying?"border-t border-t-bord-pr":""]])},[e.isReplaying?(t(),a("div",os,[(t(),b(g,{onCancel:e.cancelMessageReply,key:e.repliedMessage.id,messageData:e.repliedMessage},null,8,["onCancel","messageData"]))])):m("",!0),s("div",is,[s("div",ls,[s("div",rs,[s("button",{onClick:n[0]||(n[0]=L(d=>e.state.isEmojisPickerOpen=!0,["stop"])),disabled:e.state.isSubmitting,class:"outline-hidden size-icon-normal text-brand-900 disabled:opacity-80 disabled:cursor-wait"},[c(r,{type:"line",name:"face-smile"})],8,cs),e.state.isEmojisPickerOpen?(t(),a("div",ds,[c(u,{onPick:e.insertMessageEmoji,onClose:n[1]||(n[1]=d=>e.state.isEmojisPickerOpen=!1)},null,8,["onPick"])])):m("",!0)])]),q(s("textarea",{ref:"messageInputField",class:"resize-none pl-12 pr-36 pt-2.5 pb-2 leading-normal text-lab-pr font-normal text-par-l bg-fill-qt w-full h-12 min-h-12 max-h-40 overflow-x-hidden overflow-y-auto rounded-3xl outline-hidden placeholder:text-par-l placeholder:text-lab-sc placeholder:font-normal",onInput:n[2]||(n[2]=(...d)=>e.messageInputHandler&&e.messageInputHandler(...d)),onKeydown:n[3]||(n[3]=oe((...d)=>e.submitForm&&e.submitForm(...d),["enter"])),"onUpdate:modelValue":n[4]||(n[4]=d=>e.inputMessageText=d),placeholder:e.isReplaying?e.$t("chat.write_reply"):e.$t("chat.write_message")},null,40,ps),[[ae,e.inputMessageText,void 0,{trim:!0}]]),s("div",us,[s("div",ms,[s("button",{onClick:n[5]||(n[5]=(...d)=>e.$comingSoon&&e.$comingSoon(...d)),disabled:!0,class:"outline-hidden size-icon-normal text-brand-900 disabled:opacity-60 disabled:cursor-default"},[c(r,{type:"line",name:"image-plus"})]),s("button",{onClick:n[6]||(n[6]=(...d)=>e.$comingSoon&&e.$comingSoon(...d)),disabled:!0,class:"outline-hidden size-icon-normal text-brand-900 disabled:opacity-60 disabled:cursor-default"},[c(r,{type:"line",name:"paperclip"})]),e.hasTyped?(t(),a("button",{key:0,disabled:e.state.isSubmitting,onClick:n[7]||(n[7]=(...d)=>e.submitForm&&e.submitForm(...d)),class:"outline-hidden size-icon-normal text-brand-900 disabled:opacity-60 disabled:cursor-wait"},[c(r,{type:"solid",name:"send-03"})],8,hs)):(t(),a("button",gs,[c(r,{type:"line",name:"microphone-01"})]))])])])],2)}const vs=S(as,[["render",_s]]),fs=A({setup:function(e,n){const o=Y({isLoading:!0,typing:{is_typing:!1,user:null},mainMenu:ie()}),_=se(),p=N(),v=Z(),g=re(),r=T(_.userData),u=h(()=>p.chatData),d=h(()=>u.value.is_group),y=h(()=>p.chatMessages),C=T(null),D=function(){ce(()=>{C.value.scrollTop=C.value.scrollHeight})};le(()=>{window.ColibriBRConnected&&(k(w.getEvent("CHAT_MESSAGE_RECEIVED")),k(w.getEvent("CHAT_MESSAGE_READ")),k(w.getEvent("CHAT_MESSAGE_DELETED")),z(w.getEvent("CHAT_MESSAGE_TYPING")))}),x(async function(){try{await p.fetchChatData(g.params.chat_id),await p.fetchChatMessages(),y.value.length>0&&(p.markMessagesAsRead(),debounce(()=>{D()},500)),o.isLoading=!1,window.ColibriBRConnected&&(B(w.getEvent("CHAT_MESSAGE_RECEIVED"),function(i){let $=i.data;p.appendMessage($),D(),r.value.id==$.user_id||(ee.activeChatMessageReceived(),p.markMessagesAsRead())}),B(w.getEvent("CHAT_MESSAGE_DELETED"),function(i){p.markMessageAsDeleted(i.data.message_id)}),P(w.getEvent("CHAT_MESSAGE_TYPING"),function(i){o.typing=i.data}),B(w.getEvent("CHAT_MESSAGE_READ"),function(i){p.updateLastReadMessageForParticipant(i.data)}))}catch{v.push({name:"error_404",params:{pathMatch:g.path.substring(1).split("/")},query:g.query,hash:g.hash})}});const k=i=>{ColibriBRD.private(w.getChannel("CHAT",[u.value.chat_id])).stopListening(i)},B=(i,$)=>{ColibriBRD.private(w.getChannel("CHAT",[u.value.chat_id])).listen(i,$)},z=i=>{ColibriBRD.private(w.getChannel("CHAT",[u.value.chat_id])).stopListeningForWhisper(i)},P=(i,$)=>{ColibriBRD.private(w.getChannel("CHAT",[u.value.chat_id])).listenForWhisper(i,$)},I=(i,$)=>{ColibriBRD.private(w.getChannel("CHAT",[u.value.chat_id])).whisper(i,$)},R=i=>{I(w.getEvent("CHAT_MESSAGE_TYPING"),{data:{user:{name:r.value.name,avatar_url:r.value.avatar_url},is_typing:i}})};return{state:o,chatData:u,chatMessages:y,isGroup:d,chatContainerBlock:C,isTyping:h(()=>o.typing.is_typing),toggleMainMenu:()=>{o.mainMenu.toggle()},handleMessageDelete:i=>{const $={title:__t("prompt.delete_message.title"),description:i.isSender?__t("prompt.delete_message.description"):__t("prompt.delete_message_for_me.description"),confirmButtonText:i.isSender?null:__t("prompt.delete_message_for_me.confirm"),onConfirm:async()=>{await p.deleteMessage(i.messageId),toastSuccess(__t("toast.chat.message_deleted"),1e3)}};i.isSender&&($.confirmSecondary=!0,$.confirmSecondaryText=__t("chat.delete_message_for_all"),$.onConfirmSecondary=async()=>{await p.deleteMessage(i.messageId,!0)}),K.emit("confirmation-modal:open",$)},handleMessageReply:i=>{K.emit("messenger-message:reply",{messageData:i})},handleMessageCopy:i=>{navigator.clipboard.writeText(i.content).then(()=>{toastSuccess(__t("toast.chat.message_text_copied"),1e3)})},handleMessageTyping:()=>{window.ColibriBRConnected&&(R(!0),debounce(()=>{R(!1)},1e3))},showDateSeparator:i=>i>0&&y.value[i-1].date.generic!==y.value[i].date.generic,isCompacted:i=>i>0&&y.value[i-1].user_id===y.value[i].user_id}},components:{ChatHeader:Re,ChatOverview:tt,ChatMessage:Nt,ChatMessageTyping:Kt,ChatForm:vs,ChatHeaderSkeleton:he,ChatFormSkeleton:Be,ChatOverviewSkeleton:ze,ChatMessageSkeleton:je,ChatInfo:O(()=>F(()=>import("./ChatInfo-DdN3nLYM.js"),__vite__mapDeps([13,14,1,2,7,6,8,15,16,17,18,19,20,4])))}}),ys={class:"h-screen overflow-hidden flex"},ks={class:"flex flex-1 h-full flex-col"},bs={class:"border-b border-bord-pr shrink-0"},Cs={ref:"chatContainerBlock",class:"flex-1 overflow-x-hidden overflow-y-auto py-4"},$s={class:"border-b border-bord-pr py-8"},Ds={class:"pb-24 pt-2"},ws={key:0,class:"flex flex-col gap-4 opacity-70"},Ms={key:1},Ts={class:"block"},Ss={key:0,class:"py-4"},Rs={class:"text-par-n font-semibold text-lab-pr3 text-center"},Es={key:1,class:"py-12 text-center"},Ps={class:"text-par-s text-lab-sc"},As={class:"shrink-0"},Bs={key:0,class:"w-messenger-sidebar h-full overflow-y-auto border-l border-l-bord-pr"};function Is(e,n,o,_,p,v){const g=l("ChatHeaderSkeleton"),r=l("ChatHeader"),u=l("ChatOverviewSkeleton"),d=l("ChatOverview"),y=l("ChatMessageSkeleton"),C=l("ChatMessage"),D=l("ChatMessageTyping"),k=l("ChatFormSkeleton"),B=l("ChatForm"),z=l("ChatInfo");return t(),a("div",ys,[s("div",ks,[s("div",bs,[e.state.isLoading?(t(),b(g,{key:0})):(t(),b(r,{key:1,onInfo:e.toggleMainMenu,typingUser:e.state.typing},null,8,["onInfo","typingUser"]))]),s("div",Cs,[s("div",$s,[e.state.isLoading?(t(),b(u,{key:0})):(t(),b(d,{key:1}))]),s("div",Ds,[e.state.isLoading?(t(),a("div",ws,[(t(),a(M,null,X(3,P=>c(y)),64))])):(t(),a("div",Ms,[e.chatMessages.length?(t(!0),a(M,{key:0},X(e.chatMessages,(P,I)=>(t(),a("div",Ts,[e.showDateSeparator(I)?(t(),a("div",Ss,[s("p",Rs,f(P.date.date),1)])):m("",!0),(t(),b(C,{onDelete:e.handleMessageDelete,onReply:e.handleMessageReply,onCopy:e.handleMessageCopy,isCompacted:e.isCompacted(I),messageData:P,key:P.id},null,8,["onDelete","onReply","onCopy","isCompacted","messageData"]))]))),256)):(t(),a("div",Es,[s("p",Ps,f(e.$t("chat.no_messages_found")),1)])),e.isTyping?(t(),b(D,{key:2,typingUser:e.state.typing},null,8,["typingUser"])):m("",!0)]))])],512),s("div",As,[e.state.isLoading?(t(),b(k,{key:0})):(t(),b(B,{key:1,onTyping:e.handleMessageTyping},null,8,["onTyping"]))])]),e.isGroup?m("",!0):(t(),a(M,{key:0},[e.state.mainMenu.status?(t(),a("div",Bs,[c(z,{onClose:e.state.mainMenu.close},null,8,["onClose"])])):m("",!0)],64))])}const Ls=S(fs,[["render",Is]]),Gs=Object.freeze(Object.defineProperty({__proto__:null,default:Ls},Symbol.toStringTag,{value:"Module"}));export{tt as C,Gs as M};
