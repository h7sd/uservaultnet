const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PublicationVideoProcessing-xhLmdKQ7.js","assets/global.properties-ieI6Xwik.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/PollVoterUsers-r-bUEB8I.js","assets/AvatarExtraSmall-Cf0UikId.js","assets/ReactionsViewer-DCDPlTYr.js","assets/ReactionsPicker-CKtpMYKN.js","assets/smileys-and-emotions-Beo3QNJK.js","assets/PublicationShare-C89ExuU5.js","assets/application-B35z453N.js","assets/swiper-element-bundle-DBu82uhE.js","assets/application-3Wj8EdJU.css","assets/MarginalTextButton-Cjg6Hj8c.js","assets/SheetTitle-Cb1vf6Xi.js","assets/PublicationReactions-q2o1GLqN.js","assets/PublicationAudio-YHwLPdLs.js","assets/media.status-D6lx-p4W.js","assets/PublicationQuote-1mgqiA4b.js","assets/ProgressiveImageLoader-DUluSfqC.js","assets/SpinnerIcon-D3U9frcO.js","assets/VideoDurationTime-CY2-hNg2.js","assets/PublicationQuotePlaceholder-DymO4nFL.js"])))=>i.map(i=>d[i]);
import{k as ce,l as L,_ as $,d as P,r,e as f,o,q as T,b as h,c as i,j as n,m as _,n as D,t as b,U as de,g as E,h as N,i as S,F as C,a as u,I as ue,G as pe,y as w,z as I,p as z,Q as me,x as he,v as W,w as M,B as q,K as _e,u as V,M as U,P as ve}from"./global.properties-ieI6Xwik.js";import{a as B,j as J,i as X,d as K,c as fe,l as be}from"./application-B35z453N.js";import{A as ye}from"./AvatarRightSided-DIsCtZes.js";import{c as ke}from"./index-DyH4rDzV.js";import{M as $e}from"./mention.plugin-6T_AP_1M.js";import{A as Pe}from"./index-CZvQntMR.js";import{P as ge}from"./ProgressiveImageLoader-DUluSfqC.js";import{M as Ce}from"./media.status-D6lx-p4W.js";import{u as Se}from"./index-Dun6B87D.js";import we from"./VideoDurationTime-CY2-hNg2.js";import{S as Ie}from"./SpinnerIcon-D3U9frcO.js";import{G as Me}from"./GiphyAttribution-Cv2rUDbj.js";import{D as Y}from"./DropdownButton-b5Hfnztp.js";import Te from"./LinkSnapshot-CKRJS_OO.js";import{V as De}from"./ViewsCounter-7KyRmWQv.js";import{A as Z,a as Le}from"./AvatarExtraSmall-Cf0UikId.js";import{S as Ae}from"./SheetTitle-Cb1vf6Xi.js";import{T as Re}from"./TimelineEmptyState-D2cMbIuH.js";import{u as Ve}from"./index-CaocF3Et.js";import{L as Ee}from"./TimelinePublicationSkeleton-BlliYZGM.js";const ee=ce("mobile_timeline_store",{deleteAware:!0,state:function(){return{posts:[],update:[],filter:{page:1}}},actions:{updateFeed:async function(){await L().userTimeline().params({filter:{onset:this.posts.at(0).id}}).getFrom("feed").then(e=>{this.update=e.data.data}).catch(e=>{e.response&&(this.update=[])})},applyUpdate:function(){this.update.forEach(e=>{this.posts.slice(0,this.update.length).some(p=>p.id===e.id)||this.posts.unshift(e)}),this.update=[]},initialLoad:async function(){let e=this;e.posts.length||this.load().then(function(t){e.posts=t.data.data}).catch(function(t){e.posts=[]})},loadNextPage:async function(){return this.filter.page+=1,await this.load()},load:async function(){return await L().userTimeline().params({filter:this.filter}).getFrom("feed")},appendPosts:function(e){this.posts=this.posts.concat(e)},prependPost:function(e){return this.posts.unshift(e),this.posts},removePost:function(e){let t=this.posts.findIndex(p=>p.id==e);t!==-1&&this.posts.splice(t,1)},updatePoll:function(e){const t=this.posts.find(p=>p.id==e.post_id);t&&(t.relations.poll=e)},updateCommentCount:function(e,t){const p=this.posts.find(s=>s.id==e);p&&(p.comments_count=t)}}}),Be=P({props:{postData:{type:Object,required:!0}},setup:e=>{const t=T(e.postData);return{postUserCaption:h(()=>`${t.value.relations.user.caption} · ${t.value.date.time_ago}`)}},components:{AvatarRightSided:ye}});function xe(e,t,p,s,c,m){const a=r("AvatarRightSided");return o(),f(a,{linkRoute:{name:"profile_index",params:{id:e.postData.relations.user.username}},avatarSrc:e.postData.relations.user.avatar_url,name:e.postData.relations.user.name,caption:e.postData.relations.user.caption,verified:e.postData.relations.user.verified},null,8,["linkRoute","avatarSrc","name","caption","verified"])}const Oe=$(Be,[["render",xe]]),Ue=P({props:{postContent:{type:String,default:""}},setup:function(e){const t=new de({html:!0,breaks:!0,linkify:!0});t.use($e);const p=E({textExpanded:!1,textOverflow:!1}),s=T(null),c=h(()=>e.postContent);return N(()=>{p.textOverflow=ke(s.value,12)}),{state:p,markdownRenderer:()=>t.renderInline(c.value),publicationTextHolder:s}}}),ze={class:"markdown-text"},Ne=["innerHTML"],qe={key:0,class:"block opacity-90"};function je(e,t,p,s,c,m){return o(),i("div",ze,[n("div",{ref:"publicationTextHolder",class:D([[e.state.textExpanded?"":"line-clamp-[12]"],"leading-5 text-lab-pr2 text-par-m font-normal publication-text break-words"]),innerHTML:e.markdownRenderer()},null,10,Ne),e.state.textOverflow?(o(),i("div",qe,[n("button",{onClick:t[0]||(t[0]=a=>e.state.textExpanded=!e.state.textExpanded),class:"text-par-s text-brand-900 underline outline-hidden font-light"},b(e.state.textExpanded?e.$t("labels.show_less"):e.$t("labels.show_more")),1)])):_("",!0)])}const He=$(Ue,[["render",je]]),Fe=P({props:{postMedia:{type:Array,default:{}},isSensitive:{type:Boolean,default:!1}},setup:function(e){return{postMedia:h(()=>Pe.make(e.postMedia).chunk(5).value())}},components:{ProgressiveImageLoader:ge}}),Ge={key:0,class:"block"},Qe={key:1},Ke={class:"grid grid-cols-2 gap-px"},We={key:2},Je={class:"grid grid-cols-3 gap-px"},Xe={key:3},Ye={class:"grid grid-cols-3 gap-px"},Ze={key:4},et={class:"grid grid-cols-3 gap-px mb-px"},tt={class:"grid grid-cols-2 gap-px"};function ot(e,t,p,s,c,m){const a=r("ProgressiveImageLoader");return o(!0),i(C,null,S(e.postMedia,(l,v)=>(o(),i("div",{key:v},[l.length==1?(o(),i("div",Ge,[(o(!0),i(C,null,S(l,d=>(o(),i("div",{key:d.id,class:D(["overflow-hidden",[e.postMedia.length>1?"mt-px":""]])},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover",alt:"Image"},null,8,["base64Image","src","isSensitive"])],2))),128))])):l.length==2?(o(),i("div",Qe,[n("div",Ke,[(o(!0),i(C,null,S(l,d=>(o(),i("div",{key:d.id,class:"overflow-hidden max-h-96"},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover",alt:"Image"},null,8,["base64Image","src","isSensitive"])]))),128))])])):l.length==3?(o(),i("div",We,[n("div",Je,[(o(!0),i(C,null,S(l,(d,g)=>(o(),i("div",{key:d.id,class:D(["aspect-square overflow-hidden",{"col-span-2 row-span-2":g==0}])},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover",alt:"Image"},null,8,["base64Image","src","isSensitive"])],2))),128))])])):l.length==4?(o(),i("div",Xe,[n("div",Ye,[(o(!0),i(C,null,S(l,(d,g)=>(o(),i("div",{key:d.id,class:D(["aspect-square overflow-hidden",{"col-span-3":g==3}])},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover",alt:"Image"},null,8,["base64Image","src","isSensitive"])],2))),128))])])):l.length==5?(o(),i("div",Ze,[n("div",et,[(o(!0),i(C,null,S(l.slice(0,3),d=>(o(),i("div",{key:d.id,class:"aspect-square overflow-hidden"},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover",alt:"Image"},null,8,["base64Image","src","isSensitive"])]))),128))]),n("div",tt,[(o(!0),i(C,null,S(l.slice(3),d=>(o(),i("div",{key:d.id,class:"col-span-1 overflow-hidden"},[u(a,{base64Image:d.lqip_base64,src:d.source_url,isSensitive:e.isSensitive,class:"block size-full object-cover max-h-60",alt:"Image"},null,8,["base64Image","src","isSensitive"])]))),128))])])):_("",!0)]))),128)}const nt=$(Fe,[["render",ot]]),st=P({props:{videoUrl:{type:String,required:!0},duration:{type:Object,required:!0},thumbnailUrl:{type:String,required:!0}},setup:function(e,t){const{isIntersecting:p,videoPlayerRef:s}=Se({threshold:.5}),c=E({isMuted:!1,isLoaded:!1,isPlaying:!1,progressBar:0,playbackTime:0});function m(){function k(){const y=s.value.currentTime,R=s.value.duration;c.progressBar=Math.round(y/R*100),c.playbackTime=Math.round(y),c.isPlaying&&(window.colibriVideoTimer=requestAnimationFrame(k))}window.colibriVideoTimer=requestAnimationFrame(k)}function a(){cancelAnimationFrame(window.colibriVideoTimer)}ue(p,k=>{k&&c.isLoaded?v():d()}),N(()=>{s.value.addEventListener("loadedmetadata",()=>{c.isLoaded=!0})}),pe(()=>{s.value&&(s.value.removeEventListener("loadedmetadata",v),d())});const l=()=>{localStorage.getItem("videoPlayerMuted")?(c.isMuted=!0,s.value.muted=!0):(s.value.muted=!1,c.isMuted=!1)},v=()=>{c.isLoaded&&s.value.play().then(()=>{l(),c.isPlaying=!0,m()}).catch(k=>{k.name==="NotAllowedError"&&console.info("Cannot play video because user has not interacted with the page yet")})},d=()=>{s.value.pause(),c.isPlaying=!1,a()};return{videoPlayerRef:s,state:c,toggleMute:()=>{c.isMuted=!c.isMuted,s.value.muted=c.isMuted,c.isMuted?localStorage.setItem("videoPlayerMuted",1):localStorage.removeItem("videoPlayerMuted")},togglePlay:()=>{c.isLoaded&&(c.isPlaying?d():v())}}},components:{SpinnerIcon:Ie,PrimaryIconButton:B,VideoDurationTime:we}}),at={class:"relative flex justify-center cursor-pointer"},it=["poster"],lt=["src"],rt={key:0,class:"absolute backdrop-blur-xs inset-0 flex-center w-full h-full bg-black/50"},ct={class:"size-8"},dt={class:"from-black/60 to-transparent bg-gradient-to-t absolute bottom-0 left-0 right-0 px-2 pb-2 pt-6"},ut={class:"flex items-center justify-between"},pt={class:"ml-2 inline-flex items-center gap-2"};function mt(e,t,p,s,c,m){const a=r("SpinnerIcon"),l=r("VideoDurationTime"),v=r("PrimaryIconButton");return o(),i("div",at,[n("video",{onClick:t[0]||(t[0]=(...d)=>e.togglePlay&&e.togglePlay(...d)),class:"w-full",ref:"videoPlayerRef","webkit-playsinline":"",playsinline:"",poster:e.thumbnailUrl,loop:"loop"},[n("source",{src:e.videoUrl,type:"video/mp4"},null,8,lt)],8,it),e.state.isLoaded?_("",!0):(o(),i("div",rt,[n("div",ct,[u(a,{strokeColor:"stroke-white",strokeWidth:"1"})])])),n("div",dt,[n("div",ut,[n("div",pt,[e.state.isPlaying?(o(),f(l,{key:0,videoDuration:e.$filters.secondsToDuration(e.state.playbackTime)},null,8,["videoDuration"])):(o(),f(l,{key:1,videoDuration:e.duration},null,8,["videoDuration"]))]),u(v,{onClick:e.toggleMute,iconName:e.state.isMuted?"volume-x":"volume-max",buttonColor:"text-white",iconSize:"icon-small",hoverText:"hover:text-white/80"},null,8,["onClick","iconName"])])])])}const ht=$(st,[["render",mt]]),_t=P({props:{postMedia:{type:Object,default:{}}},setup:function(e){return{mediaItem:h(()=>e.postMedia[0]),MediaStatusUtils:Ce}},components:{VideoPlayer:ht,PublicationVideoProcessing:w(()=>I(()=>import("./PublicationVideoProcessing-xhLmdKQ7.js"),__vite__mapDeps([0,1,2])))}}),vt={class:"flex"},ft={key:1,class:"overflow-hidden"};function bt(e,t,p,s,c,m){const a=r("PublicationVideoProcessing"),l=r("VideoPlayer");return o(),i("div",vt,[e.MediaStatusUtils.isProcessing(e.mediaItem.status)?(o(),f(a,{key:0,mediaItem:e.mediaItem},null,8,["mediaItem"])):(o(),i("div",ft,[u(l,{thumbnailUrl:e.mediaItem.thumbnail_url,duration:e.mediaItem.metadata.duration,videoUrl:e.mediaItem.source_url},null,8,["thumbnailUrl","duration","videoUrl"])]))])}const yt=$(_t,[["render",bt]]),kt=P({props:{postMedia:{type:Array,default:{}}},setup:function(e){return{mediaItem:h(()=>e.postMedia[0])}},components:{GiphyAttribution:Me}}),$t={class:"min-h-44 bg-fill-qt relative cursor-pointer"},Pt=["src"],gt={class:"absolute bottom-2 left-2 inline-block z-10"};function Ct(e,t,p,s,c,m){const a=r("GiphyAttribution");return o(),i("div",$t,[n("img",{src:e.mediaItem.source_url,class:"block size-full object-cover",alt:"Image"},null,8,Pt),n("div",gt,[u(a)])])}const St=$(kt,[["render",Ct]]),wt=P({props:{postMedia:{type:Object,default:{}}},setup:function(e){return{postMedia:h(()=>e.postMedia)}},components:{PrimaryIconButton:B}}),It={class:"size-10 shrink-0"},Mt={class:"flex-1 pr-3 overflow-hidden pl-1"},Tt={class:"text-lab-pr2 text-par-s block font-medium mb-1.5 truncate capitalize"},Dt={class:"text-lab-sc text-cap-l block truncate"},Lt={class:"uppercase"},At=["title"],Rt=["href","download"];function Vt(e,t,p,s,c,m){const a=r("FileFormatIcon");return o(!0),i(C,null,S(e.postMedia,l=>(o(),i("div",{key:l.id,class:"overflow-hidden py-1 px-4"},[n("div",{class:D(["flex items-center leading-none",{"opacity-50":l.deleted}])},[n("div",It,[u(a,{extension:l.extension},null,8,["extension"])]),n("div",Mt,[n("span",Tt,b(l.metadata.file_name),1),n("span",Dt,[n("span",Lt,[z(b(e.$filters.fileSize(l.size))+" - "+b(l.extension)+" ",1),l.metadata.downloads?(o(),i("span",{key:0,title:e.$t("labels.downloads_count",{count:l.metadata.downloads??2})}," / "+b(l.metadata.downloads)+" ↓ ",9,At)):_("",!0)]),t[0]||(t[0]=z(" - ")),n("a",{class:"text-brand-900",href:l.source_url,download:l.metadata.file_name},b(e.$t("labels.download")),9,Rt)])])],2)]))),128)}const Et=$(wt,[["render",Vt]]),Bt=P({props:{choiceItem:{type:Object,default:{}},index:{type:Number,default:0},hasVotedPoll:{type:Boolean,default:!1}},emits:["vote"],setup:function(e,t){return{choiceItem:h(()=>e.choiceItem),vote:function(s){t.emit("vote",s)}}}}),xt={class:"block"},Ot={class:"h-full absolute top-0 left-0 rounded-xs overflow-hidden w-full flex"},Ut={class:"flex justify-between text-lab-sc overflow-hidden items-center"},zt={class:"text-par-n font-medium flex-1 truncate mr-4 leading-normal"};function Nt(e,t,p,s,c,m){return o(),i("div",xt,[n("div",{onClick:t[0]||(t[0]=a=>e.vote(e.index)),class:D(["px-4 py-2.5 border border-bord-pr overflow-hidden rounded-xl relative",[e.choiceItem.has_voted_choice?"border-brand-900/15":"border-bord-pr",e.hasVotedPoll?"cursor-default opacity-80":"cursor-pointer"]])},[n("div",Ot,[n("div",{class:D(["max-w-full h-full bg-bord-pr",[e.choiceItem.has_voted_choice?"bg-brand-900/15":"bg-bord-tr"]]),style:me({width:`${e.choiceItem.percentage}%`})},null,6)]),n("div",Ut,[n("span",zt,b(e.choiceItem.choice_text),1),n("span",{class:D(["text-par-s",[e.choiceItem.has_voted_choice?"text-lab-pr font-semibold":"text-lab-sc"]])},b(e.choiceItem.percentage)+"%",3)])],2)])}const qt=$(Bt,[["render",Nt]]),jt=P({props:{postPoll:{type:Object,default:{}}},setup:function(e){const t=h(()=>e.postPoll),p=ee(),s=h(()=>t.value.has_voted);return{postPoll:t,pollChoices:h(()=>t.value.choices),pollVotesTotal:h(()=>t.value.votes.length),hasVotedPoll:s,votePoll:c=>{s.value||L().userTimeline().with({choice_id:c,poll_id:t.value.id}).sendTo("post/poll/vote").then(m=>{p.updatePoll(m.data.data)})},pollHasVoters:h(()=>t.value.voter_users.length>0)}},components:{PollChoiceItem:qt,PollVoterUsers:w(()=>I(()=>import("./PollVoterUsers-r-bUEB8I.js"),__vite__mapDeps([3,4,1,2])))}}),Ht={class:"px-4"},Ft={class:"mb-2 flex items-center gap-1 text-lab-sc"},Gt={class:"size-icon-x-small shrink-0"},Qt={class:"text-par-s"},Kt={class:"block mb-2"},Wt={class:"text-center text-cap-l text-lab-sc"},Jt={key:0,class:"mt-2"};function Xt(e,t,p,s,c,m){const a=r("SvgIcon"),l=r("PollChoiceItem"),v=r("PollVoterUsers");return o(),i("div",Ht,[n("div",Ft,[n("span",Gt,[u(a,{type:"line",name:"bar-chart-12",classes:"size-full"})]),n("span",Qt,b(e.$t("labels.public_poll")),1)]),n("div",Kt,[(o(!0),i(C,null,S(e.pollChoices,(d,g)=>(o(),i("div",{key:g,class:"mb-2 last:mb-0"},[u(l,{hasVotedPoll:e.hasVotedPoll,onVote:e.votePoll,index:g,choiceItem:d},null,8,["hasVotedPoll","onVote","index","choiceItem"])]))),128))]),n("div",Wt,b(e.$t("labels.votes_number",{number:e.pollVotesTotal}))+" - "+b(e.postPoll.is_expired?e.$t("labels.final_results"):e.$t("labels.active_poll")),1),e.pollHasVoters?(o(),i("div",Jt,[u(v,{voterUsers:e.postPoll.voter_users},null,8,["voterUsers"])])):_("",!0)])}const Yt=$(jt,[["render",Xt]]),Zt=P({props:{buttonText:{type:String,default:"Label"},buttonColor:{type:String,default:"text-brand-900"},buttonType:{type:String,default:"button"}}}),eo=["type"];function to(e,t,p,s,c,m){return o(),i("button",{class:D(["text-par-n font-medium cursor-pointer hover:text-brand-900",[e.buttonColor]]),type:e.buttonType},b(e.buttonText),11,eo)}const oo=$(Zt,[["render",to]]),no=P({props:{commentContent:{type:String,required:!0}}}),so={class:"block"},ao=["innerHTML"];function io(e,t,p,s,c,m){return o(),i("div",so,[n("p",{class:"text-par-m text-lab-pr",innerHTML:e.$mdInline(e.commentContent)},null,8,ao)])}const lo=$(no,[["render",io]]),ro=P({props:{commentData:{type:Object,default:{}}},emits:["reply","delete"],setup:function(e,t){const p=T(e.commentData),s=E({isMenuOpen:!1,isReactionPickerOpen:!1}),c=function(){s.isReactionPickerOpen=!0},m=function(){s.isReactionPickerOpen=!1};return{state:s,commentData:p,closeReactionsPicker:m,openReactionsPicker:c,hasReactions:h(()=>p.value.relations.reactions.length),reply:()=>{q.emit("publication-comment:reply",{commentData:p.value})},toggleMenu:()=>{debounce(()=>{s.isMenuOpen=!s.isMenuOpen},50)},copyCommentText:()=>{try{navigator.clipboard.writeText(p.value.content).then(()=>{toastSuccess(__t("toast.comment.comment_text_copied"),1e3)})}catch(a){toastError(a)}},canDeleteComment:h(()=>p.value.meta.permissions.can_delete),deleteComment:()=>{t.emit("delete",p.value.id)},addReaction:a=>{m(),L().userTimeline().with({unified_id:a,comment_id:p.value.id}).sendTo("comment/reaction/add").then(l=>{p.value.relations.reactions=l.data.data}).catch(l=>{l.response&&toastError(l.response.data.message)})}}},components:{ReactionsViewer:w(()=>I(()=>import("./ReactionsViewer-DCDPlTYr.js"),__vite__mapDeps([5,1,2]))),ReactionsPicker:w(()=>I(()=>import("./ReactionsPicker-CKtpMYKN.js"),__vite__mapDeps([6,7,1,2]))),AvatarExtraSmall:Z,PrimaryIconButton:B,ActionSheet:K,ActionSheetItem:X,ActionSheetGroup:J,MarginalTextButton:oo,CommentText:lo,DropdownButton:Y}}),co={class:"flex px-4 py-2 select-none active:bg-fill-qt relative"},uo={class:"w-avatar-small shrink-0"},po={class:"flex-1 overflow-hidden pl-2"},mo={class:"block leading-none mb-1"},ho={class:"inline-flex items-center gap-1"},_o={class:"text-par-n font-semibold text-lab-pr2"},vo={class:"text-par-s text-lab-sc"},fo={key:0,class:"overflow-hidden mb-1"},bo={class:"cursor-pointer"},yo={key:0,class:"text-cap-l text-lab-sc break-words italic"},ko={class:"inline-flex items-center gap-1 text-par-s font-semibold text-brand-900 leading-none"},$o={class:"text-par-n text-lab-pr3 break-words line-clamp-1"},Po={key:1},go={key:0,class:"mt-2"},Co={key:2},So={class:"absolute top-1 right-4 opacity-40 active:opacity-100"},wo={key:0,class:"mt-4"};function Io(e,t,p,s,c,m){const a=r("AvatarExtraSmall"),l=r("SvgIcon"),v=r("CommentText"),d=r("ReactionsViewer"),g=r("MarginalTextButton"),k=r("DropdownButton"),y=r("ActionSheetItem"),R=r("ActionSheetGroup"),x=r("ActionSheet"),j=r("ReactionsPicker"),H=he("longpress");return o(),i(C,null,[W((o(),i("div",co,[n("div",uo,[u(a,{avatarSrc:e.commentData.relations.user.avatar_url},null,8,["avatarSrc"])]),n("div",po,[n("div",mo,[n("div",ho,[n("h3",_o,b(e.commentData.relations.user.name),1),n("span",vo,b(e.commentData.date.time_ago),1)])]),e.commentData.has_parent?(o(),i("div",fo,[n("div",bo,[e.commentData.deleted?(o(),i("p",yo,b(e.$t("labels.comment_was_deleted")),1)):(o(),i(C,{key:1},[n("h3",ko,[u(l,{name:"share-06",type:"line",classes:"size-icon-x-small transform -scale-x-100"}),z(" "+b(e.commentData.relations.parent.user.name),1)]),n("p",$o,b(e.commentData.relations.parent.content),1)],64))])])):_("",!0),u(v,{commentContent:e.commentData.content},null,8,["commentContent"]),e.commentData.deleted?_("",!0):(o(),i("div",Po,[e.hasReactions?(o(),i("div",go,[u(d,{onAdd:e.addReaction,reactions:e.commentData.relations.reactions},null,8,["onAdd","reactions"])])):_("",!0)])),e.commentData.deleted?_("",!0):(o(),i("div",Co,[u(g,{buttonColor:"text-lab-sc/70",onClick:e.reply,buttonText:e.$t("labels.reply")},null,8,["onClick","buttonText"])]))]),n("div",So,[u(k,{onClick:e.toggleMenu},null,8,["onClick"])])])),[[H,e.openReactionsPicker]]),e.state.isMenuOpen?(o(),f(x,{key:0,onClose:e.toggleMenu,isMuted:!0},{default:M(()=>[n("div",{onClick:t[0]||(t[0]=(...F)=>e.toggleMenu&&e.toggleMenu(...F))},[u(R,null,{default:M(()=>[u(y,{onClick:e.openReactionsPicker,iconName:"heart-rounded",textLabel:e.$t("dd.add_reaction")},null,8,["onClick","textLabel"]),u(y,{onClick:e.reply,iconName:"pencil-line",textLabel:e.$t("dd.comment.reply_to_comment",{name:e.commentData.relations.user.name})},null,8,["onClick","textLabel"]),u(y,{onClick:e.copyCommentText,iconName:"type-01",textLabel:e.$t("dd.copy_text")},null,8,["onClick","textLabel"])]),_:1}),e.canDeleteComment?(o(),i("div",wo,[u(R,null,{default:M(()=>[u(y,{onClick:e.deleteComment,itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.comment.delete_comment")},null,8,["onClick","textLabel"])]),_:1})])):_("",!0)])]),_:1},8,["onClose"])):_("",!0),e.state.isReactionPickerOpen?(o(),f(x,{key:1,onClose:e.closeReactionsPicker},{default:M(()=>[u(j,{onAdd:e.addReaction},null,8,["onAdd"])]),_:1},8,["onClose"])):_("",!0)],64)}const Mo=$(ro,[["render",Io]]),To=P({props:{repliedComment:{type:Object,default:{}}},emits:["cancel"],components:{PrimaryIconButton:B}}),Do={class:"py-1 px-4 border-b border-bord-pr bg-fill-fv"},Lo={class:"flex overflow-hidden items-center"},Ao={class:"flex-1 overflow-hidden text-par-s"},Ro={class:"text-lab-sc"},Vo={class:"font-semibold text-lab-pr2"},Eo={class:"text-par-s text-lab-sc leading-none ml-1 font-normal"},Bo={class:"shrink-0"};function xo(e,t,p,s,c,m){const a=r("PrimaryIconButton");return o(),i("div",Do,[n("div",Lo,[n("div",Ao,[n("span",Ro,b(e.$t("labels.reply_to")),1),t[1]||(t[1]=z("   ")),n("span",Vo,b(e.repliedComment.relations.user.name),1),n("span",Eo,b(e.repliedComment.date.time_ago),1)]),n("div",Bo,[u(a,{onClick:t[0]||(t[0]=l=>e.$emit("cancel")),name:"x-close"})])])])}const Oo=$(To,[["render",xo]]),Uo=P({props:{postId:{type:Number,default:0}},emits:["created"],setup:function(e,t){const p=T(""),s=fe(),c=T(s.userData),m=T(e.postId),a=T(null),l=E({isSubmitting:!1}),{autoResize:v}=Ve(),d=T(null),g=function(){v(d.value)};return N(()=>{q.on("publication-comment:reply",k=>{a.value=k.commentData})}),{state:l,userData:c,commentInputText:p,repliedComment:a,commentInputHandler:g,commentTextInputField:d,submitComment:async()=>{if(p.value.length>0){l.isSubmitting=!0;let k=null;a.value&&(k=a.value.id),await L().userTimeline().with({post_id:m.value,content:p.value,parent_id:k}).sendTo("post/comment/create").then(y=>{t.emit("created",y.data.data),p.value="",v(d.value),a.value=null}).catch(y=>{y.response&&toastError(y.response.data.message)}),l.isSubmitting=!1}},cancelCommentReply:()=>{a.value=null}}},components:{AvatarExtraSmall:Z,PrimaryIconButton:B,ReplyPreview:Oo}}),zo={class:"px-4 flex items-start gap-3 pt-3 leading-none"},No={class:"shrink-0"},qo={class:"flex-1 overflow-hidden"},jo={class:"max-h-72 overflow-y-auto"},Ho=["placeholder"],Fo={class:"ml-auto shrink-0"};function Go(e,t,p,s,c,m){const a=r("ReplyPreview"),l=r("AvatarExtraSmall"),v=r("PrimaryIconButton");return o(),i("form",{onSubmit:t[2]||(t[2]=V((...d)=>e.submitComment&&e.submitComment(...d),["prevent"]))},[e.repliedComment?(o(),f(a,{key:0,repliedComment:e.repliedComment,onCancel:e.cancelCommentReply},null,8,["repliedComment","onCancel"])):_("",!0),n("div",zo,[n("div",No,[u(l,{avatarSrc:e.userData.avatar_url},null,8,["avatarSrc"])]),n("div",qo,[n("div",jo,[W(n("textarea",{ref:"commentTextInputField","onUpdate:modelValue":t[0]||(t[0]=d=>e.commentInputText=d),onInput:t[1]||(t[1]=(...d)=>e.commentInputHandler&&e.commentInputHandler(...d)),placeholder:e.$t("labels.enter_comment_placeholder")+"...",class:"pt-1 leading-6 bg-transparent outline-hidden w-full h-x-small-avatar min-h-x-small-avatar resize-none text-lab-pr text-par-l placeholder:text-par-n"},null,40,Ho),[[_e,e.commentInputText,void 0,{trim:!0}]])])]),n("div",Fo,[u(v,{disabled:e.state.isSubmitting||!e.commentInputText.length,onClick:e.submitComment,iconName:"send-03",iconSize:"icon-normal",buttonColor:"text-brand-900"},null,8,["disabled","onClick"])])])],32)}const Qo=$(Uo,[["render",Go]]),Ko=P({emits:["close"],props:{postData:{type:Object,required:!0}},setup:e=>{const t=h(()=>e.postData),p=ee(),s=E({isLoading:!0,isLoadingComments:!1,noMoreComments:!1}),c=T([]),m=async()=>{if(!s.noMoreComments&&!s.isLoadingComments){let a=0;c.value.length&&(a=c.value.at(-1).id),s.isLoadingComments=!0,await L().userTimeline().params({cursor:a}).getFrom(`post/${t.value.hash_id}/comments`).then(function(l){let v=l.data.data;v.length?c.value=c.value.concat(v):s.noMoreComments=!0}).catch(function(l){s.noMoreComments=!0}),s.isLoadingComments=!1}};return N(async()=>{await m(),debounce(()=>{s.isLoading=!1},100)}),{postComments:c,state:s,commentsCount:h(()=>t.value.comments_count),handleCommentDelete:a=>{q.emit("confirmation-modal:open",{title:__t("prompt.delete_comment.title"),description:__t("prompt.delete_comment.description"),onConfirm:()=>{L().userTimeline().with({id:a}).delete("post/comment/delete").then(l=>{p.updateCommentCount(t.value.id,l.data.data.post.comments_count);let v=c.value.findIndex(d=>d.id==a);v!==-1&&c.value.splice(v,1),c.value.forEach(function(d){d.parent_id&&d.parent_id==a&&(d.deleted=!0)}),toastSuccess(__t("toast.media.comment_deleted"))}).catch(l=>{l.response&&toastError(l.response.data.message)})}})},handleCommentCreate:a=>{c.value.unshift(a.comment),t.value.comments_count=a.post.comments_count},handleLoadMoreComments:async()=>{await m()}}},components:{ActionSheet:K,Comment:Mo,SheetTitle:Ae,TimelineEmptyState:Re,CommentEditor:Qo,LoadmoreButton:Ee}}),Wo={class:"h-full flex flex-col"},Jo={class:"px-4 pb-4 border-b border-b-bord-pr text-center"},Xo={key:0,class:"flex justify-center py-24"},Yo={class:"flex-1 overflow-y-auto"},Zo={key:0},en={key:0,class:"flex justify-center py-4"},tn={key:1,class:"py-42"},on={class:"shrink-0 border-t border-t-bord-pr"};function nn(e,t,p,s,c,m){const a=r("SheetTitle"),l=r("Comment"),v=r("LoadmoreButton"),d=r("TimelineEmptyState"),g=r("CommentEditor"),k=r("ActionSheet");return o(),f(k,{onClose:t[0]||(t[0]=y=>e.$emit("close"))},{default:M(()=>[n("div",Wo,[n("div",Jo,[u(a,{title:e.$t("labels.comments")},null,8,["title"])]),e.state.isLoading?(o(),i("div",Xo,t[1]||(t[1]=[n("div",{class:"colibri-primary-animation"},null,-1)]))):(o(),i(C,{key:1},[n("div",Yo,[e.postComments.length?(o(),i("div",Zo,[(o(!0),i(C,null,S(e.postComments,(y,R)=>(o(),i("div",null,[(o(),f(l,{onDelete:e.handleCommentDelete,key:y.id,commentData:y},null,8,["onDelete","commentData"]))]))),256)),e.state.isLoadingComments?(o(),i("div",en,t[2]||(t[2]=[n("div",{class:"colibri-primary-animation"},null,-1)]))):(o(),i(C,{key:1},[e.state.noMoreComments?_("",!0):(o(),f(v,{key:0,onClick:e.handleLoadMoreComments},null,8,["onClick"]))],64))])):(o(),i("div",tn,[u(d,{desc:e.$t("empty_state.comments.desc")},null,8,["desc"])]))]),n("div",on,[u(g,{onCreated:e.handleCommentCreate,postId:e.postData.id},null,8,["onCreated","postId"])])],64))])]),_:1})}const sn=$(Ko,[["render",nn]]),an=P({props:{postData:{type:Object,default:{}}},emits:["delete"],setup:function(e){const t=be(),p=E({shareMenu:U(),commentsMenu:U(),reactionMenu:U(),mainMenu:U()}),s=h(()=>e.postData),c=h(()=>base_url(`publication/${s.value.hash_id}`)),m=h(()=>s.value.content);return{postContent:m,PostTypeUtils:ve,postData:s,state:p,postHasContent:h(()=>s.value.content.length),postLink:c,quotedPost:h(()=>s.value.relations.quoted_post),postMedia:h(()=>s.value.relations.media),postPoll:h(()=>s.value.relations.poll),isSensitive:h(()=>s.value.meta.is_sensitive),postLinkSnapshot:h(()=>s.value.relations.link_snapshot),postReactions:h(()=>s.value.relations.reactions),canDeletePost:h(()=>s.value.meta.permissions.can_delete),canReportPost:h(()=>s.value.meta.permissions.can_report),addReaction:a=>{p.reactionMenu.close(),L().userTimeline().with({unified_id:a,post_id:s.value.id}).sendTo("post/reaction/add").then(l=>{s.value.relations.reactions=l.data.data}).catch(l=>{l.response&&toastError(l.response.data.message)})},lightboxImages:()=>{t.add({albumName:`${s.value.relations.user.name} ${s.value.relations.user.caption}`,date:s.value.date.iso,images:s.value.relations.media.map(a=>a.source_url)})},reportPost:()=>{q.emit("report:open",{type:"post",reportableId:s.value.id})},bookmarkPost:()=>{L().userTimeline().with({id:s.value.id}).sendTo("post/bookmarks/add").then(a=>{s.value.meta.activity.bookmarked=a.data.data.bookmarked,a.data.data.bookmarked?toastSuccess(__t("toast.post.bookmarked")):toastError(__t("toast.post.unbookmarked"))}).catch(a=>{a.response&&toastError(a.response.data.message)})},copyLink:()=>{try{navigator.clipboard.writeText(c.value).then(()=>{toastSuccess(__t("toast.post.link_copied"))})}catch(a){toastError(a)}},copyContent:()=>{try{navigator.clipboard.writeText(m.value).then(()=>{toastSuccess(__t("toast.post.content_copied"))})}catch(a){toastError(a)}}}},components:{PublicationHeader:Oe,PublicationText:He,PublicationImage:nt,PublicationVideo:yt,PublicationGif:St,PublicationDocument:Et,ActionSheetReactions:Le,PublicationPoll:Yt,DropdownButton:Y,LinkSnapshot:Te,PrimaryIconButton:B,ViewsCounter:De,ActionSheet:K,ActionSheetItem:X,ActionSheetGroup:J,PublicationComments:sn,ReactionsViewer:w(()=>I(()=>import("./ReactionsViewer-DCDPlTYr.js"),__vite__mapDeps([5,1,2]))),PublicationShare:w(()=>I(()=>import("./PublicationShare-C89ExuU5.js"),__vite__mapDeps([8,9,1,2,10,11,12,13]))),PublicationReactions:w(()=>I(()=>import("./PublicationReactions-q2o1GLqN.js"),__vite__mapDeps([14,9,1,2,10,11,6,7]))),PublicationAudio:w(()=>I(()=>import("./PublicationAudio-YHwLPdLs.js"),__vite__mapDeps([15,9,1,2,10,11,16]))),PublicationQuote:w(()=>I(()=>import("./PublicationQuote-1mgqiA4b.js"),__vite__mapDeps([17,1,2,4,18,19,20]))),PublicationQuotePlaceholder:w(()=>I(()=>import("./PublicationQuotePlaceholder-DymO4nFL.js"),__vite__mapDeps([21,1,2])))}}),ln={class:"base-publication min-h-40 border-b border-b-bord-tr"},rn={class:"pt-4 max-w-full"},cn={class:"flex overflow-hidden mb-2 px-4"},dn={class:"flex-1 pr-2"},un={class:"shrink-0"},pn={class:"relative leading-none"},mn={class:"opacity-30 hover:opacity-100"},hn={class:"max-w-full"},_n={key:0,class:"overflow-hidden mb-4 px-4"},vn={key:1,class:"mb-2"},fn={key:2,class:"overflow-hidden mb-4"},bn={key:3,class:"overflow-hidden mb-2 px-4"},yn=["href"],kn={key:4,class:"overflow-hidden mb-2 px-4"},$n={key:5,class:"px-4"},Pn={class:"pr-4 pl-3 mb-3"},gn={class:"flex items-center gap-1.5"},Cn={class:"shrink-0 relative leading-zero"},Sn={class:"shrink-0 leading-zero relative"},wn={class:"shrink-0 leading-zero relative"},In={class:"inline-flex items-center"},Mn={key:0,class:"text-lab-pr2 text-sm font-medium"},Tn={class:"shrink-0 ml-auto"},Dn={class:"mb-4"},Ln={class:"mb-4"},An={class:"mb-4"};function Rn(e,t,p,s,c,m){const a=r("PublicationHeader"),l=r("DropdownButton"),v=r("PublicationText"),d=r("PublicationImage"),g=r("PublicationGif"),k=r("PublicationVideo"),y=r("PublicationAudio"),R=r("PublicationDocument"),x=r("PublicationPoll"),j=r("LinkSnapshot"),H=r("PublicationQuote"),F=r("PublicationQuotePlaceholder"),te=r("ReactionsViewer"),G=r("PrimaryIconButton"),oe=r("ViewsCounter"),ne=r("PublicationReactions"),se=r("PublicationShare"),ae=r("PublicationComments"),ie=r("ActionSheetReactions"),A=r("ActionSheetItem"),le=r("RouterLink"),Q=r("ActionSheetGroup"),re=r("ActionSheet");return o(),i(C,null,[n("div",ln,[n("div",rn,[n("div",cn,[n("div",dn,[u(a,{postData:e.postData},null,8,["postData"])]),n("div",un,[n("div",pn,[n("div",mn,[u(l,{onClick:V(e.state.mainMenu.open,["stop"])},null,8,["onClick"])])])])]),n("div",hn,[e.postHasContent?(o(),i("div",_n,[u(v,{postContent:e.postContent},null,8,["postContent"])])):_("",!0),e.PostTypeUtils.isMedia(e.postData.type)?(o(),i("div",vn,[e.PostTypeUtils.isImage(e.postData.type)?(o(),i("div",{key:0,onClick:t[0]||(t[0]=(...O)=>e.lightboxImages&&e.lightboxImages(...O)),class:"cursor-pointer"},[(o(),f(d,{isSensitive:e.isSensitive,key:e.postData.hash_id,postMedia:e.postMedia},null,8,["isSensitive","postMedia"]))])):_("",!0),e.PostTypeUtils.isGif(e.postData.type)?(o(),f(g,{key:1,postMedia:e.postMedia},null,8,["postMedia"])):e.PostTypeUtils.isVideo(e.postData.type)?(o(),f(k,{key:2,postMedia:e.postMedia},null,8,["postMedia"])):e.PostTypeUtils.isAudio(e.postData.type)?(o(),f(y,{postMedia:e.postMedia,key:e.postData.id},null,8,["postMedia"])):e.PostTypeUtils.isDocument(e.postData.type)?(o(),f(R,{key:4,postMedia:e.postMedia},null,8,["postMedia"])):_("",!0)])):e.PostTypeUtils.isPoll(e.postData.type)?(o(),i("div",fn,[u(x,{postPoll:e.postPoll},null,8,["postPoll"])])):e.postLinkSnapshot?(o(),i("div",bn,[n("a",{href:e.postLinkSnapshot.url,target:"_blank"},[u(j,{linkSnapshot:e.postLinkSnapshot},null,8,["linkSnapshot"])],8,yn)])):e.postData.meta.is_quoting?(o(),i("div",kn,[e.quotedPost?(o(),f(H,{quotedPost:e.quotedPost,key:e.postData.id},null,8,["quotedPost"])):(o(),f(F,{key:1}))])):_("",!0),e.postReactions.length?(o(),i("div",$n,[u(te,{onAdd:e.addReaction,reactions:e.postReactions},null,8,["onAdd","reactions"])])):_("",!0),n("div",Pn,[n("div",gn,[n("div",Cn,[u(G,{onClick:V(e.state.reactionMenu.open,["stop"]),buttonColor:"text-lab-pr2",iconSize:"6",iconName:"heart-rounded",iconType:"line"},null,8,["onClick"])]),n("div",Sn,[u(G,{onClick:V(e.state.shareMenu.open,["stop"]),buttonColor:"text-lab-pr2",iconSize:"6",iconName:"share-06",iconType:"line"},null,8,["onClick"])]),n("div",wn,[n("div",In,[u(G,{onClick:V(e.state.commentsMenu.open,["stop"]),buttonColor:"text-lab-pr2",iconSize:"6",iconName:"message-circle-02",iconType:"line"},null,8,["onClick"]),e.postData.comments_count.raw?(o(),i("span",Mn,b(e.postData.comments_count.formatted),1)):_("",!0)])]),n("div",Tn,[u(oe,{counterValue:e.postData.views_count.formatted},null,8,["counterValue"])])])])])])]),e.state.reactionMenu.status?(o(),f(ne,{key:0,onAdd:e.addReaction,onClose:e.state.reactionMenu.close},null,8,["onAdd","onClose"])):_("",!0),e.state.shareMenu.status?(o(),f(se,{key:1,postLink:e.postLink,onClose:e.state.shareMenu.close},null,8,["postLink","onClose"])):_("",!0),e.state.commentsMenu.status?(o(),f(ae,{key:2,postData:e.postData,onClose:e.state.commentsMenu.close},null,8,["postData","onClose"])):_("",!0),e.state.mainMenu.status?(o(),f(re,{key:3,onClose:e.state.mainMenu.close,isMuted:!0},{default:M(()=>[n("div",{onClick:t[2]||(t[2]=V((...O)=>e.state.mainMenu.close&&e.state.mainMenu.close(...O),["stop"])),class:"h-full overflow-y-auto"},[n("div",Dn,[u(ie,{onAdd:e.addReaction},null,8,["onAdd"])]),n("div",Ln,[u(Q,null,{default:M(()=>[u(A,{onClick:e.state.reactionMenu.open,iconName:"heart-rounded",textLabel:e.$t("dd.add_reaction")},null,8,["onClick","textLabel"]),u(le,{to:{name:"publication_index",params:{hash_id:e.postData.hash_id}}},{default:M(()=>[u(A,{notLast:!0,iconName:"arrow-up-right",textLabel:e.$t("dd.post.open_post")},null,8,["textLabel"])]),_:1},8,["to"]),u(A,{onClick:e.bookmarkPost,iconName:e.postData.meta.activity.bookmarked?"bookmark-minus":"bookmark",textLabel:e.postData.meta.activity.bookmarked?e.$t("dd.post.unbookmark"):e.$t("dd.post.bookmark")},null,8,["onClick","iconName","textLabel"])]),_:1})]),n("div",An,[u(Q,null,{default:M(()=>[u(A,{onClick:e.state.shareMenu.open,iconName:"share-06",textLabel:e.$t("dd.post.share")},null,8,["onClick","textLabel"]),u(A,{onClick:e.copyLink,iconName:"copy-06",textLabel:e.$t("dd.post.copy_link")},null,8,["onClick","textLabel"]),e.postHasContent?(o(),f(A,{key:0,onClick:e.copyContent,iconName:"type-01",textLabel:e.$t("dd.copy_text")},null,8,["onClick","textLabel"])):_("",!0)]),_:1})]),u(Q,null,{default:M(()=>[e.canDeletePost?(o(),f(A,{key:0,onClick:t[1]||(t[1]=O=>e.$emit("delete",e.postData)),itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.post.delete_post")},null,8,["textLabel"])):_("",!0),e.canReportPost?(o(),f(A,{key:1,onClick:e.reportPost,itemColor:"text-red-900",iconName:"annotation-alert",textLabel:e.$t("dd.post.report_post")},null,8,["onClick","textLabel"])):_("",!0)]),_:1})])]),_:1},8,["onClose"])):_("",!0)],64)}const es=$(an,[["render",Rn]]);export{es as T,ee as u};
