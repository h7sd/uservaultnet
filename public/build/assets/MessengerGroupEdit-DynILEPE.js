import{_,c as p,j as t,o as r,d as v,C as A,F as D,i as x,r as s,a as n,Q as M,n as z,e as S,m as y,u as H,t as k,w as $,q as P,b as T,g as w,h as F,H as E,l as B}from"./global.properties-ieI6Xwik.js";import{u as N}from"./group.store-BXvBe6cE.js";import{A as j}from"./AvatarLarge-CKH2wML0.js";import{f as q,P as Q,a as U}from"./application-DnsIlr-S.js";import{T as R}from"./TextInput-CE1Bv1lI.js";import{S as J}from"./SectionToggle-DEryNKJ4.js";import{C as K}from"./ChatHeaderSkeleton-BtBb8mwX.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./inbox.store-DKf8FrGP.js";import"./index-CaocF3Et.js";const O={},W={class:"flex gap-2.5 items-center py-2 px-4"};function X(e,o){return r(),p("div",W,o[0]||(o[0]=[t("div",{class:"size-small-avatar skeleton-circle"},null,-1),t("div",{class:"flex-1"},[t("div",{class:"skeleton h-3 mb-2 w-1/2"}),t("div",{class:"skeleton h-3 w-1/3"})],-1)]))}const L=_(O,[["render",X]]),Y=v({components:{ParticipantSkeleton:L}}),Z={class:"w-full h-full"};function ee(e,o,m,f,g,l){const a=s("ParticipantSkeleton");return r(),p("div",Z,[o[0]||(o[0]=A('<div class="flex justify-center py-4"><div class="size-large-avatar skeleton-circle"></div></div><div class="px-4 mb-8"><div class="skeleton w-full h-10"></div></div><div class="px-4 mb-8"><div class="skeleton h-4 w-4/12 mb-2"></div><div class="skeleton h-4 w-8/12"></div></div>',3)),t("div",null,[(r(),p(D,null,x(3,i=>n(a,{key:i})),64))])])}const te=_(Y,[["render",ee]]),oe=v({props:{progress:{type:Number,default:0},height:{type:String,default:"h-0.5"}}}),ae={class:"bg-fill-qt flex"};function se(e,o,m,f,g,l){return r(),p("div",ae,[t("div",{class:z(["bg-brand-900 smoothing min-w-3",[e.height]]),style:M({width:e.progress+"%"})},null,6)])}const re=_(oe,[["render",se]]),ie=v({props:{chat_id:{type:String,required:!0}},setup:function(e){const o=P(""),m=N(),f=E(),g=P(null),l=T(()=>m.editGroupData),a=w({isSubmitting:!1,uploadProgress:0,isLoading:!0}),i=w({chat_id:e.chat_id,name:"",visibility:!0});return F(async()=>{await m.fetchEditGroup(e.chat_id),l.value?(i.name=l.value.name,i.description=l.value.description,i.visibility=l.value.visibility=="public",a.isLoading=!1):f.push({name:"error_404"})}),{formData:i,searchQuery:o,state:a,editGroupData:l,imageFileInput:g,isDraftGroup:!1,submitButtonStatus:T(()=>a.isSubmitting||!i.name.length),selectAvatar:()=>{if(a.isSubmitting)return!1;g.value.click()},submitForm:async()=>{a.isSubmitting=!0,await B().messenger().with(i).sendTo("groups/update").then(c=>{f.push({name:"messenger_group_show",params:{chat_id:e.chat_id}})}).catch(c=>{c.response&&toastError(c.response.data.message)}),a.isSubmitting=!1},onAvatarSelect:c=>{a.isSubmitting=!0;const h=new FormData;h.append("avatar_file",c.target.files[0]),h.append("chat_id",e.chat_id),B().messenger().with(h).withHeaders({"Content-Type":"multipart/form-data"}).uploadProgress(d=>{a.uploadProgress=Math.round(d.loaded/d.total*100)}).sendTo("groups/avatar/update").then(d=>{l.value.avatar_url=d.data.data.avatar_url,a.uploadProgress=0}).catch(d=>{d.response?toastError(d.response.data.message):a.uploadProgress=0}),a.isSubmitting=!1}}},components:{AvatarLarge:j,PageTitle:U,TextInput:R,ProgressLineBar:re,SectionToggle:J,PrimaryIconButton:Q,PrimaryPillButton:q,GroupEditorSkeleton:te,ParticipantSkeleton:L,ChatHeaderSkeleton:K}}),ne={class:"flex flex-1 h-full flex-col bg-no-repeat"},le={key:1,class:"h-16 flex items-center px-6 border-b border-bord-pr"},de={class:"flex-1 overflow-x-hidden overflow-y-auto"},ue={class:"flex justify-center py-top-offset"},pe={class:"w-content max-w-content"},ce={class:"px-16 mb-8 text-center"},me={class:"text-title-3 font-bold text-lab-pr"},fe={class:"text-par-m text-lab-sc"},ge={class:"flex justify-center py-4"},he={class:"size-large-avatar relative"},_e={class:"absolute -top-1 -right-1 size-10 bg-bg-pr rounded-full leading-zero"},ve={class:"px-4 mb-8"},be=["innerHTML"],Se={key:0,class:"px-4 mb-8"},ye=["innerHTML"],ke={class:"px-4 mb-8"},$e={class:"px-4 flex items-center"},Pe={class:"ml-auto"};function Te(e,o,m,f,g,l){const a=s("ChatHeaderSkeleton"),i=s("Border"),c=s("PageTitle"),h=s("ProgressLineBar"),d=s("GroupEditorSkeleton"),G=s("AvatarLarge"),C=s("PrimaryIconButton"),b=s("TextInput"),I=s("SectionToggle"),V=s("PrimaryPillButton");return r(),p("div",ne,[e.state.isLoading?(r(),p(D,{key:0},[n(a),n(i)],64)):(r(),p("div",le,[n(c,{backStep:2,titleText:e.editGroupData.is_draft?e.$t("chat.create_group"):e.$t("chat.edit_group")},null,8,["titleText"])])),e.state.uploadProgress?(r(),S(h,{key:2,progress:e.state.uploadProgress},null,8,["progress"])):y("",!0),t("div",de,[t("div",ue,[t("div",pe,[e.state.isLoading?(r(),S(d,{key:0})):(r(),p("form",{key:1,onSubmit:o[4]||(o[4]=H((...u)=>e.submitForm&&e.submitForm(...u),["prevent"]))},[t("div",ce,[t("h2",me,k(e.editGroupData.is_draft?e.$t("chat.group_creator.title"):e.$t("chat.group_editor.title")),1),t("p",fe,k(e.editGroupData.is_draft?e.$t("chat.group_creator.description"):e.$t("chat.group_editor.description")),1)]),t("div",ge,[t("div",he,[n(G,{hasBorder:!1,avatarSrc:e.editGroupData.avatar_url},null,8,["avatarSrc"]),t("div",_e,[n(C,{iconAreaSize:"10",iconSize:"icon-small",disabled:e.state.isSubmitting,onClick:e.selectAvatar,iconName:"pencil-02",buttonColor:"text-brand-900",iconType:"line",hoverBg:"hover:bg-brand-tr"},null,8,["disabled","onClick"])])])]),t("div",ve,[n(b,{modelValue:e.formData.name,"onUpdate:modelValue":o[0]||(o[0]=u=>e.formData.name=u),modelModifiers:{trim:!0},textLength:100,hasLabel:!1,placeholder:e.$t("chat.forms.group_editor.name_placeholder")},{feedbackInfo:$(()=>[t("span",{innerHTML:e.$t("chat.forms.group_editor.name_helper")},null,8,be)]),_:1},8,["modelValue","placeholder"])]),e.editGroupData.is_draft?y("",!0):(r(),p("div",Se,[n(b,{asText:!0,modelValue:e.formData.description,"onUpdate:modelValue":o[1]||(o[1]=u=>e.formData.description=u),modelModifiers:{trim:!0},textLength:240,hasLabel:!1,placeholder:e.$t("chat.forms.group_editor.description_placeholder")},{feedbackInfo:$(()=>[t("span",{innerHTML:e.$t("chat.forms.group_editor.description_helper")},null,8,ye)]),_:1},8,["modelValue","placeholder"])])),t("div",ke,[n(I,{iconName:"globe-06",modelValue:e.formData.visibility,"onUpdate:modelValue":o[2]||(o[2]=u=>e.formData.visibility=u),modelModifiers:{lazy:!0},captionText:e.$t("chat.forms.group_editor.public_helper"),titleText:e.$t("chat.forms.group_editor.public")},null,8,["modelValue","captionText","titleText"])]),t("div",$e,[t("div",Pe,[n(V,{loading:e.state.isSubmitting,disabled:e.submitButtonStatus,type:"submit",buttonText:e.editGroupData.is_draft?e.$t("labels.continue"):e.$t("labels.save_changes")},null,8,["loading","disabled","buttonText"])])]),t("input",{type:"file",onChange:o[3]||(o[3]=(...u)=>e.onAvatarSelect&&e.onAvatarSelect(...u)),accept:"image/*",ref:"imageFileInput",class:"hidden"},null,544)],32))])])])])}const Me=_(ie,[["render",Te]]);export{Me as default};
