import{u as A}from"./audio.store-DZtZQsA_.js";import{q as M}from"./application-DEz9sPnz.js";import{h}from"./media-D4ZD3EDk.js";import{_,b as v}from"./global.properties-DKM1fd6s.js";import{a as E}from"./index-tf8mOGqX.js";import{k as z,e as $,p as x,d as l,c as u,s as a,v as C,t as d,i as y,P as F,Q as I,r as w,l as g,o as q,G as R}from"./vendor-20TtR0Rd.js";import"./inbox.store-CHx7CB4w.js";import"./index-ciglwFMH.js";import"./ui-Bp8YvxdW.js";import"./editor-CpZ7vO5P.js";const U=z({setup:function(t){const e=A(),o=w(null),p=g(()=>e.postAudioData),c=w(null);var m=null;const r=[1,1.5,2,2.5,3],s=g(()=>e.playerState),k=()=>{o.value!==null&&o.value.unload(),o.value=new h.Howl({src:[p.value.source_url],rate:s.value.rate,mute:s.value.isMuted,onplay:function(){V(),e.updateStateValue("playing",!0);const n=h.Howler.ctx,i=n.createAnalyser();h.Howler.masterGain.connect(i),m=E().setCanvas(c.value).setAudioElement({context:n,source:i}),m.linesWaveStart({frequencyBand:"mids",fillColor:{gradient:["red","orange","yellow","green","blue","indigo","violet","purple"]}})},onpause:function(){S(),e.updateStateValue("playing",!1)},onend:function(){S(),e.updateStateValue("playing",!1)},onseek:function(n){e.updateStateValue("playbackTime",n)},onloaderror:(n,i)=>{e.addStateError(`Failed to load audio (ID: ${n}). Error: ${i}`)},onplayerror:(n,i)=>{e.addStateError(`Failed to play audio (ID: ${n}). Error: ${i}`)}})};function V(){function n(){const i=o.value.seek(),f=o.value.duration();e.updateStateValue("progressBar",Math.round(i/f*100)),e.updateStateValue("playbackTime",Math.round(i)),o.value.playing()&&(window.progressTimer=requestAnimationFrame(n))}window.progressTimer=requestAnimationFrame(n)}function S(){cancelAnimationFrame(window.progressTimer)}const b=()=>{s.value.playing||o.value.play()},B=()=>{s.value.playing&&o.value.pause()},D=n=>{try{const f=n.currentTarget.getBoundingClientRect(),T=(n.clientX-f.left)/f.width,P=o.value.duration()*T;o.value.seek(P),b()}catch{o.value.seek(0),b()}};return q(()=>{k(),document.body.classList.add("sticky-bar-open"),o.value.play(),v.on("soundbar:play",()=>{s.value.playing?o.value.pause():o.value.play()}),v.on("soundbar:reinitialize",()=>{k(),o.value.play()})}),R(()=>{document.body.classList.remove("sticky-bar-open"),v.off("soundbar:play"),v.off("soundbar:reinitialize"),o.value.pause()}),{audioData:p,playerState:s,playAudio:b,pauseAudio:B,seekAudio:D,soundbarVisualizerCanvas:c,muteAudio:()=>{s.value.isMuted?(o.value.mute(!1),e.updateStateValue("isMuted",!1)):(o.value.mute(!0),e.updateStateValue("isMuted",!0))},changeSpeedRate:()=>{const n=r.indexOf(s.value.rate),i=n+1<r.length?n+1:0;e.updateStateValue("rate",r[i]),o.value.rate(s.value.rate)},closeSoundbar:()=>{o.value.stop(),o.value.unload(),e.remove()}}}}),H={class:"relative"},N={key:0,class:"absolute bottom-full right-0 left-0 leading-none pt-1 pb-2 bg-red-900/90 backdrop-blur-md text-center"},G={class:"text-white text-cap-l"},L={class:"absolute inset-0 -z-10"},O={ref:"soundbarVisualizerCanvas",class:"w-full h-full"},j={class:"z-50 popup-background-pr"},Q={class:"ml-page-offset"},W={class:"pr-8 leading-none"},X={class:"block"},J={class:"flex items-center h-14"},K={class:"shrink-0 inline-flex items-center gap-3"},Y={class:"w-content px-1 ml-6"},Z={class:"flex items-center w-full"},ee={class:"min-w-12"},te={class:"text-par-s text-lab-pr3"},ae={class:"min-w-12 text-right"},oe={class:"text-par-s text-lab-pr3"},se={class:"shrink-0 inline-flex items-center ml-2"},ne={class:"shrink-0 inline-flex items-center ml-2 w-10 justify-center outline-hidden"},ie={class:"shrink-0 inline-flex items-center ml-4"},re={class:"ml-2 max-w-60 overflow-hidden"},le={class:"text-lab-pr2 text-par-s font-medium"},ue={class:"shrink-0 ml-auto"};function de(t,e,o,p,c,m){const r=$("SvgIcon");return l(),x(I,{to:"body"},[(l(),u("div",{key:t.audioData.id,class:"fixed bottom-0 left-0 right-0 z-50 h-14 border-t border-fill-tr shadow-vertical-qt"},[a("div",H,[t.playerState.errors.length>0?(l(),u("div",N,[a("span",G,d(t.$t("soundbar.playback_failed")),1)])):C("",!0),a("div",L,[a("canvas",O,null,512)]),a("div",j,[a("div",Q,[a("div",W,[a("div",X,[a("div",J,[a("div",K,[t.playerState.playing?(l(),u("button",{key:0,onClick:e[0]||(e[0]=(...s)=>t.pauseAudio&&t.pauseAudio(...s)),class:"size-icon-small cursor-pointer shrink-0 text-lab-pr3 outline-hidden"},[y(r,{type:"solid",name:"pause",classes:"size-full"})])):(l(),u("button",{key:1,onClick:e[1]||(e[1]=(...s)=>t.playAudio&&t.playAudio(...s)),class:"size-icon-small cursor-pointer shrink-0 text-lab-pr3 outline-hidden"},[y(r,{type:"solid",name:"play",classes:"size-full"})]))]),a("div",Y,[a("div",Z,[a("div",ee,[a("span",te,d(t.$filters.formatTime(t.playerState.playbackTime)),1)]),a("div",{onClick:e[2]||(e[2]=(...s)=>t.seekAudio&&t.seekAudio(...s)),class:"bg-fill-pr h-1 cursor-pointer flex-1 mx-2 leading-zero flex overflow-hidden rounded-full"},[a("span",{class:"h-full max-w-full bg-brand-900 transition-width ease-in-out",style:F({width:`${t.playerState.progressBar}%`})},null,4)]),a("div",ae,[a("span",oe,d(t.$filters.mediaDuration(t.audioData.metadata.duration)),1)])])]),a("div",se,[t.playerState.isMuted?(l(),u("button",{key:0,onClick:e[3]||(e[3]=(...s)=>t.muteAudio&&t.muteAudio(...s)),class:"size-icon-normal cursor-pointer shrink-0 text-lab-pr3 outline-hidden"},[y(r,{type:"solid",name:"volume-x",classes:"size-full"})])):(l(),u("button",{key:1,onClick:e[4]||(e[4]=(...s)=>t.muteAudio&&t.muteAudio(...s)),class:"size-icon-normal shrink-0 text-lab-pr3 outline-hidden cursor-pointer"},[y(r,{type:"solid",name:"volume-max",classes:"size-full"})]))]),a("div",ne,[a("button",{onClick:e[5]||(e[5]=(...s)=>t.changeSpeedRate&&t.changeSpeedRate(...s)),class:"shrink-0 cursor-pointer outline-hidden uppercase w-full font-semibold text-par-s text-lab-pr3 opacity-90 smoothing hover:text-brand-900"},d(t.playerState.rate)+"x ",1)]),a("div",ie,[a("div",re,[a("h4",le,d(t.audioData.metadata.file_name),1)])]),a("div",ue,[a("button",{onClick:e[6]||(e[6]=(...s)=>t.closeSoundbar&&t.closeSoundbar(...s)),type:"button",class:"text-par-s text-brand-900 cursor-pointer"},d(t.$t("labels.close")),1)])])])])])])])]))])}const pe=_(U,[["render",de]]),ce=z({setup:function(t){const e=A(),o=M();return{showSoundbar:g(()=>o.cheatSheet.isOpen?!1:e.postAudioData!==null)}},components:{SoundbarPlayer:pe}});function me(t,e,o,p,c,m){const r=$("SoundbarPlayer");return t.showSoundbar?(l(),x(r,{key:0})):C("",!0)}const ze=_(ce,[["render",me]]);export{ze as default};
