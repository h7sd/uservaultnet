import{k as C,e as o,p as f,d as s,q as k,h as G,c as n,D as P,s as a,z as E,E as H,r as w,i as c,v as D,t as u,F as h,x as T,b as A,G as U,o as q,l as $,f as S,w as Q,j as V,H as O}from"./vendor-20TtR0Rd.js";import{B as W,g as I,T as Y,b as J}from"./application-C3zsOS77.js";import{T as K,C as X}from"./TabsItem-QNQmzGR_.js";import{_ as y,B as R}from"./global.properties-DKM1fd6s.js";import{u as Z}from"./chat.store-BDVc674y.js";import{Q as M}from"./QuickSearch-MAT95vR0.js";import"./media-D4ZD3EDk.js";import"./editor-CpZ7vO5P.js";import"./swiper-element-bundle-DBu82uhE.js";import"./inbox.store-CHx7CB4w.js";import"./ClearButton-BVb3OBYL.js";const x=C({props:{isActive:{type:Boolean,default:!1}},components:{TabsItem:K}});function tt(t,e,r,l,d,v){const i=o("TabsItem");return s(),f(i,{isActive:t.isActive},{default:k(()=>[G(t.$slots,"default")]),_:3},8,["isActive"])}const et=y(x,[["render",tt]]),st={},at={class:"flex gap-3 items-center px-4"};function nt(t,e){return s(),n("div",at,e[0]||(e[0]=[P('<div class="shrink-0"><div class="size-normal-avatar skeleton-circle"></div></div><div class="flex-1 overflow-hidden pr-4 py-4"><div class="skeleton h-4 mb-2"></div><div class="skeleton h-4 w-4/12"></div></div>',2)]))}const N=y(st,[["render",nt]]),ot=C({props:{avatarSrc:{type:String,default:""}},setup:function(){const t=w(!1);return{isFallback:t,onError:()=>{t.value=!0}}}}),rt={class:"size-normal-avatar relative"},it={class:"size-full bg-bg-pr rounded-full overflow-hidden"},ct=["src"],lt=["src"];function ut(t,e,r,l,d,v){return s(),n("div",rt,[a("div",it,[E(a("img",{src:t.$config("user.default_avatar"),alt:"Avatar"},null,8,ct),[[H,t.isFallback]]),E(a("img",{class:"w-full",onError:e[0]||(e[0]=(...i)=>t.onError&&t.onError(...i)),src:t.avatarSrc,alt:"Avatar"},null,40,lt),[[H,!t.isFallback]])])])}const z=y(ot,[["render",ut]]),ht=C({props:{chatData:{type:Object,required:!0}},setup:function(t){const e=w(t.chatData);Z();const r=A({typing:{is_typing:!1,user:null}});return U(()=>{window.ColibriBRConnected&&ColibriBRD.private(R.getChannel("CHAT",[e.value.chat_id])).stopListeningForWhisper(R.getEvent("CHAT_MESSAGE_TYPING"))}),q(()=>{window.ColibriBRConnected&&ColibriBRD.private(R.getChannel("CHAT",[e.value.chat_id])).listenForWhisper(R.getEvent("CHAT_MESSAGE_TYPING"),function(l){r.typing=l.data})}),{state:r,isTyping:$(()=>r.typing.is_typing),markAsRead:()=>{e.value.unread_messages_count.raw=0,e.value.unread_messages_count.formatted=0}}},components:{AvatarNormal:z,BadgeCounter:W}}),dt={class:"shrink-0"},pt={class:"flex-1 overflow-hidden"},mt={class:"flex justify-between items-center gap-4"},_t={class:"flex items-center justify-between gap-4"},vt={class:"flex-1 overflow-hidden"},ft={class:"text-lab-pr2 text-par-m"},$t={key:0,class:"text-green-900 font-medium"},yt={key:2,class:"flex items-end gap-2.5 overflow-hidden max-w-full"},gt=["innerHTML"],Ct={class:"text-par-s text-lab-sc whitespace-nowrap"},bt={key:3,class:"text-par-s text-lab-sc whitespace-nowrap"};function kt(t,e,r,l,d,v){const i=o("AvatarNormal"),m=o("Name"),_=o("BadgeCounter"),p=o("RouterLink");return s(),f(p,{onClick:t.markAsRead,to:{name:"messenger_chat",params:{chat_id:t.chatData.chat_id}},class:"flex gap-2.5 py-3 items-center px-4"},{default:k(()=>[a("div",dt,[c(i,{avatarSrc:t.chatData.chat_info.avatar_url},null,8,["avatarSrc"])]),a("div",pt,[a("div",mt,[c(m,{name:t.chatData.chat_info.name,isVerified:t.chatData.chat_info.verified},null,8,["name","isVerified"])]),a("div",_t,[a("div",vt,[a("p",ft,[t.isTyping?(s(),n("span",$t,u(t.$t("chat.typing")),1)):t.chatData.is_deleted?(s(),n(h,{key:1},[T(u(t.$t("chat.message_is_deleted")),1)],64)):t.chatData.last_message?(s(),n("span",yt,[a("span",{class:"line-clamp-2",innerHTML:t.chatData.last_message},null,8,gt),a("span",Ct,u(t.chatData.last_activity.time_ago),1)])):(s(),n("time",bt,u(t.$t("labels.was_online_at",{time:t.chatData.last_activity.formatted})),1))])]),t.chatData.unread_messages_count.raw?(s(),f(_,{key:0,color:"bg-green-600",count:t.chatData.unread_messages_count.formatted},null,8,["count"])):D("",!0)])])]),_:1},8,["onClick","to"])}const F=y(ht,[["render",kt]]),St=C({props:{historyType:{type:String,default:"chats"}},setup:function(t){const e=w(""),r=w([]),l=I(),d=A({isLoading:!0}),v=$(()=>t.historyType=="groups"?l.chatsHistory.filter(i=>i.type=="group"):l.chatsHistory);return Q(e,i=>{r.value=v.value.filter(m=>{if(m.chat_info.name.toLowerCase().includes(i.toLowerCase()))return!0})}),q(async()=>{l.chatsHistory.length===0&&await l.fetchChatsHistory(),d.isLoading=!1}),{searchQuery:e,state:d,chatsHistory:v,searchResults:r,isSearching:$(()=>e.value.length>0),isEmptyInbox:$(()=>v.value.length===0),cancelSearch:()=>{e.value="",r.value=[]},searchPlaceholder:$(()=>d.isLoading?`${__t("labels.loading")}...`:__t("chat.search"))}},components:{ChatItemSkeleton:N,ChatItem:F,QuickSearch:M}}),Tt={class:"px-4 pt-4"},wt={key:0},At={key:1,class:"py-16 text-center"},qt={class:"text-par-s text-lab-sc"},Rt={key:1,class:"py-16 text-center"},Dt={class:"text-par-s text-lab-sc"};function It(t,e,r,l,d,v){const i=o("QuickSearch"),m=o("ChatItemSkeleton"),_=o("ChatItem");return s(),n(h,null,[a("div",Tt,[c(i,{modelValue:t.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=p=>t.searchQuery=p),onCancel:t.cancelSearch,placeholder:t.searchPlaceholder},null,8,["modelValue","onCancel","placeholder"])]),t.state.isLoading?(s(),n("div",wt,[(s(),n(h,null,S(7,p=>c(m)),64))])):t.isEmptyInbox?(s(),n("div",At,[a("p",qt,u(t.$t("chat.no_chat_history")),1)])):(s(),n(h,{key:2},[t.isSearching?(s(),n(h,{key:0},[t.searchResults.length>0?(s(!0),n(h,{key:0},S(t.searchResults,p=>(s(),f(_,{chatData:p,key:p.chat_id},null,8,["chatData"]))),128)):(s(),n("div",Rt,[a("p",Dt,u(t.$t("chat.no_chats_found")),1)]))],64)):(s(!0),n(h,{key:1},S(t.chatsHistory,p=>(s(),f(_,{chatData:p,key:p.chat_id},null,8,["chatData"]))),128))],64))],64)}const Bt=y(St,[["render",It]]),Lt=C({props:{variant:{type:String,default:"info"},iconName:{type:String,default:"info-circle"},iconType:{type:String,default:"line"},title:{type:String,default:""},description:{type:String,default:""}},setup:function(t){return{variantClassMaps:{info:"bg-fill-qt text-lab-pr",danger:"bg-red-900 text-white"}}}}),Nt={class:"flex gap-2.5 items-center px-4 py-3"},Et={class:"size-icon-small"},Ht={class:"flex-1"},Qt={class:"font-semibold text-par-m whitespace-nowrap truncate text-lab-pr2"},Vt={class:"text-lab-sc text-par-n"};function Mt(t,e,r,l,d,v){const i=o("SvgIcon");return s(),n("div",Nt,[a("div",{class:V([t.variantClassMaps[t.variant],"shrink-0 size-normal-avatar inline-flex-center rounded-full"])},[a("span",Et,[c(i,{name:t.iconName,type:t.iconType},null,8,["name","type"])])],2),a("div",Ht,[a("h6",Qt,u(t.title),1),a("p",Vt,u(t.description),1)])])}const L=y(Lt,[["render",Mt]]),zt=C({setup:function(){const t=A({isLoading:!1}),e=w(""),r=I(),l=w([]),d=$(()=>r.chatsArchive),v=$(()=>e.value.length>0);return Q(e,i=>{l.value=d.value.filter(m=>m.chat_info.name.toLowerCase().includes(i.toLowerCase()))}),q(async()=>{t.isLoading=!0,await r.fetchChatsArchive(),t.isLoading=!1}),{state:t,isSearching:v,chatsArchive:d,searchResults:l,chatsSearchQuery:e,ChatCallout:L,isEmptyArchive:$(()=>!d.value.length),handleSearchCancel:()=>{e.value="",l.value=[]}}},components:{ChatItem:F,ChatItemSkeleton:N,QuickSearch:M,ChatCallout:L}}),Ft={key:0,class:"block"},jt={key:1,class:"block"},Gt={class:"px-4 pt-4"},Pt={key:0,class:"py-24 text-center"},Ut={class:"text-par-s text-lab-sc"},Ot={key:1,class:"py-24 text-center"},Wt={class:"text-par-s text-lab-sc"};function Yt(t,e,r,l,d,v){const i=o("ChatItemSkeleton"),m=o("QuickSearch"),_=o("ChatCallout"),p=o("Border"),b=o("ChatItem");return t.state.isLoading?(s(),n("div",Ft,[(s(),n(h,null,S(7,g=>c(i)),64))])):(s(),n("div",jt,[a("div",Gt,[c(m,{onCancel:t.handleSearchCancel,modelValue:t.chatsSearchQuery,"onUpdate:modelValue":e[0]||(e[0]=g=>t.chatsSearchQuery=g),modelModifiers:{lazy:!0},placeholder:t.$t("chat.search")},null,8,["onCancel","modelValue","placeholder"])]),c(_,{iconName:"archive",title:t.$t("chat.archived_chats.title"),description:t.$t("chat.archived_chats.description")},null,8,["title","description"]),c(p),t.isEmptyArchive?(s(),n("div",Pt,[a("p",Ut,u(t.$t("chat.no_chat_archive")),1)])):(s(),n(h,{key:1},[t.isSearching?(s(),n(h,{key:0},[t.searchResults.length?(s(!0),n(h,{key:0},S(t.searchResults,g=>(s(),f(b,{chatData:g,key:g.chat_id},null,8,["chatData"]))),128)):(s(),n("div",Ot,[a("p",Wt,u(t.$t("chat.no_chats_found")),1)]))],64)):(s(!0),n(h,{key:1},S(t.chatsArchive,g=>(s(),f(b,{chatData:g},null,8,["chatData"]))),256))],64))]))}const Jt=y(zt,[["render",Yt]]),Kt=C({props:{requestData:{type:Object,required:!0}},setup:function(t){return{}},components:{AvatarNormal:z}}),Xt={class:"shrink-0"},Zt={class:"flex-1 overflow-hidden pr-4"},xt={class:"flex justify-between items-center gap-4"},te={class:"font-semibold text-par-m whitespace-nowrap truncate text-lab-pr2"},ee={class:"flex items-center justify-between gap-4"},se={class:"flex-1 overflow-hidden"},ae={class:"text-lab-sc text-par-n"},ne={class:"flex items-end gap-2.5 overflow-hidden max-w-full"},oe={class:"line-clamp-3"},re={class:"text-par-s text-lab-sc whitespace-nowrap"};function ie(t,e,r,l,d,v){const i=o("AvatarNormal"),m=o("VerificationBadge"),_=o("RouterLink");return s(),f(_,{to:{name:"messenger_group",params:{chat_id:t.requestData.relations.chat.chat_id}},class:V(["flex gap-3 items-start pl-4 py-3",[t.$route.params.chat_id===t.requestData.relations.chat.chat_id?"bg-brand-900/5":""]])},{default:k(()=>[a("div",Xt,[c(i,{avatarSrc:t.requestData.relations.sender.avatar_url},null,8,["avatarSrc"])]),a("div",Zt,[a("div",xt,[a("strong",te,[T(u(t.requestData.relations.sender.name)+" ",1),t.requestData.relations.sender.verified?(s(),f(m,{key:0,size:"xs"})):D("",!0)])]),a("div",ee,[a("div",se,[a("p",ae,[a("span",ne,[a("span",oe,u(t.$t("chat.invited_you_to_group",{group_name:t.requestData.relations.group.name})),1),a("span",re,u(t.requestData.date.time_ago),1)])])])])])]),_:1},8,["to","class"])}const ce=y(Kt,[["render",ie]]),le=C({setup:function(){const t=A({isLoading:!1}),e=I(),r=$(()=>e.chatRequests);return q(async()=>{t.isLoading=!0,await e.fetchChatRequests(),t.isLoading=!1}),{state:t,chatRequests:r,isEmptyList:$(()=>!r.value.length)}},components:{ChatItemSkeleton:N,RequestItem:ce,ChatCallout:L}}),ue={key:0,class:"block"},he={key:1,class:"py-24 text-center"},de={class:"text-par-s text-lab-sc"};function pe(t,e,r,l,d,v){const i=o("ChatCallout"),m=o("Border"),_=o("ChatItemSkeleton"),p=o("RequestItem");return s(),n(h,null,[c(i,{iconName:"message-question-circle",title:t.$t("chat.chat_requests.title"),description:t.$t("chat.chat_requests.description")},null,8,["title","description"]),c(m),t.state.isLoading?(s(),n("div",ue,[(s(),n(h,null,S(7,b=>c(_)),64))])):t.isEmptyList?(s(),n("div",he,[a("p",de,u(t.$t("chat.no_chat_requests")),1)])):(s(!0),n(h,{key:2},S(t.chatRequests,b=>(s(),f(p,{requestData:b,key:b.id},null,8,["requestData"]))),128))],64)}const me=y(le,[["render",pe]]),_e=C({setup:function(){const t=O(),e=I(),r=A({activeTab:"chats"});return q(()=>{e.fetchChatRequestsCount()}),{state:r,leaveMessenger:()=>{t.push({name:"home_index"})},requestsCount:$(()=>e.chatRequestsCount)}},components:{Toolbar:J,ContentTabs:X,TabsButton:et,ToastNotification:Y,ChatsHistory:Bt,ChatsArchive:Jt,ChatRequests:me}}),ve={class:"sticky top-0 popup-background-sc z-10"},fe={class:"block"},$e={class:"border-b border-b-bord-pr"};function ye(t,e,r,l,d,v){const i=o("ToastNotification"),m=o("Toolbar"),_=o("TabsButton"),p=o("ContentTabs"),b=o("ChatsHistory"),g=o("ChatsArchive"),j=o("ChatRequests");return s(),n(h,null,[a("div",ve,[a("div",fe,[c(i),c(m,{onClose:t.leaveMessenger,title:t.$t("labels.messages")},null,8,["onClose","title"])])]),a("div",$e,[c(p,{cols:"4"},{default:k(()=>[c(_,{isActive:t.state.activeTab==="chats",onClick:e[0]||(e[0]=B=>t.state.activeTab="chats")},{default:k(()=>[T(u(t.$t("chat.tabs.chats")),1)]),_:1},8,["isActive"]),c(_,{isActive:t.state.activeTab==="groups",onClick:e[1]||(e[1]=B=>t.state.activeTab="groups")},{default:k(()=>[T(u(t.$t("chat.tabs.groups")),1)]),_:1},8,["isActive"]),c(_,{isActive:t.state.activeTab==="requests",onClick:e[2]||(e[2]=B=>t.state.activeTab="requests")},{default:k(()=>[T(u(t.$t("chat.tabs.requests"))+" ",1),t.requestsCount?(s(),n(h,{key:0},[T("("+u(t.requestsCount)+")",1)],64)):D("",!0)]),_:1},8,["isActive"]),c(_,{isActive:t.state.activeTab==="archived",onClick:e[3]||(e[3]=B=>t.state.activeTab="archived")},{default:k(()=>[T(u(t.$t("chat.tabs.archived")),1)]),_:1},8,["isActive"])]),_:1})]),t.state.activeTab==="chats"||t.state.activeTab==="groups"?(s(),f(b,{historyType:t.state.activeTab,key:t.state.activeTab},null,8,["historyType"])):t.state.activeTab==="archived"?(s(),f(g,{key:1})):t.state.activeTab==="requests"?(s(),f(j,{key:2})):D("",!0)],64)}const Ie=y(_e,[["render",ye]]);export{Ie as default};
