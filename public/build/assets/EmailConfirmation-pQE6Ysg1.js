import{_ as T,c as d}from"./global.properties-DKM1fd6s.js";import{k,c,s as n,i as u,e as a,I as y,q as p,p as _,F as C,b as g,o as P,H as v,d as o}from"./vendor-20TtR0Rd.js";import{a as E,f as I,d as $}from"./application-DEz9sPnz.js";import{C as w}from"./CodeInput-mLUCBymJ.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./inbox.store-CHx7CB4w.js";import"./index-ciglwFMH.js";import"./ui-Bp8YvxdW.js";const B=k({setup:function(){var e=null;const s=$(),r=v(),l=g({code:""}),t=g({timeExpired:!1,expireSeconds:0,isLoading:!0,isSubmitting:!1,newEmail:"",formErrors:{code:[]}}),m=function(){e&&clearInterval(e),e=setInterval(()=>{t.expireSeconds<1?(t.timeExpired=!0,clearInterval(e)):t.expireSeconds-=1},1e3)};return P(async()=>{await d().userSettings().getFrom("email/check").then(i=>{t.expireSeconds=i.data.data.time_left,t.newEmail=i.data.data.email,t.isLoading=!1,m()}).catch(i=>{i.response&&r.push({name:"settings_email"})})}),{state:t,formData:l,resendCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await d().userSettings().sendTo("email/update/resend").then(i=>{toastSuccess(__t("toast.confirmation_code_resent")),t.timeExpired=!1,t.expireSeconds=i.data.data.time_left,m()}).catch(i=>{i.response&&toastError(i.response.data.message)}),t.isSubmitting=!1)},confirmCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await d().userSettings().with(l).sendTo("email/update/confirm").then(i=>{toastSuccess(__t("toast.email_updated")),s.setProperty("email",i.data.data.email),r.push({name:"settings_email"})}).catch(i=>{i.response&&(toastError(i.response.data.message),t.isSubmitting=!1)}))}}},components:{PrimaryPillButton:I,CodeInput:w,PageTitle:E}}),L={class:"mb-8"},x={key:0,class:"block"},D={class:"mb-8"},H=["innerHTML"],M={class:"mb-6"},V=["innerHTML"],A=["innerHTML"],F={class:"block"},z={key:1,class:"block"},N={class:"flex-center h-96"};function q(e,s,r,l,t,m){const i=a("PageTitle"),b=a("CodeInput"),f=a("PrimaryPillButton"),h=a("PrimarySpinAnimation");return o(),c(C,null,[n("div",L,[u(i,{hasBack:!0,titleText:e.$t("settings.email_confirmation")},null,8,["titleText"])]),e.state.isLoading?(o(),c("div",z,[n("div",N,[u(h)])])):(o(),c("div",x,[n("div",D,[n("h6",{class:"text-par-s text-lab-sc",innerHTML:e.$t("settings.forms.email_confirmation.page_desc",{new_email:e.state.newEmail})},null,8,H)]),n("div",M,[u(b,{modelValue:e.formData.code,"onUpdate:modelValue":s[0]||(s[0]=S=>e.formData.code=S),labelText:e.$t("settings.forms.email_confirmation.confirmation_code")},y({_:2},[e.state.timeExpired?{name:"feedbackInfo",fn:p(()=>[n("span",{innerHTML:e.$t("settings.forms.email_confirmation.confirmation_code_expired")},null,8,V)]),key:"0"}:{name:"feedbackInfo",fn:p(()=>[n("span",{innerHTML:e.$t("settings.forms.email_confirmation.confirmation_code_helper",{time:e.$filters.formatTime(e.state.expireSeconds)})},null,8,A)]),key:"1"}]),1032,["modelValue","labelText"])]),n("div",F,[e.state.timeExpired?(o(),_(f,{key:0,loading:e.state.isSubmitting,onClick:e.resendCode,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.resend_code")},null,8,["loading","onClick","buttonText"])):(o(),_(f,{key:1,loading:e.state.isSubmitting,onClick:e.confirmCode,isDisabled:e.formData.code.length<6,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.forms.email_confirmation.confirm_email")},null,8,["loading","onClick","isDisabled","buttonText"]))])]))],64)}const X=T(B,[["render",q]]);export{X as default};
