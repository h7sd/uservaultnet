import{a as y}from"./index-tf8mOGqX.js";import{R as C}from"./media-D4ZD3EDk.js";import{g as h,k as w}from"./application-DEz9sPnz.js";import{_ as x}from"./global.properties-DKM1fd6s.js";import{k,e as m,c as a,d,i as p,q as $,s as o,t as c,j as P,v as z,r as B,b as V}from"./vendor-20TtR0Rd.js";import"./editor-CpZ7vO5P.js";import"./inbox.store-CHx7CB4w.js";import"./index-ciglwFMH.js";import"./ui-Bp8YvxdW.js";const E=k({emits:["uploaded","close"],setup:function(e,n){const l=B(null),r={audioStream:null,recorderRTC:null,audioVisualizer:null},i=V({recordingTime:{seconds:0,milliseconds:0},recorderTimerInterval:null,isRecording:!1});return{startRecording:async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}).then(s=>{r.audioStream=s,r.recorderRTC=new C(s,{type:"audio",mimeType:"audio/webm",timeSlice:1e3,disableLogs:!1}),r.recorderRTC.startRecording(),i.isRecording=!0,i.recorderTimerInterval=setInterval(()=>{i.recordingTime.milliseconds+=1,i.recordingTime.milliseconds>=99&&(i.recordingTime.milliseconds=0,i.recordingTime.seconds+=1)},1e3/100);let t=new(window.AudioContext||window.webkitAudioContext);r.audioVisualizer=y().setCanvas(l.value).setAudioElement({context:t,source:t.createMediaStreamSource(s)}),r.audioVisualizer.linesWaveStart()})}catch(s){toastError(s.message)}},stopRecording:async()=>{try{await r.recorderRTC.stopRecording(()=>{const s=r.recorderRTC.getBlob();i.isRecording=!1;const t=new Date,f=String(t.getDate()).padStart(2,"0"),b=String(t.getMonth()+1).padStart(2,"0"),v=t.getFullYear(),R=String(t.getHours()).padStart(2,"0"),T=String(t.getMinutes()).padStart(2,"0");let S=`AUDREC-${v}${b}${f}-${R}${T}.webm`;n.emit("uploaded",new File([s],S,{type:"audio/webm"})),r.audioStream.getTracks().forEach(_=>{_.stop()}),r.audioStream=null,r.recorderRTC=null,r.audioVisualizer=null,clearInterval(i.recorderTimerInterval)})}catch(s){toastError(s.message)}},recorderState:i,waveformCanvas:l}},components:{PopupPanel:w,PrimaryTextButton:h}}),D={class:"popup-card"},I={class:"py-5"},A={class:"px-4 pb-1.5"},M={class:"text-lab-pr2 text-par-m font-medium"},N={class:"px-4 py-6"},j={ref:"waveformCanvas",id:"waveform",class:"w-full h-6"},F={class:""},U={class:"mb-8"},q={class:"text-lab-pr2 text-title-1 text-center mb-2"},H={class:"text-center"},L={class:"text-lab-sc text-par-l"},W={class:"flex justify-center mb-8"},Y={class:"inline-flex-center size-12 bg-transparent ring-2 ring-fill-pr overflow-hidden outline-hidden rounded-full"},G={key:0,class:"flex justify-center"};function J(e,n,l,r,i,g){const u=m("PrimaryTextButton"),s=m("PopupPanel");return d(),a("div",D,[p(s,null,{default:$(()=>[o("div",I,[o("div",A,[o("h3",M,c(e.$t("editor.recording_audio")),1)]),o("div",N,[o("div",{class:P(["border-b-2",[e.recorderState.isRecording?"border-brand-900":"border-fill-pr"]])},[o("canvas",j,null,512)],2)]),o("div",F,[o("div",U,[o("h4",q,c(e.$filters.formatTime(e.recorderState.recordingTime.seconds)),1),o("p",H,[o("span",L,c(e.recorderState.recordingTime.milliseconds.toString().toString().padStart(2,"0")),1)])]),o("div",W,[o("div",Y,[e.recorderState.isRecording?(d(),a("button",{key:0,onClick:n[0]||(n[0]=(...t)=>e.stopRecording&&e.stopRecording(...t)),type:"button",class:"inline-block outline-none cursor-pointer size-4 rounded-xs bg-red-600"})):(d(),a("button",{key:1,onClick:n[1]||(n[1]=(...t)=>e.startRecording&&e.startRecording(...t)),type:"button",class:"inline-block outline-none size-full bg-red-600 cursor-pointer"}))])]),e.recorderState.isRecording?z("",!0):(d(),a("div",G,[p(u,{buttonRole:"marginal",onClick:n[2]||(n[2]=t=>e.$emit("close")),buttonText:e.$t("labels.cancel")},null,8,["buttonText"])]))])])]),_:1})])}const se=x(E,[["render",J]]);export{se as default};
