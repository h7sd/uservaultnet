import{u as $,k as x,e as n,p as c,d as e,q as m,s as u,c as i,i as a,v as f,x as T,t as g,F as h,f as P,b as B,l as w,o as D,G as I}from"./vendor-20TtR0Rd.js";import{c as v,_ as R,b as M}from"./global.properties-DKM1fd6s.js";import{u as N}from"./index-B5kc-12x.js";import{u as E}from"./index-CA1Yx5qL.js";import{T as q}from"./TimelineContainer-DF9R5tCB.js";import{T as V}from"./TimelinePublication-CgCo0Ypy.js";import{T as j}from"./TimelinePublicationSkeleton-BC-OysGh.js";import{C as z}from"./TabsItem-QNQmzGR_.js";import{T as G}from"./TabsLink-Cj64FPul.js";import{a as H,F as J}from"./FeedUpdate-B6nOyACT.js";import{A as K}from"./AdCard-D48AMbS6.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./application-C3zsOS77.js";import"./swiper-element-bundle-DBu82uhE.js";import"./AvatarRightSided-DB-VHCky.js";import"./index-DyH4rDzV.js";import"./mention.plugin-6T_AP_1M.js";import"./index-CZvQntMR.js";import"./ProgressiveImageLoader-8evwBPct.js";import"./SpinnerIcon-BFpWBik4.js";import"./media.status-D6lx-p4W.js";import"./index-DvUAJ3ty.js";import"./VideoDurationTime-DjdOjCKw.js";import"./GiphyAttribution-79F8UUld.js";import"./DropdownButton-CQ32lbq7.js";import"./LinkSnapshot-C_DWeP4J.js";import"./LinkSnapshot-C0Z1Turo.js";import"./ViewsCounter-DDf6U7Tj.js";import"./AvatarExtraSmall-CURibG5K.js";import"./SheetTitle-CCLXWnJ3.js";import"./TimelineEmptyState-D4R0nEYT.js";import"./index-ciglwFMH.js";import"./PeopleListItem-DOFLjTB9.js";const O=$("mobile_explore_posts_store",{deleteAware:!0,state:function(){return{updateAttempts:0,posts:[],update:[],filter:{page:1}}},actions:{updateFeed:async function(){await v().explore().params({filter:{onset:this.posts.at(0).id}}).sendTo("posts").then(t=>{this.update=t.data.data}).catch(t=>{t.response&&(state.update=[])})},applyUpdate:function(){this.update.forEach(t=>{this.posts.slice(0,this.update.length).some(r=>r.id===t.id)||this.posts.unshift(t)}),this.update=[]},makeLoadRequest:async function(){return await v().explore().with({filter:this.filter}).sendTo("posts")},fetchPosts:async function(){await this.makeLoadRequest().then(t=>{this.posts=t.data.data})},loadMorePosts:async function(){return await this.makeLoadRequest().then(t=>{let o=t.data.data;return o.length?(this.posts=this.posts.concat(o),!0):!1}).catch(()=>!1)},getLastPostId:function(){return this.posts.at(-1).id},resetFilter:function(){this.filter={page:1}}}}),Q=x({setup:function(){const t=B({isLoading:!0,isLoadingContent:!1,noMoreContent:!1,isUpdating:!1});let o=null,r=0;const{postDeleter:C}=E(),s=O(),_=w(()=>s.update),l=w(()=>s.posts);return N({callback:async()=>{!t.isLoadingContent&&!t.noMoreContent&&(t.isLoadingContent=!0,s.filter.page+=1,t.noMoreContent=!await s.loadMorePosts(),t.isLoadingContent=!1)}}),D(async()=>{t.isLoading=!0,s.resetFilter(),await s.fetchPosts(),t.isLoading=!1,l.value.length&&(o=setInterval(async()=>{t.isUpdating||(_.value.length==0&&r>10?clearInterval(o):(t.isUpdating=!0,await s.updateFeed(),t.isUpdating=!1,r++))},60*1e3*10))}),I(()=>{o&&clearInterval(o)}),{state:t,posts:l,newPosts:_,applyNewPosts:()=>{s.applyUpdate()},handlePostDelete:k=>{C(k,y=>{M.emit("timeline:post-deleted",y),toastSuccess(__t("toast.media.post_deleted"))})}}},components:{TimelineContainer:q,TimelinePublication:V,TimelinePublicationSkeleton:j,ContentTabs:z,TabsLink:G,FeedUpdate:J,AdCard:K,FollowRecommendation:H}}),W={class:"sticky top-0 popup-background-tr z-10"},X={key:1},Y={key:0},Z={key:1,class:"py-32"},tt={class:"text-lab-sc text-par-s text-center"},et={key:2};function ot(t,o,r,C,s,_){const l=n("TabsLink"),k=n("ContentTabs"),y=n("FeedUpdate"),b=n("Border"),L=n("TimelinePublicationSkeleton"),F=n("TimelinePublication"),U=n("FollowRecommendation"),S=n("AdCard"),A=n("TimelineContainer");return e(),c(A,null,{default:m(()=>[u("div",W,[a(k,{cols:2},{default:m(()=>[a(l,{link:{name:"explore_posts"}},{default:m(()=>[T(g(t.$t("labels.explore")),1)]),_:1}),a(l,{link:{name:"explore_people"}},{default:m(()=>[T(g(t.$t("labels.people")),1)]),_:1})]),_:1}),t.newPosts.length?(e(),c(y,{key:0,posts:t.newPosts,onClick:t.applyNewPosts},null,8,["posts","onClick"])):f("",!0),a(b)]),t.state.isLoading?(e(),i(h,{key:0},P(15,p=>a(L,{key:p})),64)):(e(),i("div",X,[t.posts.length?(e(),i("div",Y,[(e(!0),i(h,null,P(t.posts,(p,d)=>(e(),i(h,{key:p.id},[a(F,{postData:p,onDelete:st=>t.handlePostDelete(p)},null,8,["postData","onDelete"]),(d+1)%35===0?(e(),c(U,{key:d})):f("",!0),(d+1)%10===0?(e(),i(h,{key:1},[(e(),c(S,{key:d})),a(b,{height:"h-2",opacity:"opacity-30"})],64)):f("",!0)],64))),128))])):(e(),i("div",Z,[u("p",tt,g(t.$t("empty_state.empty")),1)])),t.state.isLoadingContent?(e(),i("div",et,[a(b),o[0]||(o[0]=u("div",{class:"flex justify-center my-4"},[u("div",{class:"colibri-primary-animation"})],-1))])):f("",!0)]))]),_:1})}const Nt=R(Q,[["render",ot]]);export{Nt as default};
