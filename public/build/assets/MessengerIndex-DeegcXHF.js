const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MessengerArchive-CsYSiHOI.js","assets/inbox.store-DKf8FrGP.js","assets/global.properties-ieI6Xwik.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/application-DnsIlr-S.js","assets/index-CaocF3Et.js","assets/SidebarContainer-x1peVxVZ.js","assets/QuickSearch-BhSwELqg.js","assets/chat.store-DbSkwILP.js","assets/AvatarNormal-QOljNkCM.js"])))=>i.map(i=>d[i]);
import{_ as b,d as y,r as n,c as i,o as s,j as t,a as o,n as A,t as _,e as m,w as v,f as V,C as j,m as S,F as g,p as C,q,b as $,g as T,G as z,V as B,h as M,i as w,I as W,u as P,v as Q,x as G,M as O,B as F,y as U,z as Y}from"./global.properties-ieI6Xwik.js";import{u as I}from"./inbox.store-DKf8FrGP.js";import{T as J,B as K,p as X,a as Z,n as x,o as ee,W as te,d as se}from"./application-DnsIlr-S.js";import{S as ae}from"./SidebarContainer-x1peVxVZ.js";import{u as ne}from"./chat.store-DbSkwILP.js";import{A as L}from"./AvatarNormal-QOljNkCM.js";import{Q as oe}from"./QuickSearch-BhSwELqg.js";const ie=y({props:{variant:{type:String,default:"info"},iconName:{type:String,default:"info-circle"},iconType:{type:String,default:"line"},title:{type:String,default:""},description:{type:String,default:""}},setup:function(e){return{variantClassMaps:{info:"bg-fill-qt text-lab-pr",danger:"bg-red-900 text-white"}}}}),re={class:"flex gap-2.5 items-center px-4 py-3"},ce={class:"size-icon-small"},le={class:"flex-1"},ue={class:"font-semibold text-par-m whitespace-nowrap truncate text-lab-pr2"},de={class:"text-lab-sc text-par-n"};function pe(e,a,l,d,p,f){const r=n("SvgIcon");return s(),i("div",re,[t("div",{class:A([e.variantClassMaps[e.variant],"shrink-0 size-normal-avatar inline-flex-center rounded-full"])},[t("span",ce,[o(r,{name:e.iconName,type:e.iconType},null,8,["name","type"])])],2),t("div",le,[t("h6",ue,_(e.title),1),t("p",de,_(e.description),1)])])}const H=b(ie,[["render",pe]]),he=y({components:{ChatCallout:H}});function _e(e,a,l,d,p,f){const r=n("ChatCallout");return s(),m(r,{variant:"danger",iconName:"signal-03",iconType:"solid",title:e.$t("chat.alerts.ws_connection.title"),description:e.$t("chat.alerts.ws_connection.desc")},null,8,["title","description"])}const me=b(he,[["render",_e]]),fe=y({props:{isActive:{type:Boolean,default:!1}},components:{TabsItem:J}});function ve(e,a,l,d,p,f){const r=n("TabsItem");return s(),m(r,{isActive:e.isActive},{default:v(()=>[V(e.$slots,"default")]),_:3},8,["isActive"])}const ge=b(fe,[["render",ve]]),$e={},be={class:"flex gap-3 items-center pl-6"};function ye(e,a){return s(),i("div",be,a[0]||(a[0]=[j('<div class="shrink-0"><div class="size-normal-avatar skeleton-circle"></div></div><div class="flex-1 overflow-hidden pr-4 py-4 border-b border-bord-tr"><div class="skeleton h-3 mb-2"></div><div class="skeleton h-3 w-4/12"></div></div>',2)]))}const E=b($e,[["render",ye]]),Ce=y({props:{chatData:{type:Object,required:!0}},setup:function(e){const a=q(e.chatData),l=ne(),d=$(()=>l.chatData),p=T({typing:{is_typing:!1,user:null}});return z(()=>{window.ColibriBRConnected&&ColibriBRD.private(B.getChannel("CHAT",[a.value.chat_id])).stopListeningForWhisper(B.getEvent("CHAT_MESSAGE_TYPING"))}),M(()=>{window.ColibriBRConnected&&ColibriBRD.private(B.getChannel("CHAT",[a.value.chat_id])).listenForWhisper(B.getEvent("CHAT_MESSAGE_TYPING"),function(f){p.typing=f.data})}),{state:p,isSelectedChat:$(()=>d.value&&d.value.chat_id===e.chatData.chat_id),isTyping:$(()=>p.typing.is_typing),markAsRead:()=>{a.value.unread_messages_count.raw=0,a.value.unread_messages_count.formatted=0}}},components:{AvatarNormal:L,BadgeCounter:K}}),ke={class:"shrink-0"},Se={class:"flex justify-between items-center gap-4"},we={class:"font-semibold text-par-m whitespace-nowrap truncate text-lab-pr2"},Te=["innerHTML"],Be={class:"flex items-center justify-between gap-4"},Ae={class:"flex-1 overflow-hidden"},Me={class:"text-lab-sc text-par-n"},Re={key:0,class:"text-green-900 font-medium"},De={key:2,class:"flex items-end gap-2.5 overflow-hidden max-w-full"},qe=["innerHTML"],Ie={class:"text-par-s text-lab-sc whitespace-nowrap"},Ne={key:3,class:"text-par-s text-lab-sc whitespace-nowrap"};function Le(e,a,l,d,p,f){const r=n("AvatarNormal"),u=n("VerificationBadge"),c=n("BadgeCounter"),h=n("RouterLink");return s(),m(h,{onClick:e.markAsRead,to:{name:"messenger_chat",params:{chat_id:e.chatData.chat_id}},class:A(["flex gap-3 items-center pl-4 h-20",[e.isSelectedChat?"bg-brand-900/5":""]])},{default:v(()=>[t("div",ke,[o(r,{avatarSrc:e.chatData.chat_info.avatar_url},null,8,["avatarSrc"])]),t("div",{class:A(["flex-1 overflow-hidden pr-4",[e.isSelectedChat?"border-b-transparent":""]])},[t("div",Se,[t("strong",we,[t("span",{innerHTML:e.chatData.chat_info.name},null,8,Te),e.chatData.chat_info.verified?(s(),m(u,{key:0,size:"xs"})):S("",!0)])]),t("div",Be,[t("div",Ae,[t("p",Me,[e.isTyping?(s(),i("span",Re,[e.chatData.is_group?(s(),i(g,{key:0},[C(_(e.$t("chat.user_is_typing",{name:e.state.typing.user.name})),1)],64)):(s(),i(g,{key:1},[C(_(e.$t("chat.typing")),1)],64))])):e.chatData.is_deleted?(s(),i(g,{key:1},[C(_(e.$t("chat.message_is_deleted")),1)],64)):e.chatData.last_message?(s(),i("span",De,[t("span",{class:"line-clamp-2",innerHTML:e.chatData.last_message},null,8,qe),t("span",Ie,_(e.chatData.last_activity.time_ago),1)])):(s(),i("time",Ne,_(e.$t("labels.was_online_at",{time:e.chatData.last_activity.formatted})),1))])]),!e.isSelectedChat&&e.chatData.unread_messages_count.raw?(s(),m(c,{key:0,color:"bg-green-600",count:e.chatData.unread_messages_count.formatted},null,8,["count"])):S("",!0)])],2)]),_:1},8,["onClick","to","class"])}const He=b(Ce,[["render",Le]]),Ee=y({props:{historyType:{type:String,default:"chats"}},setup:function(e){const a=T({isLoading:!1}),l=q(""),d=I(),p=q([]),f=$(()=>e.historyType=="groups"?d.chatsHistory.filter(u=>u.type==="group"):d.chatsHistory),r=$(()=>l.value.length>0);return W(l,u=>{p.value=f.value.filter(c=>{if(c.chat_info.name.toLowerCase().includes(u.toLowerCase()))return!0})}),M(async()=>{a.isLoading=!0,d.chatsHistory.length||await d.fetchChatsHistory(),a.isLoading=!1}),{state:a,isSearching:r,chatsHistory:f,searchResults:p,chatsSearchQuery:l,isEmptyInbox:$(()=>f.value.length===0),handleSearchCancel:()=>{l.value="",p.value=[]}}},components:{ChatItem:He,ChatItemSkeleton:E,QuickSearch:oe}}),Ve={key:0,class:"block"},je={key:1,class:"block"},ze={key:0,class:"py-24 text-center"},We={class:"text-par-s text-lab-sc"},Pe={class:"px-4 mb-4"},Qe={key:1,class:"py-24 text-center"},Ge={class:"text-par-s text-lab-sc"};function Oe(e,a,l,d,p,f){const r=n("ChatItemSkeleton"),u=n("QuickSearch"),c=n("ChatItem");return e.state.isLoading?(s(),i("div",Ve,[(s(),i(g,null,w(7,h=>o(r)),64))])):(s(),i("div",je,[e.isEmptyInbox?(s(),i("div",ze,[t("p",We,_(e.$t("chat.no_chat_history")),1)])):(s(),i(g,{key:1},[t("div",Pe,[o(u,{onCancel:e.handleSearchCancel,modelValue:e.chatsSearchQuery,"onUpdate:modelValue":a[0]||(a[0]=h=>e.chatsSearchQuery=h),modelModifiers:{lazy:!0},placeholder:e.$t("chat.search")},null,8,["onCancel","modelValue","placeholder"])]),e.isSearching?(s(),i(g,{key:0},[e.searchResults.length?(s(!0),i(g,{key:0},w(e.searchResults,h=>(s(),m(c,{chatData:h,key:h.chat_id},null,8,["chatData"]))),128)):(s(),i("div",Qe,[t("p",Ge,_(e.$t("chat.no_chats_found")),1)]))],64)):(s(!0),i(g,{key:1},w(e.chatsHistory,h=>(s(),m(c,{chatData:h},null,8,["chatData"]))),256))],64))]))}const Fe=b(Ee,[["render",Oe]]),Ue=y({props:{requestData:{type:Object,required:!0}},setup:function(e){return{}},components:{AvatarNormal:L}}),Ye={class:"shrink-0"},Je={class:"flex-1 overflow-hidden pr-4"},Ke={class:"flex justify-between items-center gap-4"},Xe={class:"font-semibold text-par-m whitespace-nowrap truncate text-lab-pr2"},Ze={class:"flex items-center justify-between gap-4"},xe={class:"flex-1 overflow-hidden"},et={class:"text-lab-sc text-par-n"},tt={class:"flex items-end gap-2.5 overflow-hidden max-w-full"},st={class:"line-clamp-3"},at={class:"text-par-s text-lab-sc whitespace-nowrap"};function nt(e,a,l,d,p,f){const r=n("AvatarNormal"),u=n("VerificationBadge"),c=n("RouterLink");return s(),m(c,{to:{name:"messenger_group_show",params:{chat_id:e.requestData.relations.chat.chat_id}},class:A(["flex gap-3 items-start pl-4 py-3",[e.$route.params.chat_id===e.requestData.relations.chat.chat_id?"bg-brand-900/5":""]])},{default:v(()=>[t("div",Ye,[o(r,{avatarSrc:e.requestData.relations.sender.avatar_url},null,8,["avatarSrc"])]),t("div",Je,[t("div",Ke,[t("strong",Xe,[C(_(e.requestData.relations.sender.name)+" ",1),e.requestData.relations.sender.verified?(s(),m(u,{key:0,size:"xs"})):S("",!0)])]),t("div",Ze,[t("div",xe,[t("p",et,[t("span",tt,[t("span",st,_(e.$t("chat.invited_you_to_group",{group_name:e.requestData.relations.group.name})),1),t("span",at,_(e.requestData.date.time_ago),1)])])])])])]),_:1},8,["to","class"])}const ot=b(Ue,[["render",nt]]),it=y({setup:function(){const e=T({isLoading:!1}),a=I(),l=$(()=>a.chatRequests);return M(async()=>{e.isLoading=!0,await a.fetchChatRequests(),e.isLoading=!1}),{state:e,chatRequests:l,isEmptyList:$(()=>!l.value.length)}},components:{ChatItemSkeleton:E,RequestItem:ot,ChatCallout:H}}),rt={key:0,class:"block"},ct={key:1,class:"py-24 text-center"},lt={class:"text-par-s text-lab-sc"};function ut(e,a,l,d,p,f){const r=n("ChatCallout"),u=n("Border"),c=n("ChatItemSkeleton"),h=n("RequestItem");return s(),i(g,null,[o(r,{iconName:"message-question-circle",title:e.$t("chat.chat_requests.title"),description:e.$t("chat.chat_requests.description")},null,8,["title","description"]),o(u),e.state.isLoading?(s(),i("div",rt,[(s(),i(g,null,w(7,k=>o(c)),64))])):e.isEmptyList?(s(),i("div",ct,[t("p",lt,_(e.$t("chat.no_chat_requests")),1)])):(s(!0),i(g,{key:2},w(e.chatRequests,k=>(s(),m(h,{requestData:k,key:k.id},null,8,["requestData"]))),128))],64)}const dt=b(it,[["render",ut]]),pt=y({setup:function(){const e=I();return M(()=>{e.fetchChatRequestsCount()}),{requestsCount:$(()=>e.chatRequestsCount),state:T({activeTab:"chats"}),isWSEstablished:$(()=>window.ColibriBRConnected!==!1)}},components:{PageTitle:Z,SidebarContainer:ae,WSConnectionAlert:me,ContentTabs:X,ChatsHistory:Fe,ChatRequests:dt,TabsButton:ge}}),ht={class:"px-4 mb-4"},_t={key:0},mt={class:"border-b border-b-bord-pr mb-4"};function ft(e,a,l,d,p,f){const r=n("PageTitle"),u=n("WSConnectionAlert"),c=n("TabsButton"),h=n("ContentTabs"),k=n("ChatsHistory"),R=n("ChatRequests"),D=n("SidebarContainer");return s(),m(D,null,{sidebarTitle:v(()=>[t("div",ht,[o(r,{hasBack:!0,backHome:!0,titleText:e.$t("labels.messages")},null,8,["titleText"])]),e.isWSEstablished?S("",!0):(s(),i("div",_t,[o(u)]))]),sidebarBody:v(()=>[t("div",mt,[o(h,null,{default:v(()=>[o(c,{onClick:a[0]||(a[0]=N=>e.state.activeTab="chats"),isActive:e.state.activeTab==="chats"},{default:v(()=>[C(_(e.$t("chat.tabs.chats")),1)]),_:1},8,["isActive"]),o(c,{onClick:a[1]||(a[1]=N=>e.state.activeTab="groups"),isActive:e.state.activeTab==="groups"},{default:v(()=>[C(_(e.$t("chat.tabs.groups")),1)]),_:1},8,["isActive"]),o(c,{onClick:a[2]||(a[2]=N=>e.state.activeTab="requests"),isActive:e.state.activeTab==="requests"},{default:v(()=>[C(_(e.$t("chat.tabs.requests"))+" ",1),e.requestsCount?(s(),i(g,{key:0},[C("("+_(e.requestsCount)+")",1)],64)):S("",!0)]),_:1},8,["isActive"])]),_:1})]),e.state.activeTab==="chats"||e.state.activeTab==="groups"?(s(),m(k,{historyType:e.state.activeTab,key:e.state.activeTab},null,8,["historyType"])):e.state.activeTab==="requests"?(s(),m(R,{key:1})):S("",!0)]),_:1})}const vt=b(pt,[["render",ft]]),gt=y({setup:function(){const e=se();return{state:T({mainMenu:O()}),userData:$(()=>e.userData),openAccountSwitcherModal:()=>{F.emit("account-switcher:open")}}},components:{ActionBarButton:te,RichMenu:ee,RichMenuItem:x}}),$t={class:"w-action-bar shrink-0 border-r border-r-bord-pr"},bt={class:"flex flex-col h-full w-full items-center py-6"},yt=["src"],Ct={class:"w-full px-4 pb-2"},kt={class:"relative"},St={class:"absolute w-96 top-10 left-10 z-50"},wt={class:"w-full px-4 py-2"},Tt={class:"mb-2"},Bt={class:"mt-auto w-full"},At={class:"mb-2"},Mt={class:"flex justify-center"},Rt=["src"];function Dt(e,a,l,d,p,f){const r=n("RouterLink"),u=n("Border"),c=n("ActionBarButton"),h=n("RichMenuItem"),k=n("RichMenu"),R=G("outside-click");return s(),i("div",$t,[t("div",bt,[o(r,{to:{name:"home_index"},class:"flex justify-center mb-4"},{default:v(()=>[t("img",{class:"h-7",src:e.$embedder("assets.logos.url"),alt:"Logo"},null,8,yt)]),_:1}),t("div",Ct,[o(u)]),t("div",kt,[o(c,{onClick:P(e.state.mainMenu.open,["stop"]),hasBg:e.state.mainMenu.status,iconName:"plus",iconType:"solid"},null,8,["onClick","hasBg"]),t("div",St,[e.state.mainMenu.status?Q((s(),m(k,{key:0,onClick:e.state.mainMenu.close},{default:v(()=>[o(r,{to:{name:"messenger_group_create"}},{default:v(()=>[o(h,{iconName:"users-01",title:e.$t("chat.main_menu.group.title"),trailingIconName:"arrow-up-right",description:e.$t("chat.main_menu.group.description")},null,8,["title","description"])]),_:1})]),_:1},8,["onClick"])),[[R,e.state.mainMenu.close]]):S("",!0)])]),t("div",wt,[o(u)]),o(r,{to:{name:"messenger_archive"},class:"block"},{default:v(()=>[o(c,{hasBg:!1,iconName:"archive",iconType:"line"})]),_:1}),t("div",Tt,[o(c,{onClick:e.$comingSoon,hasBg:!1,iconName:"phone",iconType:"line"},null,8,["onClick"])]),t("div",Bt,[t("div",At,[o(r,{to:{name:"settings_privacy"}},{default:v(()=>[o(c,{iconName:"settings-04",hasBg:!1,iconType:"line"})]),_:1})]),t("div",Mt,[t("div",{class:"size-10 overflow-hidden rounded-full cursor-pointer",onClick:a[0]||(a[0]=(...D)=>e.openAccountSwitcherModal&&e.openAccountSwitcherModal(...D))},[t("img",{class:"w-full",src:e.userData.avatar_url,alt:"Avatar"},null,8,Rt)])])])])])}const qt=b(gt,[["render",Dt]]),It=y({components:{MessengerNavbar:vt,MessengerActionBar:qt,MessengerArchive:U(()=>Y(()=>import("./MessengerArchive-CsYSiHOI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])))}}),Nt={class:"fixed inset-0 flex w-messenger-sidebar"},Lt={class:"fixed inset-0 ml-messenger-sidebar"};function Ht(e,a,l,d,p,f){const r=n("MessengerActionBar"),u=n("MessengerArchive"),c=n("MessengerNavbar"),h=n("RouterView");return s(),i(g,null,[t("div",Nt,[o(r),e.$route.meta.archive?(s(),m(u,{key:0})):(s(),m(c,{key:1}))]),t("div",Lt,[(s(),m(h,{key:e.$route.params.chat_id||1}))])],64)}const Et=b(It,[["render",Ht]]),Ot=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{H as C,Ot as M,me as W,E as a,He as b};
