const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PostImagePreview-DoNIiy5j.js","assets/MediaDeleteButton-Dpo1bbGM.js","assets/application-B35z453N.js","assets/global.properties-ieI6Xwik.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/swiper-element-bundle-DBu82uhE.js","assets/application-3Wj8EdJU.css","assets/PostVideoPreview-DXDLgVI4.js","assets/VideoDurationTime-CY2-hNg2.js","assets/PostDocumentPreview-DsSmMewz.js","assets/PostGifPreview-5Actm7m0.js","assets/GiphyAttribution-Cv2rUDbj.js","assets/GIFPicker-CB7SUX1n.js","assets/index-BiajNNMq.js","assets/TimelineEmptyState-D2cMbIuH.js","assets/PollEditor-CQWitpQG.js","assets/index-CZvQntMR.js","assets/index-CaocF3Et.js","assets/SheetTitle-Cb1vf6Xi.js","assets/ClearButton-pgQ229dk.js"])))=>i.map(i=>d[i]);
import{_ as $,d as H,r as u,c as m,o as a,j as o,e as f,m as c,a as p,v as L,K as N,F as O,Q as R,t as S,p as U,n as z,y as P,z as v,q as I,H as j,b as g,g as q,h as K,R as Q,P as E,l as D,S as J}from"./global.properties-ieI6Xwik.js";import{u as W}from"./index-CaocF3Et.js";import{a as X,b as Y,u as Z,c as x}from"./application-B35z453N.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./swiper-element-bundle-DBu82uhE.js";const ee=H({setup:function(){const e=Z(),s=I(null),M=I(null),C=I(null),k=I(null),V=x(),_=j(),b=I(null),{autoResize:T}=W(),r=g(()=>e.draftPost),w=g(()=>V.userData),n=q({postSubmitting:!1,uploadProgress:0,isGifPickerOpen:!1}),l=t=>{b.value=t,debounce(()=>{b.value=null},3e3);try{J.uiFeedback(),navigator.vibrate([150,50,150])}catch{}},F=()=>({content:r.value.content});K(async function(){await e.fetchDraftPost()});const h=(t,d="image")=>{const A=new FormData;A.append(d,t),D().postEditor().with(A).withHeaders({"Content-Type":"multipart/form-data"}).uploadProgress(y=>{n.uploadProgress=Math.round(y.loaded/y.total*100)}).sendTo(`media/${d}/upload`).then(y=>{e.fetchDraftPost(),n.uploadProgress=0,G()}).catch(y=>{l(y.response.data.message),n.uploadProgress=0,G()})},i=async()=>{n.postSubmitting=!0,await D().postEditor().with(F()).sendTo("create").then(t=>{e.finishEditing(),T(k.value),B(),toastSuccess(__t("toast.post_published"))}).catch(t=>{l(t.response.data.message)}),n.postSubmitting=!1},G=()=>{s.value.value=""},B=()=>{_.go(-1)};return{leaveEditor:B,state:n,PostTypeUtils:E,PostType:Q,userData:w,submitForm:i,validationError:b,postData:r,contentInput:k,videoFileInput:M,imageFileInput:s,audioFileInput:C,textInputHandler:function(){T(k.value)},onImageSelect:function(t){h(t.target.files[0],"image")},onAudioSelect:function(t){h(t.target.files[0],"audio")},onVideoSelect:function(t){h(t.target.files[0],"video")},selectImage:function(){s.value.click()},selectAudio:function(){C.value.click()},selectVideo:function(){M.value.click()},postHasMedia:g(()=>{var t,d;return(d=(t=r.value.relations)==null?void 0:t.media)==null?void 0:d.length}),postHasPoll:g(()=>{var t;return(t=r.value.relations)==null?void 0:t.poll}),postMedia:g(()=>r.value.relations.media),selectGif:t=>{D().postEditor().with({id:t.id}).sendTo("gif/create").then(d=>{e.fetchDraftPost()}).catch(d=>{l(d.response.data.message)}),n.isGifPickerOpen=!1},createPoll:()=>{D().postEditor().sendTo("poll/create").then(t=>{e.fetchDraftPost()}).catch(t=>{l(t.response.data.message)})},submitButtonStatus:g(()=>n.postSubmitting||n.uploadProgress),postMediaButtonStatus:(t=null)=>n.postSubmitting||n.uploadProgress?!0:E.isText(r.value.type)||E.isImage(r.value.type)&&E.isImage(t)?!1:!!r.value.type,deletePostMedia:t=>{t.deleted=!0,D().postEditor().with({id:t.id}).delete("media/delete").then(d=>{e.fetchDraftPost()})},toggleGifPicker:()=>{n.isGifPickerOpen=!n.isGifPickerOpen}}},components:{Toolbar:Y,PrimaryIconButton:X,PostImagePreview:P(()=>v(()=>import("./PostImagePreview-DoNIiy5j.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),PostVideoPreview:P(()=>v(()=>import("./PostVideoPreview-DXDLgVI4.js"),__vite__mapDeps([7,1,2,3,4,5,6,8]))),PostDocumentPreview:P(()=>v(()=>import("./PostDocumentPreview-DsSmMewz.js"),__vite__mapDeps([9,3,4,1,2,5,6]))),PostGifPreview:P(()=>v(()=>import("./PostGifPreview-5Actm7m0.js"),__vite__mapDeps([10,1,2,3,4,5,6,11]))),GIFPicker:P(()=>v(()=>import("./GIFPicker-CB7SUX1n.js"),__vite__mapDeps([12,13,2,3,4,5,6,14]))),PollEditor:P(()=>v(()=>import("./PollEditor-CQWitpQG.js"),__vite__mapDeps([15,3,4,16,2,5,6,17,18,19])))}}),te={class:"shrink-0"},oe={class:"flex-1 overflow-y-auto"},se={class:"flex flex-col h-full"},ne={class:"flex-1"},ie=["placeholder"],ae={class:"shrink-0"},le={key:0},re={class:"flex"},de={class:"flex-1 bg-fill-tr h-1"},ue={class:"shrink-0 px-6 pt-4 pb-4 mb-safe-bottom"},pe={class:"flex gap-2 items-center mb-2 -translate-x-1.5"},ce={class:"ml-auto opacity-80"},me={key:0,class:"text-par-s text-red-900 mb-2"},fe={key:1,class:"text-par-s text-lab-sc"},Pe={key:2,class:"text-par-s text-lab-sc"},ve=["href"],ge={class:"hidden"};function be(e,s,M,C,k,V){const _=u("Toolbar"),b=u("Border"),T=u("PostImagePreview"),r=u("PostVideoPreview"),w=u("PostDocumentPreview"),n=u("PostGifPreview"),l=u("PrimaryIconButton"),F=u("GIFPicker"),h=u("PollEditor");return a(),m(O,null,[o("div",{class:z(["flex flex-col fixed inset-0 z-50 bg-bg-pr",{"pb-5":e.$isStandalone()}])},[o("div",te,[p(_,{title:e.$t("editor.new_post"),onClose:e.leaveEditor},null,8,["title","onClose"])]),p(b,{height:"h-2",opacity:"opacity-60"}),o("div",oe,[o("div",se,[o("div",ne,[L(o("textarea",{ref:"contentInput","onUpdate:modelValue":s[0]||(s[0]=i=>e.postData.content=i),onInput:s[1]||(s[1]=(...i)=>e.textInputHandler&&e.textInputHandler(...i)),class:"resize-none py-4 px-6 h-full w-full leading-normal bg-transparent text-title-3 text-lab-pr2 outline-hidden placeholder:font-light placeholder:text-title-3",placeholder:e.$t("editor.post_text_input_placeholder")},null,40,ie),[[N,e.postData.content]])]),o("div",ae,[e.postHasMedia?(a(),m(O,{key:0},[e.PostTypeUtils.isImage(e.postData.type)?(a(),f(T,{key:0,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):c("",!0),e.PostTypeUtils.isVideo(e.postData.type)?(a(),f(r,{key:1,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):e.PostTypeUtils.isDocument(e.postData.type)||e.PostTypeUtils.isAudio(e.postData.type)?(a(),f(w,{key:2,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):e.PostTypeUtils.isGif(e.postData.type)?(a(),f(n,{key:3,postMedia:e.postMedia,onDelete:e.deletePostMedia},null,8,["postMedia","onDelete"])):c("",!0)],64)):c("",!0)])])]),e.state.uploadProgress?(a(),m("div",le,[o("div",re,[o("div",de,[o("div",{class:"bg-green-900 min-w-10 h-full",style:R({width:e.state.uploadProgress+"%"})},null,4)])])])):c("",!0),o("div",ue,[o("div",pe,[p(l,{onClick:e.selectImage,disabled:e.postMediaButtonStatus(e.PostType.IMAGE),iconName:"image-01",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.selectVideo,disabled:e.postMediaButtonStatus(e.PostType.VIDEO),iconName:"video-recorder",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.selectAudio,disabled:e.postMediaButtonStatus(e.PostType.AUDIO),iconName:"music-note-01",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.createPoll,disabled:e.postMediaButtonStatus(e.PostType.POLL),iconName:"bar-chart-12",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),p(l,{onClick:e.toggleGifPicker,disabled:e.postMediaButtonStatus(e.PostType.GIF),iconName:"gif",iconType:"line",buttonColor:"text-lab-pr3"},null,8,["onClick","disabled"]),o("div",ce,[p(l,{disabled:e.submitButtonStatus,onClick:e.submitForm,iconName:"send-03",buttonColor:"text-lab-pr2"},null,8,["disabled","onClick"])])]),e.validationError?(a(),m("p",me,S(e.validationError),1)):c("",!0),e.userData.is_author?(a(),m("p",fe,S(e.$t("editor.post_privacy")),1)):(a(),m("p",Pe,[U(S(e.$t("editor.post_author_note"))+" ",1),o("a",{href:e.$getRoute("become_author"),class:"hover:underline text-brand-900"},S(e.$t("labels.learn_more")),9,ve)]))]),o("div",ge,[o("input",{onChange:s[2]||(s[2]=(...i)=>e.onImageSelect&&e.onImageSelect(...i)),type:"file",accept:"image/*",ref:"imageFileInput"},null,544),o("input",{onChange:s[3]||(s[3]=(...i)=>e.onVideoSelect&&e.onVideoSelect(...i)),type:"file",accept:"video/*",ref:"videoFileInput"},null,544),o("input",{onChange:s[4]||(s[4]=(...i)=>e.onAudioSelect&&e.onAudioSelect(...i)),type:"file",accept:"audio/*",ref:"audioFileInput"},null,544)])],2),e.state.isGifPickerOpen?(a(),f(F,{key:0,onSelect:e.selectGif,onClose:s[5]||(s[5]=i=>e.state.isGifPickerOpen=!1)},null,8,["onSelect"])):c("",!0),e.postHasPoll?(a(),f(h,{key:1,onLeave:e.leaveEditor},null,8,["onLeave"])):c("",!0)],64)}const Te=$(ee,[["render",be]]);export{Te as default};
