const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LinkSnapshot-C_DWeP4J.js","assets/LinkSnapshot-C0Z1Turo.js","assets/global.properties-DKM1fd6s.js","assets/editor-CpZ7vO5P.js","assets/media-D4ZD3EDk.js","assets/vendor-20TtR0Rd.js"])))=>i.map(i=>d[i]);
import{k as D,c as u,d as n,s as t,z as O,E as q,r as w,e as o,p as b,q as A,i as r,P as H,t as C,l as g,v as y,j as L,F as k,y as x,B as te,b as B,x as I,H as j,f as Y,I as ae,o as U,K as ne,n as W,C as se,G as oe}from"./vendor-20TtR0Rd.js";import{_ as S,a as ie,d as G,b as T,f as K,B as M}from"./global.properties-DKM1fd6s.js";import{u as N,P as re}from"./ParticipantItem-SKbDq5OJ.js";import{d as z,j as V,i as J,a as F,c as Q,T as le}from"./application-C3zsOS77.js";import{D as ce}from"./DropdownButton-CQ32lbq7.js";import{a as de,A as ue}from"./AvatarExtraSmall-CURibG5K.js";import pe from"./ReactionsViewer-BgT-ASy9.js";import me from"./ReactionsPicker-BRIP5Y8A.js";import{A as X}from"./AvatarMedium-DdPpxRFI.js";import{S as he}from"./SheetTitle-CCLXWnJ3.js";import{u as _e}from"./index-ciglwFMH.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./swiper-element-bundle-DBu82uhE.js";import"./smileys-and-emotions-Beo3QNJK.js";const fe=D({props:{avatarSrc:{type:String,default:""}},setup:function(){const e=w(!1);return{isFallback:e,onError:()=>{e.value=!0}}}}),ge={class:"size-2x-small-avatar"},ve={class:"size-full rounded-full bg-bg-pr overflow-hidden"},ye=["src"],Ce=["src"];function $e(e,a,l,p,i,s){return n(),u("div",ge,[t("div",ve,[O(t("img",{src:e.$config("user.default_avatar"),alt:"Avatar"},null,8,ye),[[q,e.isFallback]]),O(t("img",{class:"w-full",onError:a[0]||(a[0]=(...c)=>e.onError&&e.onError(...c)),src:e.avatarSrc,alt:"Avatar"},null,40,Ce),[[q,!e.isFallback]])])])}const Z=S(fe,[["render",$e]]),be={emits:["close","add"],components:{ActionSheet:z,ReactionsPicker:me}};function Se(e,a,l,p,i,s){const c=o("ReactionsPicker",!0),d=o("ActionSheet");return n(),b(d,{onClose:a[1]||(a[1]=h=>e.$emit("close"))},{default:A(()=>[r(c,{onAdd:a[0]||(a[0]=h=>e.$emit("add",h))})]),_:1})}const ke=S(be,[["render",Se]]),De=D({props:{replyData:{type:Object,required:!0}},setup:function(e){return{messageColor:g(()=>e.replyData.participant.color)}}}),Me={class:"flex overflow-hidden"},Ae={class:"flex-1 flex relative items-stretch rounded-tl-md rounded-bl-md rounded-tr-lg rounded-br-lg overflow-hidden"},we={class:"cursor-pointer pl-2 pb-1 pt-2 pr-3 mb-1 relative z-10"},Ee=["innerHTML"];function Re(e,a,l,p,i,s){return n(),u("div",Me,[t("div",Ae,[t("div",{class:"absolute inset-0 opacity-15",style:H({backgroundColor:e.messageColor})},null,4),t("div",{class:"w-1 shrink-0 relative z-10",style:H({backgroundColor:e.messageColor})},null,4),t("div",we,[t("h3",{class:"text-cap-l font-semibold leading-none mb-0.5",style:H({color:e.messageColor})},C(e.replyData.user.name),5),t("p",{class:"text-par-s text-lab-pr2 break-words",innerHTML:e.replyData.content},null,8,Ee)])])])}const Ie=S(De,[["render",Re]]),Te=D({props:{messageData:{type:Object,required:!0}},emits:["delete","reply","copy"],setup:function(e,a){const l=N(),p=Q(),i=g(()=>p.userData),s=w(e.messageData),c=B({menuButton:!1,mainMenu:G(),reactionMenu:G()}),d=g(()=>i.value.id==s.value.user_id),h=g(()=>!s.value.meta.is_deleted);return{isSender:d,state:c,isNotDeleted:h,messageUser:g(()=>s.value.relations.user),replyData:g(()=>s.value.relations.parent),messageColor:g(()=>s.value.relations.participant.color),reply:function(){T.emit("messenger-message:reply",{messageData:s.value})},copyContent:function(){a.emit("copy",s.value)},addReaction:m=>{h.value&&(c.reactionMenu.close(),l.addReaction(m,s.value.id))},deleteMessage:function(){a.emit("delete",{messageId:s.value.id,isSender:d.value})},isMessageSeen:g(()=>l.otherParticipants?l.otherParticipants.some(function(m){return m.last_read_message_id>=s.value.id}):!1),hasReactions:g(()=>s.value.relations.reactions.length),hasLinkSnapshot:g(()=>{var m;return(m=s.value.relations)==null?void 0:m.link_snapshot}),showMenuButton:()=>{if(!h.value)return!1;c.menuButton=!0,debounce(()=>{c.menuButton=!1},1e3)}}},components:{Avatar2ExtraSmall:Z,PrimaryIconButton:F,DropdownButton:ce,ActionSheet:z,ActionSheetItem:J,ActionSheetGroup:V,ActionSheetReactions:de,ReactionsViewer:pe,ReactionsPicker:ke,ChatMessageReply:Ie,LinkSnapshot:te(()=>ie(()=>import("./LinkSnapshot-C_DWeP4J.js"),__vite__mapDeps([0,1,2,3,4,5])))}}),Pe=["title"],Le={class:"flex-1 group"},Be={key:0,class:"shrink-0"},Ne={class:"overflow-hidden"},He={key:0,class:"w-full mb-1"},Ge={key:1,class:"mb-1"},ze={class:"px-1"},Fe={class:"text-par-l text-lab-pr"},Oe=["innerHTML"],je={key:1,class:"text-lab-sc text-par-m"},Ue={class:"leading-none flex items-center justify-end px-1"},Ve={class:"text-cap-l text-lab-sc mr-1"},qe={key:0,class:"size-4 text-brand-900"},xe={key:1,class:"size-4 text-lab-sc"},Ye={key:1,class:"shrink-0 w-x-small-avatar self-center"},We={key:0,class:"block mt-1"},Ke={class:"ml-2x-small-avatar pl-2.5"},Je={class:"mb-4"};function Qe(e,a,l,p,i,s){const c=o("Avatar2ExtraSmall"),d=o("LinkSnapshot"),h=o("ChatMessageReply"),m=o("SvgIcon"),f=o("DropdownButton"),v=o("ReactionsViewer"),E=o("ActionSheetReactions"),R=o("ActionSheetItem"),_=o("ActionSheetGroup"),$=o("ActionSheet"),ee=o("ReactionsPicker");return n(),u(k,null,[t("div",{class:"px-4 py-0.5",onClick:a[0]||(a[0]=(...P)=>e.showMenuButton&&e.showMenuButton(...P)),onDblclick:a[1]||(a[1]=x((...P)=>e.reply&&e.reply(...P),["stop"])),title:e.$t("chat.double_click_to_reply")},[t("div",Le,[t("div",{class:L(["flex gap-2.5 items-end",{"flex-row-reverse":e.isSender}])},[e.isSender?y("",!0):(n(),u("div",Be,[r(c,{avatarSrc:e.messageUser.avatar_url},null,8,["avatarSrc"])])),t("div",Ne,[t("div",{class:L(["flex",{"flex-row-reverse":e.isSender}])},[t("div",{class:L(["overflow-hidden flex-1 rounded-xl p-1 w-fit min-w-3/12 max-w-80",[e.isSender?"bg-fill-qt border border-fill-fv":"border border-bord-pr"]])},[e.hasLinkSnapshot?(n(),u("div",He,[r(d,{linkSnapshot:e.messageData.relations.link_snapshot},null,8,["linkSnapshot"])])):y("",!0),e.messageData.has_parent?(n(),u("div",Ge,[r(h,{replyData:e.replyData},null,8,["replyData"])])):y("",!0),t("div",ze,[t("p",Fe,[e.isNotDeleted?(n(),u("span",{key:0,innerHTML:e.$mdInline(e.messageData.content)},null,8,Oe)):(n(),u("span",je,C(e.$t("chat.message_is_deleted")),1))])]),t("div",Ue,[t("time",Ve,C(e.messageData.date.time_ago),1),e.isSender?(n(),u(k,{key:0},[e.isMessageSeen?(n(),u("span",qe,[r(m,{type:"line",name:"message-double-check"})])):(n(),u("span",xe,[r(m,{type:"line",name:"message-check"})]))],64)):y("",!0)])],2)],2)]),e.isNotDeleted?(n(),u("div",Ye,[e.state.menuButton?(n(),b(f,{key:0,onClick:e.state.mainMenu.open},null,8,["onClick"])):y("",!0)])):y("",!0)],2),e.isNotDeleted&&e.hasReactions?(n(),u("div",We,[t("div",{class:L(["flex",[e.isSender?"flex-row-reverse":""]])},[t("div",Ke,[r(v,{onAdd:e.addReaction,reactions:e.messageData.relations.reactions},null,8,["onAdd","reactions"])])],2)])):y("",!0)])],40,Pe),e.isNotDeleted&&e.state.mainMenu.status?(n(),b($,{key:0,onClose:e.state.mainMenu.close,isMuted:!0},{default:A(()=>[t("div",{onClick:a[2]||(a[2]=x((...P)=>e.state.mainMenu.close&&e.state.mainMenu.close(...P),["stop"]))},[t("div",Je,[r(E,{onAdd:e.addReaction},null,8,["onAdd"])]),r(_,null,{default:A(()=>[r(R,{onClick:e.state.reactionMenu.open,iconName:"heart-rounded",textLabel:e.$t("dd.add_reaction")},null,8,["onClick","textLabel"]),r(R,{onClick:e.reply,iconName:"pencil-line",textLabel:e.$t("dd.message.reply",{name:e.messageUser.name})},null,8,["onClick","textLabel"]),r(R,{onClick:e.deleteMessage,itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.message.delete_message")},null,8,["onClick","textLabel"]),r(R,{onClick:e.copyContent,iconName:"type-01",textLabel:e.$t("dd.copy_text")},null,8,["onClick","textLabel"])]),_:1})])]),_:1},8,["onClose"])):y("",!0),e.state.reactionMenu.status?(n(),b(ee,{key:1,onAdd:e.addReaction,onClose:e.state.reactionMenu.close},null,8,["onAdd","onClose"])):y("",!0)],64)}const Xe=S(Te,[["render",Qe]]),Ze=D({props:{chatData:{type:Object,required:!0}},components:{AvatarMedium:X}}),et={class:"block"},tt={class:"flex justify-center mb-2"},at={class:"text-center leading-snug"},nt={class:"text-title-3 font-bold text-lab-pr"},st={class:"text-par-s text-lab-sc"};function ot(e,a,l,p,i,s){const c=o("AvatarMedium"),d=o("VerificationBadge");return n(),u("div",et,[t("div",tt,[r(c,{avatarSrc:e.chatData.chat_info.avatar_url},null,8,["avatarSrc"])]),t("div",at,[t("h2",nt,[I(C(e.chatData.chat_info.name)+" ",1),e.chatData.chat_info.verified?(n(),b(d,{key:0,size:"sm"})):y("",!0)]),t("p",st,C(e.$t("labels.was_online_at",{time:e.chatData.chat_info.last_active.formatted})),1)])])}const it=S(Ze,[["render",ot]]),rt=D({emits:["close","open-participants"],props:{chatData:{type:Object,required:!0}},setup:function(e){const a=w(e.chatData),l=N(),p=j();return{clearChat:()=>{T.emit("confirmation-modal:open",{title:__t("prompt.clear_conversation.title"),description:__t("prompt.clear_conversation.desc"),confirmButtonText:__t("prompt.clear_conversation.confirm"),onConfirm:async()=>{try{l.chatMessages.length&&await l.clearChat(),toastSuccess(__t("toast.chat.chat_cleared"),3e3)}catch(i){toastError(i,3e3)}}})},deleteChat:()=>{T.emit("confirmation-modal:open",{title:__t("prompt.delete_chat.title"),description:__t("prompt.delete_chat.desc"),onConfirm:async()=>{try{await l.deleteChat(),p.push({name:"messenger_index"}),toastSuccess(__t("toast.chat.chat_deleted"),3e3)}catch(i){toastError(i,3e3)}}})},reportChat:()=>{T.emit("report:open",{type:"user",reportableId:a.value.chat_info.id})}}},components:{ActionSheet:z,ActionSheetItem:J,ActionSheetGroup:V,AvatarMedium:X,DirectChatOverview:it}}),lt={class:"mb-4"},ct={class:"px-4 mt-4 text-center"},dt={class:"text-lab-sc text-cap-l"};function ut(e,a,l,p,i,s){const c=o("DirectChatOverview"),d=o("ActionSheetItem"),h=o("RouterLink"),m=o("ActionSheetGroup"),f=o("ActionSheet");return n(),b(f,{onClose:a[3]||(a[3]=v=>e.$emit("close")),isMuted:!0},{default:A(()=>[t("div",lt,[r(c,{chatData:e.chatData},null,8,["chatData"])]),t("div",{class:"mb-4",onClick:a[1]||(a[1]=v=>e.$emit("close"))},[r(m,null,{default:A(()=>[r(h,{to:{name:"profile_index",params:{id:e.chatData.chat_info.username}}},{default:A(()=>[r(d,{notLast:!0,textLabel:e.$t("labels.view_profile"),iconName:"arrow-up-right"},null,8,["textLabel"])]),_:1},8,["to"]),r(d,{onClick:a[0]||(a[0]=v=>e.$emit("open-participants")),textLabel:e.$t("chat.participants_count",{count:e.chatData.chat_info.participants_count.formatted}),iconName:"users-01"},null,8,["textLabel"]),r(d,{onClick:e.clearChat,textLabel:e.$t("chat.clear_conversation"),iconName:"brush-03"},null,8,["onClick","textLabel"])]),_:1})]),r(m,{onClick:a[2]||(a[2]=v=>e.$emit("close"))},{default:A(()=>[r(d,{onClick:e.reportChat,itemColor:"text-red-900",textLabel:e.$t("labels.report_this_user",{user_name:e.chatData.chat_info.name}),iconName:"annotation-alert"},null,8,["onClick","textLabel"]),r(d,{itemColor:"text-red-900",onClick:e.deleteChat,textLabel:e.$t("chat.delete_chat"),iconName:"trash-04"},null,8,["onClick","textLabel"])]),_:1}),t("div",ct,[t("span",dt,C(e.$t("chat.chat_created_date",{date:e.chatData.date.iso})),1)])]),_:1})}const pt=S(rt,[["render",ut]]),mt=D({props:{chatData:{type:Object,required:!0}},setup:function(e,a){const l=B({isLoading:!0}),p=N(),i=g(()=>p.chatParticipants);return U(async()=>{try{await p.fetchChatParticipants(),l.isLoading=!1}catch(s){alert(s)}}),{chatParticipants:i,state:l}},components:{ParticipantItem:re,ActionSheet:z,ActionSheetGroup:V,SheetTitle:he}}),ht={class:"mb-4 px-4 text-center"},_t={key:0,class:"block"},ft={key:1},gt={class:"block max-h-[500px] overflow-y-auto"},vt={class:"text-par-n text-green-900"};function yt(e,a,l,p,i,s){const c=o("SheetTitle"),d=o("ParticipantItem"),h=o("ActionSheetGroup"),m=o("ActionSheet");return n(),b(m,{isMuted:!0},{default:A(()=>[t("div",ht,[r(c,{title:e.$t("chat.participants_count",{count:e.chatData.chat_info.participants_count.formatted})},null,8,["title"])]),e.state.isLoading?(n(),u("div",_t,a[0]||(a[0]=[t("div",{class:"flex-center h-24"},[t("div",{class:"colibri-primary-animation"})],-1)]))):(n(),u("div",ft,[r(h,null,{default:A(()=>[t("div",gt,[(n(!0),u(k,null,Y(e.chatParticipants,f=>(n(),b(d,{name:f.relations.user.name,caption:e.$t("labels.was_online_at",{time:f.relations.user.last_active.time_ago}),verified:f.relations.user.verified,avatarSrc:f.relations.user.avatar_url,username:f.relations.user.username},ae({_:2},[f.relations.user.is_auth_user?{name:"caption",fn:A(()=>[t("span",vt," ~ "+C(e.$t("labels.you")),1)]),key:"0"}:void 0]),1032,["name","caption","verified","avatarSrc","username"]))),256))])]),_:1})]))]),_:1})}const Ct=S(mt,[["render",yt]]),$t=D({emits:["close"],props:{typingUser:{type:Object,default:{is_typing:!1,user:null}},chatData:{type:Object,required:!0}},setup:function(e,a){const l=j(),p=B({mainMenu:G(),participantsMenu:G()});return{state:p,isTyping:g(()=>e.typingUser.is_typing===!0),openInfo:()=>{e.chatData.is_group?l.push({name:"messenger_group",params:{chat_id:e.chatData.id}}):p.mainMenu.open()}}},components:{AvatarExtraSmall:ue,PrimaryIconButton:F,ChatInfoSheet:pt,ChatParticipants:Ct}}),bt={class:"px-4 py-3 flex items-center leading-none gap-2.5 border-b border-bord-tr"},St={class:"shrink-0"},kt={class:"text-par-s truncate mt-1 text-lab-sc"},Dt={key:0,class:"text-green-900 font-medium"},Mt={class:"shrink-0"};function At(e,a,l,p,i,s){const c=o("PrimaryIconButton"),d=o("AvatarExtraSmall"),h=o("Name"),m=o("ChatInfoSheet"),f=o("ChatParticipants");return n(),u(k,null,[t("div",bt,[t("div",St,[r(c,{onClick:a[0]||(a[0]=v=>e.$emit("close")),buttonColor:"text-lab-pr",iconSize:"icon-medium",iconName:"chevron-left"})]),t("div",{class:"shrink-0 cursor-pointer",onClick:a[1]||(a[1]=(...v)=>e.openInfo&&e.openInfo(...v))},[r(d,{avatarSrc:e.chatData.chat_info.avatar_url},null,8,["avatarSrc"])]),t("div",{class:"flex-1 overflow-hidden cursor-pointer",onClick:a[2]||(a[2]=(...v)=>e.openInfo&&e.openInfo(...v))},[r(h,{name:e.chatData.chat_info.name},null,8,["name"]),t("p",kt,[e.isTyping?(n(),u("span",Dt,[e.chatData.is_group?(n(),u(k,{key:0},[I(C(e.$t("chat.user_is_typing",{name:e.typingUser.user.name})),1)],64)):(n(),u(k,{key:1},[I(C(e.$t("chat.typing")),1)],64))])):(n(),u(k,{key:1},[e.chatData.is_group?(n(),u(k,{key:0},[I(C(e.$t("chat.participants_count",{count:e.chatData.chat_info.participants_count.formatted})),1)],64)):(n(),u(k,{key:1},[I(C(e.$t("labels.was_online_at",{time:e.chatData.chat_info.last_active.formatted})),1)],64))],64))])]),t("div",Mt,[r(c,{onClick:e.openInfo,iconType:"line",iconName:(e.chatData.is_group,"info-circle")},null,8,["onClick","iconName"])])]),e.state.mainMenu.status?(n(),b(m,{key:0,chatData:e.chatData,onOpenParticipants:e.state.participantsMenu.open,onClose:e.state.mainMenu.close},null,8,["chatData","onOpenParticipants","onClose"])):y("",!0),e.state.participantsMenu.status?(n(),b(f,{key:1,chatData:e.chatData,onClose:e.state.participantsMenu.close},null,8,["chatData","onClose"])):y("",!0)],64)}const wt=S($t,[["render",At]]),Et=D({props:{messageData:{type:Object,required:!0}},emits:["cancel"],setup:function(e,a){const l=w(e.messageData);return{messageData:l,cancelMessageReply:()=>{a.emit("cancel")},messageColor:g(()=>l.value.relations.participant.color)}},components:{PrimaryIconButton:F}}),Rt={class:"px-4 pt-3 border-t border-t-bord-tr"},It={class:"flex overflow-hidden items-center gap-2.5"},Tt={class:"size-2x-small-avatar shrink-0"},Pt={class:"flex-1 overflow-hidden"},Lt={class:"text-par-s font-medium leading-none"},Bt={class:"text-par-xs text-lab-sc leading-none ml-1 font-normal"},Nt=["innerHTML"],Ht={class:"shrink-0"};function Gt(e,a,l,p,i,s){const c=o("SvgIcon"),d=o("PrimaryIconButton");return n(),u("div",Rt,[t("div",It,[t("div",Tt,[t("div",{style:H({backgroundColor:e.messageColor}),class:"size-2x-small-avatar inline-flex-center overflow-hidden rounded-full"},[r(c,{name:"share-06",type:"line",classes:"size-icon-x-small text-white"})],4)]),t("div",Pt,[t("h5",Lt,[I(C(e.messageData.relations.user.name)+" ",1),t("span",Bt,C(e.messageData.date.time_ago),1)]),t("p",{class:"text-par-n truncate text-lab-pr3 mt-0.5",innerHTML:e.messageData.content},null,8,Nt)]),t("div",Ht,[r(d,{onClick:e.cancelMessageReply},null,8,["onClick"])])])])}const zt=S(Et,[["render",Gt]]),Ft=D({emits:["typing"],setup:function(e,a){const l=N(),p=w(null),i=w(""),s=w(null),{autoResize:c}=_e(),d=B({isSubmitting:!1});U(()=>{T.on("messenger-message:reply",f=>{s.value=f.messageData,p.value&&p.value.focus()})});const h=function(){c(p.value),a.emit("typing")};return{state:d,messageContent:i,submitForm:async function(f){try{if(d.isSubmitting=!0,i.value.length){const E={content:i.value};i.value="",s.value&&(E.parent_id=s.value.id),s.value=null,await l.sendMessage(E),W(()=>{h()}),K.chatMessageSent()}d.isSubmitting=!1}catch(v){alert(v)}},repliedMessage:s,messageContentField:p,messageInputHandler:h,isReplaying:g(()=>s.value!==null),submitButtonStatus:g(()=>d.isSubmitting||!i.value.length),cancelReply:()=>{s.value=null},inputPlaceholder:g(()=>d.isSubmitting?__t("chat.sending_message"):s.value?__t("chat.write_reply"):__t("chat.write_message"))}},components:{PrimaryIconButton:F,ToastNotification:le,MessageReplyPreview:zt}}),Ot={class:"pb-3 px-4 pt-3"},jt={class:"relative leading-none"},Ut=["placeholder"],Vt={class:"absolute right-2 top-2"},qt={class:"flex gap-4"},xt={class:"shrink-0"};function Yt(e,a,l,p,i,s){const c=o("ToastNotification"),d=o("MessageReplyPreview"),h=o("PrimaryIconButton");return n(),u(k,null,[r(c),e.repliedMessage?(n(),b(d,{messageData:e.repliedMessage,onCancel:e.cancelReply,key:e.repliedMessage.id},null,8,["messageData","onCancel"])):y("",!0),t("div",Ot,[t("div",jt,[O(t("textarea",{ref:"messageContentField",class:"resize-none pl-5 pt-3 pr-16 pb-2 leading-normal text-lab-pr text-par-l bg-fill-qt w-full h-12 min-h-12 max-h-40 overflow-x-hidden overflow-y-auto rounded-3xl outline-hidden placeholder:text-par-l placeholder:text-lab-sc placeholder:font-normal","onUpdate:modelValue":a[0]||(a[0]=m=>e.messageContent=m),onInput:a[1]||(a[1]=(...m)=>e.messageInputHandler&&e.messageInputHandler(...m)),placeholder:e.inputPlaceholder},null,40,Ut),[[ne,e.messageContent,void 0,{trim:!0}]]),t("div",Vt,[t("div",qt,[t("div",xt,[r(h,{disabled:e.submitButtonStatus,onClick:e.submitForm,iconName:"send-03",iconSize:"icon-normal",buttonColor:"text-brand-900"},null,8,["disabled","onClick"])])])])])])],64)}const Wt=S(Ft,[["render",Yt]]),Kt=D({components:{Avatar2ExtraSmall:Z},props:{typingUser:{type:Object,default:{is_typing:!1,user:null}}},setup:function(e){return{isTyping:g(()=>e.typingUser.is_typing===!0)}}}),Jt={key:0,class:"flex px-4 gap-2"};function Qt(e,a,l,p,i,s){const c=o("Avatar2ExtraSmall");return e.isTyping?(n(),u("div",Jt,[r(c,{avatarSrc:e.typingUser.user.avatar_url},null,8,["avatarSrc"]),a[0]||(a[0]=t("div",{class:"w-12 flex items-center justify-center"},[t("div",{class:"colibri-primary-animation"})],-1))])):y("",!0)}const Xt=S(Kt,[["render",Qt]]),Zt=D({setup:function(){const e=se(),a=j(),l=w(null),p=Q(),i=N(),s=w(null),c=g(()=>p.userData),d=g(()=>i.chatMessages),h=g(()=>i.chatData),m=B({isLoading:!0,typing:{is_typing:!1,user:null}}),f=function(){W(()=>{l.value.scrollTop=l.value.scrollHeight})};oe(()=>{window.ColibriBRConnected&&(v(M.getEvent("CHAT_MESSAGE_RECEIVED")),v(M.getEvent("CHAT_MESSAGE_READ")),v(M.getEvent("CHAT_MESSAGE_DELETED")),ColibriBRD.private(s.value).stopListeningForWhisper(M.getEvent("CHAT_MESSAGE_TYPING")))});const v=_=>{ColibriBRD.private(s.value).stopListening(_)},E=(_,$)=>{ColibriBRD.private(s.value).listen(_,$)},R=_=>{ColibriBRD.private(s.value).whisper(M.getEvent("CHAT_MESSAGE_TYPING"),{data:{user:{name:c.value.name,avatar_url:c.value.avatar_url},is_typing:_}})};return U(async function(){try{await i.fetchChatData(e.params.chat_id),await i.fetchChatMessages(),d.value.length>0&&(i.markMessagesAsRead(),debounce(()=>{f()},500)),m.isLoading=!1,s.value=M.getChannel("CHAT",[h.value.chat_id]),window.ColibriBRConnected&&(E(M.getEvent("CHAT_MESSAGE_RECEIVED"),function(_){let $=_.data;i.appendMessage($),f(),c.value.id!=$.user_id&&(K.activeChatMessageReceived(),i.markMessagesAsRead())}),E(M.getEvent("CHAT_MESSAGE_DELETED"),function(_){i.markMessageAsDeleted(_.data.message_id)}),ColibriBRD.private(s.value).listenForWhisper(M.getEvent("CHAT_MESSAGE_TYPING"),function(_){m.typing=_.data}),E(M.getEvent("CHAT_MESSAGE_READ"),function(_){i.updateLastReadMessageForParticipant(_.data)})),f()}catch{a.push({name:"messenger_inbox"})}}),{chatMessages:d,state:m,chatData:h,messagesHistoryContainer:l,isTyping:g(()=>m.typing.is_typing),handleMessageDelete:_=>{const $={title:__t("prompt.delete_message.title"),description:_.isSender?__t("prompt.delete_message.description"):__t("prompt.delete_message_for_me.description"),confirmButtonText:_.isSender?null:__t("prompt.delete_message_for_me.confirm"),onConfirm:async()=>{await i.deleteMessage(_.messageId)}};_.isSender&&($.confirmSecondary=!0,$.confirmSecondaryText=__t("chat.delete_message_for_all"),$.onConfirmSecondary=async()=>{await i.deleteMessage(_.messageId,!0)}),T.emit("confirmation-modal:open",$)},handleMessageCopy:_=>{try{navigator.clipboard.writeText(_.content).then(()=>{toastSuccess(__t("toast.chat.message_text_copied"),1e3)})}catch($){toastError($)}},handleMessageTyping:()=>{window.ColibriBRConnected&&(R(!0),debounce(()=>{R(!1)},1e3))}}},components:{ChatMessage:Xe,ChatHeader:wt,ChatMessageTyping:Xt,ChatEditor:Wt}}),ea={class:"fixed inset-0 bg-bg-pr flex flex-col mb-safe-bottom"},ta={key:0,class:"shrink-0"},aa={class:"flex-1 overflow-y-auto py-4",ref:"messagesHistoryContainer"},na={class:"block"},sa={key:1,class:"h-full flex items-center justify-center"},oa={class:"text-par-s text-lab-sc"},ia={class:"h-8 py-2"};function ra(e,a,l,p,i,s){const c=o("ChatHeader"),d=o("ChatMessage"),h=o("ChatMessageTyping"),m=o("ChatEditor");return n(),u("div",ea,[e.state.isLoading?y("",!0):(n(),u("div",ta,[r(c,{onClose:a[0]||(a[0]=f=>e.$router.push({name:"messenger_inbox"})),chatData:e.chatData,typingUser:e.state.typing},null,8,["chatData","typingUser"])])),t("div",aa,[e.chatMessages.length?(n(!0),u(k,{key:0},Y(e.chatMessages,f=>(n(),u("div",na,[(n(),b(d,{onDelete:e.handleMessageDelete,onCopy:e.handleMessageCopy,messageData:f,key:f.id},null,8,["onDelete","onCopy","messageData"]))]))),256)):(n(),u("div",sa,[t("p",oa,C(e.$t("chat.no_messages_found")),1)])),t("div",ia,[r(h,{typingUser:e.state.typing},null,8,["typingUser"])])],512),e.state.isLoading?y("",!0):(n(),u("div",{key:1,class:L(["shrink-0",{"pb-5":e.$isStandalone()}])},[r(m,{onTyping:e.handleMessageTyping},null,8,["onTyping"])],2))])}const Sa=S(Zt,[["render",ra]]);export{Sa as default};
