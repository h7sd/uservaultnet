import{k as w,l as s,_ as y,d as v,r,c as d,o as c,a as l,m as h,w as b,j as i,p,e as S,t as f,f as m,n as M}from"./global.properties-ieI6Xwik.js";import{g as C,A as k}from"./application-B35z453N.js";const H=w("mobile_chats_chat",{state:()=>({chatId:null,chatData:{},chatMessages:[],chatParticipants:[],inboxStore:C()}),getters:{otherParticipants:function(){return this.chatData.relations.participants}},actions:{fetchChatData:async function(e){await s().messenger().getFrom(`chat/${e}`).then(t=>{this.chatData=t.data.data,this.chatId=e}).catch(t=>{if(t.response)throw new Error(t.response.data.message)})},fetchChatParticipants:async function(){await s().messenger().getFrom(`chat/${this.chatId}/participants`).then(e=>{this.chatParticipants=e.data.data}).catch(e=>{if(e.response)throw new Error(e.response.data.message)})},fetchChatMessages:async function(){await s().messenger().getFrom(`chat/${this.chatId}/messages`).then(e=>{this.chatMessages=e.data.data}).catch(e=>{if(e.response)throw new Error(e.response.data.message)})},deleteMessage:async function(e,t=!1){await s().messenger().with({message_id:e,payload:{delete_for_all:t}}).delete("chat/message/delete").then(a=>{if(!a.data.data.is_global_delete){let n=this.chatMessages.findIndex(o=>o.id==e);n!==-1&&this.chatMessages.splice(n,1)}}).catch(function(a){a.response&&alert(a.response.data.message)})},sendMessage:async function(e={}){await s().messenger().with({chat_id:this.chatId,...e}).sendTo("send").catch(function(t){if(t.response)throw new Error(t.response.data.message)})},appendMessage:function(e={}){this.chatMessages.push(e);let t=this.inboxStore.chatsHistory.find(a=>e.chat_uuid==a.chat_id);t&&(t.last_message=e.content)},markMessageAsDeleted:async function(e){let t=this.chatMessages.find(a=>a.id==e);t&&(t.meta.is_deleted=!0)},updateLastReadMessageForParticipant:function(e){this.otherParticipants.forEach(t=>{t.last_read_message_id=e.last_read_message_id})},markMessagesAsRead:function(){s().messenger().getFrom(`chat/${this.chatId}/read`).catch(function(e){alert(e.response.data.message)})},addReaction:function(e,t){s().messenger().with({unified_id:e,message_id:t}).sendTo("chat/message/add-reaction").then(a=>{let n=this.chatMessages.find(o=>o.id==t);n&&(n.relations.reactions=a.data.data)}).catch(a=>{a.response&&alert(a.response.data.message)})},clearChat:async function(){await s().messenger().delete(`chat/${this.chatId}/clear`).then(e=>{this.chatMessages=[]}).catch(e=>{if(e.response)throw new Error(e.response.data.message)})},deleteChat:async function(){await s().messenger().delete(`chat/${this.chatId}/delete`).then(e=>{this.chatMessages=[],this.inboxStore.removeChatFromHistory(this.chatId)}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},archiveChat:async function(e){await s().messenger().delete(`chat/${e}/archive`).then(t=>{this.inboxStore.removeChatFromHistory(e)}).catch(function(t){if(t.response)throw new Error(t.response.data.message)})},unarchiveChat:async function(e){await s().messenger().delete(`chat/${e}/unarchive`).then(t=>{this.inboxStore.fetchChatsHistory()}).catch(function(t){if(t.response)throw new Error(t.response.data.message)})}}}),$=v({props:{name:{type:String,default:""},username:{type:String,default:""},caption:{type:String,default:""},verified:{type:Boolean,default:!1},avatarSrc:{type:String,default:""},disabled:{type:Boolean,default:!1}},components:{AvatarSmall:k}}),x={class:"flex items-center gap-2.5"},E={class:"shrink-0"},I={class:"flex-1 overflow-hidden"},P={class:"text-par-m font-semibold text-lab-pr2 truncate mb-1"},A={class:"text-par-n text-lab-sc truncate"},B={key:0,class:"shrink-0"};function F(e,t,a,n,o,V){const g=r("AvatarSmall"),u=r("VerificationBadge"),_=r("RouterLink");return c(),d("div",{class:M([[e.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"],"flex last:border-none border-b border-bord-tr items-center hover:bg-fill-qt py-3.5 px-4 leading-none"])},[l(_,{to:{name:"profile_index",params:{id:e.username}},target:"_blank",class:"shrink-0 flex-1 overflow-hidden"},{default:b(()=>[i("div",x,[i("div",E,[l(g,{avatarSrc:e.avatarSrc},null,8,["avatarSrc"])]),i("div",I,[i("h3",P,[p(f(e.name)+" ",1),e.verified?(c(),S(u,{key:0,size:"xs"})):h("",!0)]),i("p",A,[p(f(e.caption)+" ",1),e.$slots.caption?m(e.$slots,"caption",{key:0}):h("",!0)])])])]),_:3},8,["to"]),e.disabled?h("",!0):(c(),d("div",B,[m(e.$slots,"default")]))],2)}const N=y($,[["render",F]]);export{N as P,H as u};
