import{k as r,l as n}from"./global.properties-ieI6Xwik.js";import{u as o}from"./inbox.store-DKf8FrGP.js";const f=r("chats_chat",{state:()=>({chatId:null,chatData:{},chatMessages:[],chatParticipants:[],inboxStore:o()}),getters:{isDirect:function(){return this.chatData.type=="direct"},hasDescription:function(){return this.chatData.chat_info.description.length>0},otherParticipants:function(){return this.chatData.relations.participants}},actions:{fetchChatData:async function(t){let e=this;await n().messenger().getFrom(`chat/${t}`).then(function(a){e.chatData=a.data.data,e.chatId=t}).catch(function(a){if(a.response)throw new Error(a.response.data.message)})},fetchChatParticipants:async function(){let t=this;await n().messenger().getFrom(`chat/${t.chatId}/participants`).then(function(e){t.chatParticipants=e.data.data}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},markMessagesAsRead:function(){let t=this;n().messenger().getFrom(`chat/${t.chatId}/read`).catch(function(e){alert(e.response.data.message)})},fetchChatMessages:async function(){let t=this;await n().messenger().getFrom(`chat/${t.chatId}/messages`).then(function(e){t.chatMessages=e.data.data}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},sendMessage:async function(t={}){let e=this;await n().messenger().with({chat_id:e.chatId,...t}).sendTo("send").catch(function(a){if(a.response)throw new Error(a.response.data.message)})},deleteMessage:async function(t,e=!1){let a=this;await n().messenger().with({message_id:t,payload:{delete_for_all:e}}).delete("chat/message/delete").then(s=>{if(!s.data.data.is_global_delete){let i=a.chatMessages.findIndex(c=>c.id==t);i!==-1&&a.chatMessages.splice(i,1)}}).catch(function(s){s.response&&alert(s.response.data.message)})},archiveChat:async function(t){await n().messenger().delete(`chat/${t}/archive`).then(e=>{this.inboxStore.removeChatFromHistory(t)}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},unarchiveChat:async function(t){await n().messenger().delete(`chat/${t}/unarchive`).then(e=>{this.inboxStore.fetchChatsHistory()}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},clearChatConversation:async function(){let t=this;await n().messenger().delete(`chat/${t.chatId}/clear`).then(function(e){t.chatMessages=[]}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},deleteChat:async function(){let t=this;await n().messenger().delete(`chat/${t.chatId}/delete`).then(function(e){t.chatMessages=[],t.inboxStore.removeChatFromHistory(t.chatId)}).catch(function(e){if(e.response)throw new Error(e.response.data.message)})},markMessageAsDeleted:async function(t){let e=this.chatMessages.find(a=>a.id==t);e&&(e.meta.is_deleted=!0)},addReaction:function(t,e){let a=this;n().messenger().with({unified_id:t,message_id:e}).sendTo("chat/message/add-reaction").then(s=>{let i=a.chatMessages.find(c=>c.id==e);i&&(i.relations.reactions=s.data.data)}).catch(s=>{s.response&&alert(s.response.data.message)})},updateLastReadMessageForParticipant:function(t){let e=this.chatData.relations.participants.find(a=>t.user_id==a.user_id);e&&(e.last_read_message_id=t.last_read_message_id)},appendMessage:function(t={}){let e=this;e.chatMessages.push(t);let a=e.inboxStore.chatsHistory.find(s=>t.chat_uuid==s.chat_id);a&&(a.last_message=t.content)}}});export{f as u};
