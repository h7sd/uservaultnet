import{u as A,k as E,c as a,i as e,p as u,q as l,e as o,Q as N,F as f,b as R,l as T,o as M,G,d as s,x as h,t as y,f as k,v as C,s as b}from"./vendor-20TtR0Rd.js";import{c as L,_ as q}from"./global.properties-DKM1fd6s.js";import{u as V}from"./index-B5kc-12x.js";import{A as D,T as j,S as Q}from"./AdGridItem-Caaf0ZJU.js";import{F as z}from"./FollowRecommendationList-UjQQknis.js";import{T as H}from"./TimelinePublication-AFX4WV3m.js";import{T as J}from"./TimelinePublicationSkeleton-BPtyMk-B.js";import{F as K}from"./FluidEmptyState-DExNov7G.js";import{p as O}from"./application-DEz9sPnz.js";import{T as W}from"./TabsLink-HnUGLLWk.js";import{T as X}from"./TimelineCallout-DsRcAxDP.js";import{S as Y}from"./ScrollTopButton-BIhzsUlF.js";import{F as Z}from"./FeedUpdate-Ct7CJ-e7.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./TranslationService-CWFwUQ3g.js";import"./swiper-element-bundle-DBu82uhE.js";import"./ViewsCounter-DDf6U7Tj.js";import"./PublicationQuote-C7H0KLSU.js";import"./AvatarExtraSmall-CDoWzwp5.js";import"./ProgressiveImageLoader-8evwBPct.js";import"./SpinnerIcon-BFpWBik4.js";import"./VideoDurationTime-DjdOjCKw.js";import"./inbox.store-CHx7CB4w.js";import"./index-ciglwFMH.js";import"./ui-Bp8YvxdW.js";const tt=A("explore_posts_store",{state:function(){return{updateAttempts:0,posts:[],update:[],filter:{page:1}}},actions:{updateFeed:async function(){await L().explore().params({filter:{onset:this.posts.at(0).id}}).sendTo("posts").then(t=>{this.update=t.data.data}).catch(t=>{t.response&&(state.update=[])})},applyUpdate:function(){this.update.forEach(t=>{this.posts.slice(0,this.update.length).some(r=>r.id===t.id)||this.posts.unshift(t)}),this.update=[]},makeLoadRequest:async function(){return await L().explore().with({filter:this.filter}).sendTo("posts")},fetchPosts:async function(){await this.makeLoadRequest().then(t=>{this.posts=t.data.data})},loadMorePosts:async function(){return await this.makeLoadRequest().then(t=>{let n=t.data.data;return n.length?(this.posts=this.posts.concat(n),!0):!1}).catch(()=>!1)},getLastPostId:function(){return this.posts.at(-1).id},resetFilter:function(){this.filter={page:1}}}}),et=E({setup:function(){const t=R({isLoading:!0,isLoadingContent:!1,noMoreContent:!1,isUpdating:!1});let n=null,r=0;const i=tt(),d=T(()=>i.update),c=T(()=>i.posts);return V({callback:async()=>{!t.isLoadingContent&&!t.noMoreContent&&(t.isLoadingContent=!0,i.filter.page+=1,t.noMoreContent=!await i.loadMorePosts(),t.isLoadingContent=!1)}}),M(async()=>{t.isLoading=!0,i.resetFilter(),await i.fetchPosts(),t.isLoading=!1,c.value.length&&(n=setInterval(async()=>{t.isUpdating||(d.value.length==0&&r>10?clearInterval(n):(t.isUpdating=!0,await i.updateFeed(),t.isUpdating=!1,r++))},60*1e3*10))}),G(()=>{n&&clearInterval(n)}),{state:t,posts:c,newPosts:d,applyNewPosts:()=>{i.applyUpdate()}}},components:{SidedContentLayout:Q,TimelineContainer:j,FollowRecommendationList:z,AdGridItem:D,TimelinePublication:H,FluidEmptyState:K,TimelinePublicationSkeleton:J,ContentTabs:O,TabsLink:W,TimelineCallout:X,ScrollTopButton:Y,FeedUpdate:Z}}),ot={key:0,class:"block"},nt={key:1,class:"block"},st={key:1},it={key:2},at={key:3};function lt(t,n,r,i,d,c){const _=o("TabsLink"),g=o("ContentTabs"),m=o("Border"),P=o("TimelineCallout"),S=o("TimelinePublicationSkeleton"),F=o("FeedUpdate"),w=o("TimelinePublication"),v=o("FluidEmptyState"),I=o("TimelineContainer"),U=o("FollowRecommendationList"),x=o("AdGridItem"),B=o("SidedContentLayout"),$=o("ScrollTopButton");return s(),a(f,null,[e(B,null,{content:l(()=>[e(I,null,{default:l(()=>[e(g,{cols:2},{default:l(()=>[e(_,{link:{name:"explore_posts"}},{default:l(()=>[h(y(t.$t("labels.explore")),1)]),_:1}),e(_,{link:{name:"explore_people"}},{default:l(()=>[h(y(t.$t("labels.people")),1)]),_:1})]),_:1}),e(m),e(P,{iconName:"star-04",iconType:"solid",title:t.$t("info.explore_posts.title"),desc:t.$t("info.explore_posts.desc")},null,8,["title","desc"]),e(m),t.state.isLoading?(s(),a("div",ot,[(s(),a(f,null,k(3,p=>e(S,{key:p})),64))])):(s(),a("div",nt,[t.newPosts.length?(s(),u(F,{key:0,posts:t.newPosts,onClick:t.applyNewPosts},null,8,["posts","onClick"])):C("",!0),t.posts.length?(s(),a("div",st,[(s(!0),a(f,null,k(t.posts,p=>(s(),u(w,{key:p.id,postData:p},null,8,["postData"]))),128))])):(s(),a("div",it,[e(v,{text:t.$t("empty_state.empty")},null,8,["text"])])),t.state.isLoadingContent?(s(),a("div",at,[e(m),n[0]||(n[0]=b("div",{class:"flex justify-center my-4"},[b("div",{class:"colibri-primary-animation"})],-1))])):C("",!0)]))]),_:1})]),sidebar:l(()=>[e(U),e(x)]),_:1}),(s(),u(N,{to:"body"},[e($)]))],64)}const At=q(et,[["render",lt]]);export{At as default};
