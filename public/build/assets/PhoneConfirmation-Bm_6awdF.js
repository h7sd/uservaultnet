import{_ as T,d as k,c,j as o,a as m,r as a,J as P,w as f,e as h,F as y,g as _,h as C,l as p,H as v,o as s}from"./global.properties-ieI6Xwik.js";import{a as I,f as $,d as w}from"./application-DnsIlr-S.js";import{C as B}from"./CodeInput-BcShOIqQ.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./inbox.store-DKf8FrGP.js";import"./index-CaocF3Et.js";const E=k({setup:function(){var e=null;const i=w(),r=v(),l=_({code:""}),t=_({timeExpired:!1,expireSeconds:0,isLoading:!0,isSubmitting:!1,newPhone:"",formErrors:{code:[]}}),d=function(){e&&clearInterval(e),e=setInterval(()=>{t.expireSeconds<1?(t.timeExpired=!0,clearInterval(e)):t.expireSeconds-=1},1e3)};return C(async()=>{await p().userSettings().getFrom("phone/check").then(n=>{t.expireSeconds=n.data.data.time_left,t.newPhone=n.data.data.phone,t.isLoading=!1,d()}).catch(n=>{n.response&&r.push({name:"settings_phone"})})}),{state:t,formData:l,resendCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await p().userSettings().sendTo("phone/update/resend").then(n=>{toastSuccess(__t("toast.confirmation_code_resent")),t.timeExpired=!1,t.expireSeconds=n.data.data.time_left,d()}).catch(n=>{n.response&&toastError(n.response.data.message)}),t.isSubmitting=!1)},confirmCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await p().userSettings().with(l).sendTo("phone/update/confirm").then(n=>{toastSuccess(__t("toast.phone_updated")),i.setProperty("phone",n.data.data.phone),r.push({name:"settings_phone"})}).catch(n=>{n.response&&(toastError(n.response.data.message),t.isSubmitting=!1)}))}}},components:{PrimaryPillButton:$,CodeInput:B,PageTitle:I}}),L={class:"mb-8"},x={key:0,class:"block"},D={class:"mb-8"},H=["innerHTML"],M={class:"mb-6"},V=["innerHTML"],A=["innerHTML"],F={class:"block"},z={key:1,class:"block"},N={class:"flex-center h-96"};function j(e,i,r,l,t,d){const n=a("PageTitle"),g=a("CodeInput"),u=a("PrimaryPillButton"),b=a("PrimarySpinAnimation");return s(),c(y,null,[o("div",L,[m(n,{hasBack:!0,titleText:e.$t("settings.phone_confirmation")},null,8,["titleText"])]),e.state.isLoading?(s(),c("div",z,[o("div",N,[m(b)])])):(s(),c("div",x,[o("div",D,[o("h6",{class:"text-par-s text-lab-sc",innerHTML:e.$t("settings.forms.phone_confirmation.page_desc",{new_phone:e.state.newPhone})},null,8,H)]),o("div",M,[m(g,{modelValue:e.formData.code,"onUpdate:modelValue":i[0]||(i[0]=S=>e.formData.code=S),labelText:e.$t("settings.forms.phone_confirmation.confirmation_code")},P({_:2},[e.state.timeExpired?{name:"feedbackInfo",fn:f(()=>[o("span",{innerHTML:e.$t("settings.forms.phone_confirmation.confirmation_code_expired")},null,8,V)]),key:"0"}:{name:"feedbackInfo",fn:f(()=>[o("span",{innerHTML:e.$t("settings.forms.phone_confirmation.confirmation_code_helper",{time:e.$filters.formatTime(e.state.expireSeconds)})},null,8,A)]),key:"1"}]),1032,["modelValue","labelText"])]),o("div",F,[e.state.timeExpired?(s(),h(u,{key:0,loading:e.state.isSubmitting,onClick:e.resendCode,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.resend_code")},null,8,["loading","onClick","buttonText"])):(s(),h(u,{key:1,loading:e.state.isSubmitting,onClick:e.confirmCode,isDisabled:e.formData.code.length<6,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.forms.phone_confirmation.confirm_phone")},null,8,["loading","onClick","isDisabled","buttonText"]))])]))],64)}const O=T(E,[["render",j]]);export{O as default};
