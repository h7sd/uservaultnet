const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojisPicker-BXzUvyYH.js","assets/application-DEz9sPnz.js","assets/global.properties-DKM1fd6s.js","assets/editor-CpZ7vO5P.js","assets/media-D4ZD3EDk.js","assets/vendor-20TtR0Rd.js","assets/inbox.store-CHx7CB4w.js","assets/index-ciglwFMH.js","assets/ui-Bp8YvxdW.js","assets/VideoDurationTime-DjdOjCKw.js"])))=>i.map(i=>d[i]);
import{s as M,d as C,w as V,P as j,g as F,x as z,y as A}from"./application-DEz9sPnz.js";import{_ as h,a as P,b as U}from"./global.properties-DKM1fd6s.js";import{c as m,d,s as e,t as c,k,e as a,i as l,x as H,p as E,v as D,r as S,j as O,y,b as I,z as N,K as R,B as x,l as $,q as L}from"./vendor-20TtR0Rd.js";import{u as q}from"./index-ciglwFMH.js";import K from"./AvatarExtraSmall-CDoWzwp5.js";import"./inbox.store-CHx7CB4w.js";import"./ui-Bp8YvxdW.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";const G={},J={class:"block px-4 py-4"},Q={class:"text-lab-pr2 text-par-n mb-1 font-medium"},W={class:"text-lab-sc text-par-s"};function X(t,o){return d(),m("div",J,[e("h5",Q,c(t.$t("story.story_privacy_alert.title")),1),e("p",W,c(t.$t("story.story_privacy_alert.desc",{app_name:t.$embedder("config.app.name")})),1)])}const Y=h(G,[["render",X]]),Z=k({setup:function(){const t=M(),o=C();return{userData:S(o.userData),closeEditor:()=>{t.closeEditor()}}},components:{AvatarExtraSmall:K}}),tt={class:"flex px-4 py-3 items-center shrink-0"},et={class:"shrink-0"},ot={class:"flex-1 ml-1"},st={class:"text-par-n font-medium text-lab-pr2 truncate"},rt={class:"shrink-0"};function nt(t,o,s,i,u,v){const n=a("AvatarExtraSmall"),f=a("VerificationBadge");return d(),m("div",tt,[e("div",et,[l(n,{avatarSrc:t.userData.avatar_url},null,8,["avatarSrc"])]),e("div",ot,[e("h4",st,[H(c(t.userData.name)+" ",1),t.userData.verification.status?(d(),E(f,{key:0,size:"xs"})):D("",!0)])]),e("div",rt,[e("button",{onClick:o[0]||(o[0]=(..._)=>t.closeEditor&&t.closeEditor(..._)),class:"text-par-s text-brand-900 cursor-pointer"},c(t.$t("labels.close")),1)])])}const it=h(Z,[["render",nt]]),at=k({emits:["upload"],setup:function(t,o){const s=I({isDragging:!1});return{state:s,handleFileDrop:i=>{s.isDragging=!1;const u=i.dataTransfer.files;u.length&&o.emit("upload",u[0])}}}}),dt={class:"text-center mt-auto"},lt={class:"flex justify-center group-hover:-translate-y-2 smoothing"},ct=["src"],pt={class:"text-par-n text-lab-pr2"},ut={class:"text-center text-par-s text-lab-sc mt-auto mb-3"};function mt(t,o,s,i,u,v){return d(),m("div",{onDrop:o[0]||(o[0]=y((...n)=>t.handleFileDrop&&t.handleFileDrop(...n),["prevent"])),onDragenter:o[1]||(o[1]=y(n=>t.state.isDragging=!0,["prevent"])),onDragover:o[2]||(o[2]=y(n=>t.state.isDragging=!0,["prevent"])),onDragleave:o[3]||(o[3]=y(n=>t.state.isDragging=!1,["prevent"])),onDragend:o[4]||(o[4]=y(n=>t.state.isDragging=!1,["prevent"])),class:"shadow-xs popup-background-tr rounded-md p-2 h-full group"},[e("div",{class:O([[t.state.isDragging?"border-brand-900":"border-edge-pr hover:border-brand-900"],"flex flex-col justify-center cursor-pointer border border-dashed h-full rounded-md smoothing"])},[e("div",dt,[e("div",lt,[e("img",{class:"size-24",src:t.$asset("assets/icons/upload.png"),alt:"Image"},null,8,ct)]),e("h5",pt,c(t.$t("story.story_drop_zone.title")),1)]),e("p",ut,c(t.$t("story.story_drop_zone.desc")),1)],2)],32)}const ft=h(at,[["render",mt]]),_t=k({setup:function(){const t=M(),o=S(null),s=S(null),i=I({isEmojisPickerOpen:!1,isSubmitting:!1,isUploading:!1}),{autoResize:u,insertSymbolAtCaret:v,matchMention:n,completeText:f}=q(),_=S(t.storyData),g=async r=>{try{i.isUploading=!0,await t.uploadMedia(r),i.isUploading=!1}catch(b){i.isUploading=!1,toastError(b.message)}};return{state:i,storyMedia:$(()=>t.storyMedia),isVideo:$(()=>t.storyMedia.type==="video"),uploadProgress:$(()=>t.uploadProgress),isFormValid:$(()=>t.isFormValid),storyData:_,stroyMediaFileInput:o,storyTextInputField:s,insertStoryEmoji:r=>{_.value.content=v(s.value,r),s.value.focus()},submitForm:async()=>{try{i.isSubmitting=!0,await t.publishStory(),i.isSubmitting=!1,toastSuccess(__t("toast.story.story_published")),t.resetEditor(),t.closeEditor()}catch(r){i.isSubmitting=!1,toastError(r.message)}},deleteStoryMedia:async()=>{try{await t.deleteMedia()}catch(r){toastError(r.message)}},selectStoryMedia:()=>{o.value.click()},handleMediaUpload:g,handleMediaSelect:async r=>{g(r.target.files[0])},textInputHandler:()=>{u(s.value);const r=n(s.value);r&&U.emit("editor:mention-input",r.username)},selectMention:r=>{let b=n(s.value);b&&(_.value.content=f(s.value,{completable:`@${r}`,start:b.start,end:b.end}),s.value.focus())}}},components:{PrimaryTextButton:F,PrimaryIconButton:j,EmojisPicker:x(()=>P(()=>import("./EmojisPicker-BXzUvyYH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),StoryPrivacyInfo:Y,StoryEditorHeader:it,StoryDropper:ft,VideoDurationTime:x(()=>P(()=>import("./VideoDurationTime-DjdOjCKw.js"),__vite__mapDeps([9,2,3,4,5]))),MentionsPicker:V}}),bt={class:"w-sided-content"},yt={class:"flex items-stretch overflow-hidden popup-background-tr border border-bord-pr rounded-sm"},vt={class:"min-w-content w-content h-[762px] border-r border-r-bord-pr overflow-hidden relative"},ht={class:"p-2 h-full bg-fill-fv"},gt={key:0,class:"bg-black h-full rounded-md overflow-hidden"},$t={class:"h-full flex items-center relative"},St=["src"],kt={class:"absolute top-4 left-4 size-8 bg-white rounded-full leading-none"},Dt={key:0,class:"absolute bottom-4 right-4"},Et={key:1,class:"shadow-xs popup-background-tr rounded-md p-2 h-full"},Pt={class:"flex flex-col justify-center h-full border border-dashed border-edge-pr rounded-md smoothing"},xt={class:"flex justify-center bounce-up"},Mt=["src"],It={class:"text-par-n text-brand-900 text-center"},wt={class:"flex-1 h-[762px]"},Bt={class:"flex flex-col h-full"},Tt={class:"border-b border-b-bord-pr"},Ct={class:"flex-1"},Vt={class:"border-b border-b-bord-pr"},jt={class:"block"},Ft=["placeholder"],zt={class:"flex items-center px-4 py-2"},At={class:"shrink-0"},Ut={class:"text-lab-sc text-cap-l"},Ht={class:"shrink-0 ml-auto"},Ot={class:"relative"},Nt=["disabled"],Rt={key:0,class:"block absolute top-6 right-0 w-80 z-50"},Lt={class:"border-t border-t-bord-pr flex justify-center py-4"},qt={class:"hidden"};function Kt(t,o,s,i,u,v){const n=a("PrimaryIconButton"),f=a("VideoDurationTime"),_=a("StoryDropper"),g=a("StoryEditorHeader"),r=a("SvgIcon"),b=a("EmojisPicker"),w=a("MentionsPicker"),B=a("StoryPrivacyInfo"),T=a("PrimaryTextButton");return d(),m("div",bt,[e("form",{onSubmit:o[5]||(o[5]=y((...p)=>t.submitForm&&t.submitForm(...p),["prevent"]))},[e("div",yt,[e("div",vt,[e("div",ht,[t.storyMedia?(d(),m("div",gt,[e("div",$t,[e("img",{class:"w-full object-cover",src:t.storyMedia.source_url,alt:"Image"},null,8,St),e("div",kt,[l(n,{onClick:t.deleteStoryMedia,iconName:"x"},null,8,["onClick"])]),t.isVideo?(d(),m("div",Dt,[l(f,{videoDuration:t.storyMedia.duration},null,8,["videoDuration"])])):D("",!0)])])):t.state.isUploading?(d(),m("div",Et,[e("div",Pt,[e("div",xt,[e("img",{class:"size-24",src:t.$asset("assets/icons/upload.png"),alt:"Image"},null,8,Mt)]),e("h5",It,c(t.$t("labels.uploading"))+" "+c(t.uploadProgress)+"% ",1)])])):(d(),E(_,{key:2,onClick:t.selectStoryMedia,onUpload:t.handleMediaUpload},null,8,["onClick","onUpload"]))])]),e("div",wt,[e("div",Bt,[e("div",Tt,[l(g)]),e("div",Ct,[e("div",Vt,[e("div",jt,[N(e("textarea",{onInput:o[0]||(o[0]=(...p)=>t.textInputHandler&&t.textInputHandler(...p)),"onUpdate:modelValue":o[1]||(o[1]=p=>t.storyData.content=p),ref:"storyTextInputField",class:"resize-none bg-transparent block min-h-40 w-full max-h-60 overflow-y-auto outline-hidden px-4 py-4 placeholder:font-light placeholder:text-par-s text-lab-pr text-par-s placeholder:text-lab-sc",placeholder:t.$t("story.editor.add_caption")},null,40,Ft),[[R,t.storyData.content]])]),e("div",zt,[e("div",At,[e("span",Ut,c(t.storyData.content.length)+"/"+c(1200),1)]),e("div",Ht,[e("div",Ot,[e("button",{onClick:o[2]||(o[2]=y(p=>t.state.isEmojisPickerOpen=!0,["stop"])),type:"button",disabled:t.state.isSubmitting,class:"outline-hidden size-icon-small text-lab-sc hover:text-brand-900 disabled:opacity-80 disabled:cursor-wait"},[l(r,{type:"line",name:"face-smile"})],8,Nt),t.state.isEmojisPickerOpen?(d(),m("div",Rt,[l(b,{onPick:t.insertStoryEmoji,onClose:o[3]||(o[3]=p=>t.state.isEmojisPickerOpen=!1)},null,8,["onPick"])])):D("",!0)])])]),l(w,{onSelect:t.selectMention,classes:"w-full border-t border-bord-pr"},null,8,["onSelect"])]),l(B)]),e("div",Lt,[l(T,{disabled:!t.isFormValid,loading:t.state.isSubmitting,buttonText:t.$t("story.editor.publish_story"),type:"submit"},null,8,["disabled","loading","buttonText"])])])])]),e("div",qt,[e("input",{onChange:o[4]||(o[4]=(...p)=>t.handleMediaSelect&&t.handleMediaSelect(...p)),capture:"environment",type:"file",accept:"image/*, video/*",ref:"stroyMediaFileInput"},null,544)])],32)])}const Gt=h(_t,[["render",Kt]]),Jt=k({components:{StoriesEditor:Gt,ColibriPlusAttribution:A,Backdrop:z}}),Qt={class:"ml-navbar py-top-offset"};function Wt(t,o,s,i,u,v){const n=a("StoriesEditor"),f=a("Backdrop");return d(),E(f,null,{default:L(()=>[e("div",Qt,[l(n)])]),_:1})}const ie=h(Jt,[["render",Wt]]);export{ie as default};
