import{_ as T,d as k,c as d,j as n,a as c,r as o,J as y,w as p,e as _,F as C,g,h as P,l as u,H as v,o as a}from"./global.properties-ieI6Xwik.js";import{a as E,f as I,d as $}from"./application-DnsIlr-S.js";import{C as w}from"./CodeInput-BcShOIqQ.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./inbox.store-DKf8FrGP.js";import"./index-CaocF3Et.js";const B=k({setup:function(){var e=null;const s=$(),r=v(),l=g({code:""}),t=g({timeExpired:!1,expireSeconds:0,isLoading:!0,isSubmitting:!1,newEmail:"",formErrors:{code:[]}}),m=function(){e&&clearInterval(e),e=setInterval(()=>{t.expireSeconds<1?(t.timeExpired=!0,clearInterval(e)):t.expireSeconds-=1},1e3)};return P(async()=>{await u().userSettings().getFrom("email/check").then(i=>{t.expireSeconds=i.data.data.time_left,t.newEmail=i.data.data.email,t.isLoading=!1,m()}).catch(i=>{i.response&&r.push({name:"settings_email"})})}),{state:t,formData:l,resendCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await u().userSettings().sendTo("email/update/resend").then(i=>{toastSuccess(__t("toast.confirmation_code_resent")),t.timeExpired=!1,t.expireSeconds=i.data.data.time_left,m()}).catch(i=>{i.response&&toastError(i.response.data.message)}),t.isSubmitting=!1)},confirmCode:async()=>{t.isSubmitting===!1&&(t.isSubmitting=!0,await u().userSettings().with(l).sendTo("email/update/confirm").then(i=>{toastSuccess(__t("toast.email_updated")),s.setProperty("email",i.data.data.email),r.push({name:"settings_email"})}).catch(i=>{i.response&&(toastError(i.response.data.message),t.isSubmitting=!1)}))}}},components:{PrimaryPillButton:I,CodeInput:w,PageTitle:E}}),L={class:"mb-8"},x={key:0,class:"block"},D={class:"mb-8"},H=["innerHTML"],M={class:"mb-6"},V=["innerHTML"],A=["innerHTML"],F={class:"block"},z={key:1,class:"block"},N={class:"flex-center h-96"};function j(e,s,r,l,t,m){const i=o("PageTitle"),b=o("CodeInput"),f=o("PrimaryPillButton"),h=o("PrimarySpinAnimation");return a(),d(C,null,[n("div",L,[c(i,{hasBack:!0,titleText:e.$t("settings.email_confirmation")},null,8,["titleText"])]),e.state.isLoading?(a(),d("div",z,[n("div",N,[c(h)])])):(a(),d("div",x,[n("div",D,[n("h6",{class:"text-par-s text-lab-sc",innerHTML:e.$t("settings.forms.email_confirmation.page_desc",{new_email:e.state.newEmail})},null,8,H)]),n("div",M,[c(b,{modelValue:e.formData.code,"onUpdate:modelValue":s[0]||(s[0]=S=>e.formData.code=S),labelText:e.$t("settings.forms.email_confirmation.confirmation_code")},y({_:2},[e.state.timeExpired?{name:"feedbackInfo",fn:p(()=>[n("span",{innerHTML:e.$t("settings.forms.email_confirmation.confirmation_code_expired")},null,8,V)]),key:"0"}:{name:"feedbackInfo",fn:p(()=>[n("span",{innerHTML:e.$t("settings.forms.email_confirmation.confirmation_code_helper",{time:e.$filters.formatTime(e.state.expireSeconds)})},null,8,A)]),key:"1"}]),1032,["modelValue","labelText"])]),n("div",F,[e.state.timeExpired?(a(),_(f,{key:0,loading:e.state.isSubmitting,onClick:e.resendCode,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.resend_code")},null,8,["loading","onClick","buttonText"])):(a(),_(f,{key:1,loading:e.state.isSubmitting,onClick:e.confirmCode,isDisabled:e.formData.code.length<6,buttonType:"button",buttonSize:"lm",buttonText:e.$t("settings.forms.email_confirmation.confirm_email")},null,8,["loading","onClick","isDisabled","buttonText"]))])]))],64)}const O=T(B,[["render",j]]);export{O as default};
