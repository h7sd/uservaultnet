import{k as v,e as r,c as l,d as n,s as i,i as h,z as x,E as L,r as C,M as I,o as V,w as W,Z as R,p as f,t as b,l as w,v as S,j as X,H as U,b as P,F as M,f as z,P as Y,A as ee,x as O,y as te,q as D,h as E,_ as oe,D as ne,G as A,R as F}from"./vendor-20TtR0Rd.js";import{r as se}from"./swiper-element-bundle-DBu82uhE.js";import{P as H,D as ae,b as re,A as G,t as Q}from"./application-DEz9sPnz.js";import{_,b as m,c as ie}from"./global.properties-DKM1fd6s.js";import le from"./PrimarySpinAnimation-IEiJk6Yn.js";import{M as Z}from"./MarginalTextButton-ByvfW649.js";import{S as de}from"./ShareContent-Dh5TgM4L.js";import"./inbox.store-CHx7CB4w.js";import"./index-ciglwFMH.js";import"./ui-Bp8YvxdW.js";import"./editor-CpZ7vO5P.js";import"./media-D4ZD3EDk.js";import"./SpinnerIcon-BFpWBik4.js";const ce=v({props:{lqipBase64:{type:String,required:!0}},components:{PrimarySpinAnimation:le}}),ue={class:"size-full relative"},pe=["src"],me={class:"shadow-xs absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 size-9 bg-white/50 backdrop-blur-2xl rounded-full inline-flex-center justify-center z-10"};function ye(e,o,s,t,d,c){const a=r("PrimarySpinAnimation");return n(),l("div",ue,[i("img",{class:"size-full object-cover",src:e.lqipBase64,alt:"Base64 LQIP"},null,8,pe),i("div",me,[h(a)])])}const J=_(ce,[["render",ye]]),fe=v({props:{frameData:{type:Object,required:!0}},setup:function(e){const o=C(null),s=C(!0),t=C(e.frameData),d=I("playerState");V(()=>{localStorage.getItem("stories_videos_muted")?o.value.muted=!0:o.value.muted=!1,W(()=>d.isPaused,()=>{u()}),m.on("story:unmute",a),m.on("story:mute",c)}),R(()=>{m.off("story:unmute",a),m.off("story:mute",c)});const c=()=>{o.value.muted=!0},a=()=>{o.value.muted=!1},u=()=>{d.isPaused?o.value.pause():o.value.play()};return{isLoading:s,frameData:t,storyVideo:o,onLoaded:()=>{o.value.play(),s.value=!1,m.emit("story:play")}}},components:{StoryMediaLoader:J}}),he={class:"h-full w-full overflow-hidden"},_e=["src"];function Se(e,o,s,t,d,c){const a=r("StoryMediaLoader");return n(),l("div",he,[x(h(a,{lqipBase64:e.frameData.media.lqip_base64},null,8,["lqipBase64"]),[[L,e.isLoading]]),x(i("video",{ref:"storyVideo",onLoadeddata:o[0]||(o[0]=(...u)=>e.onLoaded&&e.onLoaded(...u)),class:"w-full h-full object-cover"},[i("source",{src:e.frameData.media.source_url,type:"video/mp4"},null,8,_e)],544),[[L,!e.isLoading]])])}const ve=_(fe,[["render",Se]]),$e=v({props:{frameData:{type:Object,required:!0}},setup:function(e,o){const s=C(!0);return{isLoading:s,onLoaded:()=>{s.value=!1,m.emit("story:play")}}},components:{StoryMediaLoader:J}}),we={class:"h-full w-full overflow-hidden"},ge=["src"];function be(e,o,s,t,d,c){const a=r("StoryMediaLoader");return n(),l("div",we,[x(h(a,{lqipBase64:e.frameData.media.lqip_base64},null,8,["lqipBase64"]),[[L,e.isLoading]]),x(i("img",{class:"w-full",src:e.frameData.media.source_url,onLoad:o[0]||(o[0]=(...u)=>e.onLoaded&&e.onLoaded(...u)),alt:"Image"},null,40,ge),[[L,!e.isLoading]])])}const ke=_($e,[["render",be]]),Ce=v({setup:function(){return{shareStory:()=>{m.emit("story:share")}}},components:{PrimaryIconButton:H}});function Me(e,o,s,t,d,c){const a=r("PrimaryIconButton");return n(),f(a,{onClick:e.shareStory,iconName:"share-06",iconType:"line",hoverText:"hover:text-white hover:opacity-100",buttonColor:"text-white opacity-70"},null,8,["onClick"])}const K=_(Ce,[["render",Me]]),De=v({setup:function(){const e=I("playerState");return{playerState:e,showViews:()=>{m.emit("story:show-views")},storyViewsCount:w(()=>e.frameData.views_count),storyViews:w(()=>e.frameData.relations.views),hasViews:w(()=>e.frameData.views_count.raw>0)}},components:{StoryShareButton:K,PrimaryIconButton:H}}),Ie={class:"flex items- gap-4 px-3 pr-4 leading-none"},Ve={class:"inline-flex items-center flex-1 gap-1 opacity-70 hover:opacity-100"},Be={class:"text-par-s text-white/90"},xe={class:"shrink-0"};function Pe(e,o,s,t,d,c){const a=r("PrimaryIconButton"),u=r("StoryShareButton");return n(),l("div",Ie,[i("div",Ve,[h(a,{onClick:e.showViews,iconName:"eye",buttonColor:"text-white",hoverText:"hover:text-white"},null,8,["onClick"]),i("span",Be,b(e.$t("story.views_number",{n:e.storyViewsCount.formatted},e.storyViewsCount.raw)),1)]),i("div",xe,[h(u)])])}const Te=_(De,[["render",Pe]]),Le=v({setup:function(){const e=I("playerState");return{hasContent:w(()=>e.frameData.content.length),storyContent:w(()=>e.frameData.content),showContent:()=>{m.emit("story:show-content")}}}});function ze(e,o,s,t,d,c){return e.hasContent?(n(),l("div",{key:0,class:"text-par-s text-white px-3 cursor-pointer mb-2",onClick:o[0]||(o[0]=(...a)=>e.showContent&&e.showContent(...a))},b(e.storyContent.substr(0,90))+"... ",1)):S("",!0)}const Oe=_(Le,[["render",ze]]),Ae=v({setup:function(){const e=I("playerState"),o=U(),s=P({sendingMessage:!1});return{playerState:e,state:s,replyToStory:async()=>{if(s.sendingMessage)return!1;s.sendingMessage=!0,await ie().messenger().with({user_id:e.storyAuthor.id}).sendTo("chats/create").then(t=>{let d=t.data.data;o.push({name:"messenger_chat",params:{chat_id:d.chat_id}})}).catch(t=>{t.response&&alert(t.response.data.message)})}}},components:{StoryShareButton:K}}),He={class:"flex items-center gap-2 px-3"},qe={class:"text-cap-l text-white leading-none block truncate"},Ne={class:"shrink-0"};function je(e,o,s,t,d,c){const a=r("StoryShareButton");return n(),l("div",He,[i("div",{onClick:o[0]||(o[0]=(...u)=>e.replyToStory&&e.replyToStory(...u)),class:X(["smoothing border border-white px-4 h-8 flex items-center overflow-hidden rounded-full flex-1",[e.state.sendingMessage?"opacity-40 cursor-not-allowed":"opacity-70 cursor-pointer hover:opacity-100"]])},[i("span",qe,b(e.state.sendingMessage?e.$t("story.reply_story_author_sending"):e.$t("story.reply_story_author",{name:e.playerState.storyAuthor.name})),1)],2),i("div",Ne,[h(a)])])}const Fe=_(Ae,[["render",je]]),Re=v({props:{storyData:{type:Object,required:!0}}}),Ue={class:"flex gap-1 mb-3 overflow-hidden"},Ee={key:0,class:"h-full bg-white w-full"},Ge={key:2,class:"h-full bg-white w-0"};function Qe(e,o,s,t,d,c){return n(),l("div",Ue,[(n(!0),l(M,null,z(e.storyData.relations.frames,(a,u)=>(n(),l("div",{class:"h-0.5 bg-white/60 flex-1 min-w-1",key:u},[a.playable.played?(n(),l("div",Ee)):a.playable.playing?(n(),l("div",{key:1,class:"h-full bg-white",style:Y({width:`${a.playable.progress}%`})},null,4)):(n(),l("div",Ge))]))),128))])}const Ze=_(Re,[["render",Qe]]),Je=v({emits:["play","pause"],setup:function(e,o){const s=P({isMenuOpen:!1,isMuted:!1}),t=I("playerState");V(()=>{localStorage.getItem("stories_videos_muted")&&(s.isMuted=!0)});const d=()=>{o.emit("play")},c=()=>{o.emit("pause")};return{state:s,playerState:t,storyAuthor:w(()=>t.storyAuthor),isVideo:w(()=>t.frameData.type=="video"),play:d,pause:c,toggleVideosVolume:()=>{localStorage.getItem("stories_videos_muted")?(localStorage.removeItem("stories_videos_muted"),s.isMuted=!1,m.emit("story:unmute")):(localStorage.setItem("stories_videos_muted",1),s.isMuted=!0,m.emit("story:mute"))},deleteStory:()=>{m.emit("story:delete",t.frameData.id)},showViews:()=>{m.emit("story:show-views")},toggleMenu:()=>{s.isMenuOpen=!s.isMenuOpen,c()},canReport:w(()=>t.permissions.can_report),canHide:w(()=>t.permissions.can_hide),canDelete:w(()=>t.permissions.can_delete),canSeeViews:w(()=>t.isOwner)}},components:{PrimaryIconButton:H,AvatarSmall:G,DropdownMenu:re,DropdownMenuItem:ae}}),Ke={class:"flex justify-between items-center"},We={class:"flex gap-2 items-center overflow-hidden"},Xe={class:"shrink-0"},Ye={class:"flex-1 overflow-hidden leading-none truncate"},et={class:"text-par-n font-medium text-white mb-0.5"},tt={class:"text-cap-l text-white ml-1 opacity-80"},ot={class:"ml-4 inline-flex gap-1 items-center"},nt={class:"relative"},st={key:0,class:"absolute top-full right-0 z-50 leading-none"};function at(e,o,s,t,d,c){const a=r("AvatarSmall"),u=r("VerificationBadge"),p=r("PrimaryIconButton"),y=r("DropdownMenuItem"),g=r("DropdownMenu"),$=ee("outside-click");return n(),l("div",Ke,[i("div",We,[i("div",Xe,[h(a,{avatarSrc:e.storyAuthor.avatar_url},null,8,["avatarSrc"])]),i("div",Ye,[i("span",et,[O(b(e.storyAuthor.name)+" ",1),e.storyAuthor.verified?(n(),f(u,{key:0,size:"xs"})):S("",!0)]),i("span",tt,b(e.playerState.frameData.date.time_ago??""),1)])]),i("div",ot,[e.playerState.isPaused?(n(),f(p,{key:0,onClick:e.play,iconName:"play",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])):(n(),f(p,{key:1,onClick:e.pause,iconName:"pause",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])),e.isVideo?(n(),l(M,{key:2},[e.state.isMuted?(n(),f(p,{key:0,onClick:e.toggleVideosVolume,iconName:"volume-x",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"])):(n(),f(p,{key:1,onClick:e.toggleVideosVolume,iconName:"volume-max",iconSize:"5",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"]))],64)):S("",!0),i("div",nt,[h(p,{onClick:te(e.toggleMenu,["stop"]),iconName:"dots-horizontal",buttonColor:"text-gray-300",hoverText:"text-white",hoverBg:"hover:bg-white/20"},null,8,["onClick"]),e.state.isMenuOpen?(n(),l("div",st,[x((n(),f(g,{onClick:e.toggleMenu},{default:D(()=>[e.canDelete?(n(),f(y,{key:0,onClick:e.deleteStory,itemColor:"text-red-900",iconName:"trash-04",textLabel:e.$t("dd.story.delete_story")},null,8,["onClick","textLabel"])):S("",!0),e.canSeeViews?(n(),f(y,{key:1,onClick:e.showViews,iconName:"eye",textLabel:e.$t("dd.story.show_views")},null,8,["onClick","textLabel"])):S("",!0),e.canHide?(n(),f(y,{key:2,onClick:e.$comingSoon,iconName:"eye-off",textLabel:e.$t("dd.story.hide_stories",{name:e.storyAuthor.name})},null,8,["onClick","textLabel"])):S("",!0),e.canReport?(n(),f(y,{key:3,onClick:e.$comingSoon,itemColor:"text-red-900",iconName:"annotation-alert",textLabel:e.$t("dd.story.report_story")},null,8,["onClick","textLabel"])):S("",!0)]),_:1},8,["onClick"])),[[$,e.toggleMenu]])])):S("",!0)])])])}const rt=_(Je,[["render",at]]),it={},lt={class:"absolute inset-0 z-20 bg-black/60 backdrop-blur-xs"};function dt(e,o){const s=r("PrimaryTransition");return n(),l("div",lt,[h(s,null,{default:D(()=>[E(e.$slots,"default")]),_:3})])}const q=_(it,[["render",dt]]),ct=v({setup:function(){const e=C(!1);return V(()=>{setTimeout(()=>{e.value=!0},200)}),oe(()=>{e.value=!1}),{renderContent:e}}}),ut={class:"size-full p-4 flex items-end origin-bottom"},pt={class:"rounded-md w-full popup-background-pr"};function mt(e,o,s,t,d,c){return n(),l("div",ut,[i("div",pt,[e.renderContent?E(e.$slots,"default",{key:0}):S("",!0)])])}const N=_(ct,[["render",mt]]),yt=v({props:{title:{type:String,required:!0},buttonText:{type:String,required:!0}},emits:["cancel"],components:{MarginalTextButton:Z}}),ft={class:"flex justify-between border-b border-fill-sc px-4 py-3"},ht={class:"text-par-s font-medium text-lab-pr truncate"};function _t(e,o,s,t,d,c){const a=r("MarginalTextButton");return n(),l("div",ft,[i("span",ht,b(e.title),1),h(a,{buttonText:e.buttonText,onClick:o[0]||(o[0]=u=>e.$emit("cancel"))},null,8,["buttonText"])])}const j=_(yt,[["render",_t]]),St=v({props:{viewItem:{type:Object,required:!0}},components:{AvatarSmall:G}}),vt={class:"px-3 py-2 border-b border-fill-sc"},$t={class:"flex items-center"},wt={class:"shrink-0"},gt={class:"text-lab-pr ml-2 font-medium text-par-n"},bt={class:"text-lab-sc text-par-n ml-auto"};function kt(e,o,s,t,d,c){const a=r("AvatarSmall"),u=r("VerificationBadge");return n(),l("div",vt,[i("div",$t,[i("div",wt,[h(a,{avatarSrc:e.viewItem.relations.user.avatar_url},null,8,["avatarSrc"])]),i("span",gt,[O(b(e.viewItem.relations.user.name)+" ",1),e.viewItem.relations.user.verified?(n(),f(u,{key:0,size:"xs"})):S("",!0)]),i("span",bt,b(e.viewItem.date.time_ago),1)])])}const Ct=_(St,[["render",kt]]),Mt={},Dt={class:"px-4 py-2 border-b border-fill-sc last:border-none"};function It(e,o){return n(),l("div",Dt,o[0]||(o[0]=[ne('<div class="flex items-center"><div class="shrink-0"><span class="skeleton-circle size-8"></span></div><span class="skeleton h-3 w-20 ml-2"></span><span class="skeleton h-3 w-6 ml-auto"></span></div>',1)]))}const Vt=_(Mt,[["render",It]]),Bt=v({emits:["hide"],setup:function(){const e=Q(),o=I("playerState"),s=P({isLoading:!0}),t=C([]);return V(async()=>{t.value=await e.fetchAndReturnStoryViews(o.frameData.id),s.isLoading=!1}),{state:s,views:t}},components:{ModalBackdrop:q,ModalContent:N,ModalHeader:j,ViewItemSkeleton:Vt,ViewItem:Ct}}),xt={key:0,class:"block"},Pt={key:1,class:"block max-h-80 overflow-y-auto"},Tt={key:1,class:"py-16"},Lt={class:"text-lab-pr2 text-par-s text-center"};function zt(e,o,s,t,d,c){const a=r("ModalHeader"),u=r("ViewItemSkeleton"),p=r("ViewItem"),y=r("ModalContent"),g=r("ModalBackdrop");return n(),f(g,null,{default:D(()=>[h(y,null,{default:D(()=>[h(a,{title:e.$t("story.who_watched_story"),buttonText:e.$t("labels.close"),onCancel:o[0]||(o[0]=$=>e.$emit("hide"))},null,8,["title","buttonText"]),e.state.isLoading?(n(),l("div",xt,[(n(),l(M,null,z(5,$=>h(u,{key:$})),64))])):(n(),l("div",Pt,[e.views.length?(n(!0),l(M,{key:0},z(e.views,$=>(n(),f(p,{viewItem:$,key:$.id},null,8,["viewItem"]))),128)):(n(),l("div",Tt,[i("p",Lt,b(e.$t("story.no_view_yet")),1)]))]))]),_:1})]),_:1})}const Ot=_(Bt,[["render",zt]]),At=v({props:{storyItem:{type:Object,default:{}}},emits:["cancel"],setup:function(){return{mediaOptions:embedder("sharing.stories"),storyUrl:I("storyUrl")}},components:{ModalHeader:j,MarginalTextButton:Z,ModalBackdrop:q,ModalContent:N,ShareContent:de}}),Ht={class:"block"};function qt(e,o,s,t,d,c){const a=r("ModalHeader"),u=r("ShareContent"),p=r("ModalContent"),y=r("ModalBackdrop");return n(),f(y,null,{default:D(()=>[h(p,null,{default:D(()=>[i("div",Ht,[h(a,{onCancel:o[0]||(o[0]=g=>e.$emit("cancel")),title:e.$t("story.share_story"),buttonText:e.$t("labels.cancel")},null,8,["title","buttonText"]),h(u,{mediaOptions:e.mediaOptions,link:e.storyUrl},null,8,["mediaOptions","link"])])]),_:1})]),_:1})}const Nt=_(At,[["render",qt]]),jt=v({emits:["hide"],setup:function(){const e=I("playerState");return{storyContent:w(()=>e.frameData.content)}},components:{ModalBackdrop:q,ModalContent:N,ModalHeader:j}}),Ft={class:"p-3 max-h-80 overflow-y-auto pb-4"},Rt=["innerHTML"];function Ut(e,o,s,t,d,c){const a=r("ModalHeader"),u=r("ModalContent"),p=r("ModalBackdrop");return n(),f(p,null,{default:D(()=>[h(u,null,{default:D(()=>[h(a,{onCancel:o[0]||(o[0]=y=>e.$emit("hide")),title:e.$t("labels.description"),buttonText:e.$t("labels.close")},null,8,["title","buttonText"]),i("div",Ft,[i("p",{class:"text-par-s text-lab-pr markdown-text",innerHTML:e.$mdInline(e.storyContent)},null,8,Rt)])]),_:1})]),_:1})}const Et=_(jt,[["render",Ut]]),Gt=v({setup:function(){const e=P({isShareModalOpen:!1,isContentModalOpen:!1,isViewsModalOpen:!1}),o=()=>{e.isShareModalOpen=!0,m.emit("story:pause")},s=()=>{e.isContentModalOpen=!0,m.emit("story:pause")},t=()=>{e.isViewsModalOpen=!0,m.emit("story:pause")};return V(()=>{m.on("story:share",o),m.on("story:show-content",s),m.on("story:show-views",t)}),A(()=>{m.off("story:share",o),m.off("story:show-content",s),m.off("story:show-views",t)}),{state:e,handleStoryShareCancel:()=>{m.emit("story:play"),e.isShareModalOpen=!1},handleHideContent:()=>{e.isContentModalOpen=!1,m.emit("story:play")},handleHideViews:()=>{e.isViewsModalOpen=!1,m.emit("story:play")}}},components:{StoryViewsModal:Ot,StoryShareModal:Nt,StoryContentModal:Et}});function Qt(e,o,s,t,d,c){const a=r("StoryShareModal"),u=r("StoryContentModal"),p=r("StoryViewsModal");return n(),l(M,null,[e.state.isShareModalOpen?(n(),f(a,{key:0,onCancel:e.handleStoryShareCancel},null,8,["onCancel"])):S("",!0),e.state.isContentModalOpen?(n(),f(u,{key:1,onHide:e.handleHideContent},null,8,["onHide"])):S("",!0),e.state.isViewsModalOpen?(n(),f(p,{key:2,onHide:e.handleHideViews},null,8,["onHide"])):S("",!0)],64)}const Zt=_(Gt,[["render",Qt]]),Jt=v({props:{directionBack:!1}}),Kt={class:"inline-block size-6 rounded-full bg-white/70 hover:bg-white/90 shadow-md pl-0.5 transition-all"};function Wt(e,o,s,t,d,c){const a=r("SvgIcon");return n(),l("button",Kt,[h(a,{name:e.directionBack?"chevron-left":"chevron-right",classes:"size-5 text-black/70"},null,8,["name"])])}const Xt=_(Jt,[["render",Wt]]),Yt=v({props:{storyItem:{type:Object,required:!0}},emits:["finish","view"],setup:function(e,o){const s=C(e.storyItem),t=P({isInitialized:!1,frameIndex:0,frameData:null,isPaused:!1,startTime:null,storyAuthor:s.value.relations.user,permissions:s.value.permissions,isOwner:s.value.meta.is_owner,animationFrameId:null});F("playerState",t),F("storyUrl",s.value.url),V(()=>{s.value.relations.frames=s.value.relations.frames.map(k=>(k.playable={playing:!1,played:!1,progress:0,leftDuration:0,duration:k.duration_seconds},k)),t.frameData=s.value.relations.frames[0],t.frameData.playable.playing=!0,t.isInitialized=!0,m.on("story:play",g),m.on("story:pause",$),d()}),R(()=>{y()}),A(()=>{m.off("story:play",g),m.off("story:pause",$)});const d=()=>{t.isOwner||o.emit("view",t.frameData.id)},c=()=>{$(),t.frameData.playable={playing:!1,played:!1,progress:0,leftDuration:0,duration:t.frameData.duration_seconds},t.frameIndex-=1,t.frameData=s.value.relations.frames[t.frameIndex],t.frameData.playable={playing:!0,played:!1,progress:0,leftDuration:0,duration:t.frameData.duration_seconds}},a=()=>{$(),t.frameData.playable={playing:!1,played:!0,progress:0,leftDuration:0,duration:t.frameData.duration_seconds},t.frameIndex+=1,t.frameData=s.value.relations.frames[t.frameIndex],t.frameData.playable.playing=!0,d()},u=()=>{t.frameIndex<s.value.relations.frames.length-1?a():($(),o.emit("finish"))},p=()=>{let k=t.frameData.playable.duration;t.frameData.playable.leftDuration>0?t.startTime=Date.now()-(k-t.frameData.playable.leftDuration)*1e3:t.startTime=Date.now();const T=()=>{if(t.isPaused)return y(),!1;const B=(Date.now()-t.startTime)/1e3;if(t.frameData.playable.leftDuration=k-B,t.frameData.playable.progress=Math.min(B/k*100,100),B<k){if(t.isPaused)return y(),!1;requestAnimationFrame(T)}else return $(),y(),u(),!1};t.animationFrameId=requestAnimationFrame(T)},y=()=>{cancelAnimationFrame(t.animationFrameId),t.animationFrameId=null},g=()=>{t.isPaused=!1,p()},$=()=>{t.isPaused=!0};return{storyData:s,playerState:t,showNextItem:a,showPrevItem:c,pauseStory:$,playStory:g,hasNextItems:w(()=>t.frameIndex<s.value.relations.frames.length-1),isVideo:w(()=>t.frameData.type=="video"),hasPrevItems:w(()=>t.frameIndex>0)}},components:{StoryPlayback:Ze,StoryHeader:rt,StoryVideo:ve,StoryImage:ke,StoryViews:Te,StoryContent:Oe,StoryReply:Fe,StorySliderButton:Xt,StoryModals:Zt}}),eo={class:"w-full h-full items-center overflow-hidden relative"},to={class:"absolute top-0 left-0 right-0 z-10 text-white pt-2 px-3 pb-6 from-black/60 to-transparent bg-gradient-to-b"},oo={class:"absolute left-3 z-10 top-half"},no={class:"absolute right-3 z-10 top-half"},so={key:1,class:"absolute bottom-0 left-0 right-0 z-10 text-white pt-8 pb-3 from-black/60 to-transparent bg-gradient-to-t"};function ao(e,o,s,t,d,c){const a=r("StoryPlayback"),u=r("StoryHeader"),p=r("StorySliderButton"),y=r("StoryVideo"),g=r("StoryImage"),$=r("StoryContent"),k=r("StoryViews"),T=r("StoryReply"),B=r("StoryModals");return n(),l("div",eo,[i("div",to,[e.playerState.isInitialized?(n(),l(M,{key:0},[h(a,{storyData:e.storyData},null,8,["storyData"]),h(u,{onPlay:e.playStory,onPause:e.pauseStory},null,8,["onPlay","onPause"])],64)):S("",!0)]),i("div",oo,[e.hasPrevItems?(n(),f(p,{key:0,onClick:e.showPrevItem,directionBack:!0},null,8,["onClick"])):S("",!0)]),i("div",no,[e.hasNextItems?(n(),f(p,{key:0,onClick:e.showNextItem},null,8,["onClick"])):S("",!0)]),e.playerState.isInitialized?(n(),l(M,{key:0},[e.isVideo?(n(),f(y,{frameData:e.playerState.frameData,key:e.playerState.frameData.id},null,8,["frameData"])):(n(),f(g,{frameData:e.playerState.frameData,key:e.playerState.frameData.id},null,8,["frameData"]))],64)):S("",!0),e.playerState.isInitialized?(n(),l("div",so,[h($),e.playerState.isOwner?(n(),f(k,{key:0})):(n(),f(T,{key:1}))])):S("",!0),e.playerState.isInitialized?(n(),f(B,{key:2})):S("",!0)])}const ro=_(Yt,[["render",ao]]),io=v({props:{storyItem:{type:Object,required:!0}},setup:function(e){return{storyAuthor:w(()=>e.storyItem.relations.user),storyTime:w(()=>e.storyItem.relations.frames[0].date.time_ago)}}}),lo={class:"h-full w-full flex items-center relative overflow-hidden opacity-20 border border-[#444444] cursor-pointer hover:opacity-100 bg-center bg-no-repeat bg-cover transition-all"},co={class:"flex flex-col items-center w-full z-10"},uo={class:"size-24 rounded-full bg-purple-50 mb-2 overflow-hidden"},po=["src"],mo={class:"text-par-l text-white font-medium"},yo={class:"text-par-s text-white/80 font-medium"};function fo(e,o,s,t,d,c){return n(),l("div",lo,[o[0]||(o[0]=i("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-xs"},null,-1)),i("div",co,[i("div",uo,[i("img",{src:e.storyAuthor.avatar_url,alt:"Avatar"},null,8,po)]),i("h4",mo,b(e.storyAuthor.name),1),i("p",yo,b(e.storyTime),1)])])}const ho=_(io,[["render",fo]]);se();const _o=v({props:{story_uuid:{type:String,required:!0}},setup:function(e){const o=Q(),s=U(),t=C(0),d=w(()=>o.stories);var c;const a=w(()=>d.value[t.value]),u=async y=>{await o.deleteStory(a.value.story_uuid,y),d.value.length||p()};V(async()=>{try{await o.fetchStory(e.story_uuid)}catch(y){alert(y.message)}c=document.querySelector("swiper-container"),Object.assign(c,{slidesPerView:"auto",centeredSlides:!0,spaceBetween:8,allowTouchMove:!1,effect:!1,speed:600,keyboard:{enabled:!0,onlyInViewport:!0}}),m.on("story:delete",u),c.initialize()}),A(()=>{m.off("story:delete",u)});const p=()=>{s.push({name:"home_index"})};return{stories:d,currentStory:a,activeSlideIndex:t,handleStoryView:y=>{const g=a.value.relations.frames.find($=>$.id===y);g&&g.activity.is_seen===!1&&o.recordStoryView(a.value.story_uuid,y)},handleSlideChange:y=>{t.value=y.target.swiper.activeIndex,s.replace({name:"stories_index",params:{story_uuid:a.value.story_uuid}})},slideToStory:y=>{c.swiper.slideTo(y)},closeStories:p,handleStoryFinish:()=>{t.value<d.value.length-1?c.swiper.slideNext():p()}}},components:{StoryPlayer:ro,StoryCard:ho}}),So={class:"inset-0 bg-[#101214] z-50 fixed py-14 2xl:py-24 overflow-y-auto"},vo={key:0,class:"fixed top-4 left-4 2xl:top-8 2xl:left-8 text-par-m text-white opacity-80"},$o={class:"opacity-50"},wo=["onClick"];function go(e,o,s,t,d,c){const a=r("StoryPlayer"),u=r("StoryCard");return n(),l("div",So,[e.currentStory?(n(),l("span",vo,[O(b(e.currentStory.relations.user.name)+" ",1),i("span",$o,"("+b(e.currentStory.relations.frames.length)+")",1)])):S("",!0),i("button",{onClick:o[0]||(o[0]=(...p)=>e.closeStories&&e.closeStories(...p)),class:"fixed top-4 right-4 2xl:top-8 2xl:right-8 text-par-m text-white opacity-60 hover:opacity-100"},b(e.$t("labels.close")),1),i("swiper-container",{onSwiperslidechange:o[1]||(o[1]=(...p)=>e.handleSlideChange&&e.handleSlideChange(...p)),init:"false"},[(n(!0),l(M,null,z(e.stories,(p,y)=>(n(),l("swiper-slide",{onClick:g=>e.slideToStory(y),class:"w-[360px] h-[640px] 2xl:w-[400px] 2xl:h-[712px] shadow-xl",key:p.story_uuid},[e.activeSlideIndex==y?(n(),f(a,{storyItem:p,onView:e.handleStoryView,key:`${p.story_uuid}-${p.relations.frames.length}`,onFinish:e.handleStoryFinish},null,8,["storyItem","onView","onFinish"])):(n(),f(u,{key:1,storyItem:p},null,8,["storyItem"]))],8,wo))),128))],32)])}const Oo=_(_o,[["render",go]]);export{Oo as default};
