import{k as B,l as b,_ as $,d as D,r as n,e as c,o as e,w as m,j as u,c as a,a as i,m as f,p as P,t as C,F as h,i as w,g as I,b as L,h as R,G as x,B as M}from"./global.properties-ieI6Xwik.js";import{u as N}from"./index-Dl0ZWYHh.js";import{u as E}from"./index-DABlbPqL.js";import{T as V}from"./TimelineContainer-Cj8RYrtQ.js";import{T as q}from"./TimelinePublication-CYGP9Mfq.js";import{T as j}from"./TimelinePublicationSkeleton-BlliYZGM.js";import{C as z}from"./TabsItem-BjTkiLQH.js";import{T as G}from"./TabsLink-BILPIXUq.js";import{a as H,F as J}from"./FeedUpdate-CZH1Bkk9.js";import{A as K}from"./AdCard-eGzQ-765.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./application-B35z453N.js";import"./swiper-element-bundle-DBu82uhE.js";import"./AvatarRightSided-DIsCtZes.js";import"./index-DyH4rDzV.js";import"./mention.plugin-6T_AP_1M.js";import"./index-CZvQntMR.js";import"./ProgressiveImageLoader-DUluSfqC.js";import"./SpinnerIcon-D3U9frcO.js";import"./media.status-D6lx-p4W.js";import"./index-Dun6B87D.js";import"./VideoDurationTime-CY2-hNg2.js";import"./GiphyAttribution-Cv2rUDbj.js";import"./DropdownButton-b5Hfnztp.js";import"./LinkSnapshot-CKRJS_OO.js";import"./LinkSnapshot-D9dLwJZT.js";import"./ViewsCounter-7KyRmWQv.js";import"./AvatarExtraSmall-Cf0UikId.js";import"./SheetTitle-Cb1vf6Xi.js";import"./TimelineEmptyState-D2cMbIuH.js";import"./index-CaocF3Et.js";import"./PeopleListItem-q67tTG6c.js";const O=B("mobile_explore_posts_store",{deleteAware:!0,state:function(){return{updateAttempts:0,posts:[],update:[],filter:{page:1}}},actions:{updateFeed:async function(){await b().explore().params({filter:{onset:this.posts.at(0).id}}).sendTo("posts").then(t=>{this.update=t.data.data}).catch(t=>{t.response&&(state.update=[])})},applyUpdate:function(){this.update.forEach(t=>{this.posts.slice(0,this.update.length).some(r=>r.id===t.id)||this.posts.unshift(t)}),this.update=[]},makeLoadRequest:async function(){return await b().explore().with({filter:this.filter}).sendTo("posts")},fetchPosts:async function(){await this.makeLoadRequest().then(t=>{this.posts=t.data.data})},loadMorePosts:async function(){return await this.makeLoadRequest().then(t=>{let o=t.data.data;return o.length?(this.posts=this.posts.concat(o),!0):!1}).catch(()=>!1)},getLastPostId:function(){return this.posts.at(-1).id},resetFilter:function(){this.filter={page:1}}}}),Q=D({setup:function(){const t=I({isLoading:!0,isLoadingContent:!1,noMoreContent:!1,isUpdating:!1});let o=null,r=0;const{postDeleter:T}=E(),s=O(),_=L(()=>s.update),l=L(()=>s.posts);return N({callback:async()=>{!t.isLoadingContent&&!t.noMoreContent&&(t.isLoadingContent=!0,s.filter.page+=1,t.noMoreContent=!await s.loadMorePosts(),t.isLoadingContent=!1)}}),R(async()=>{t.isLoading=!0,s.resetFilter(),await s.fetchPosts(),t.isLoading=!1,l.value.length&&(o=setInterval(async()=>{t.isUpdating||(_.value.length==0&&r>10?clearInterval(o):(t.isUpdating=!0,await s.updateFeed(),t.isUpdating=!1,r++))},60*1e3*10))}),x(()=>{o&&clearInterval(o)}),{state:t,posts:l,newPosts:_,applyNewPosts:()=>{s.applyUpdate()},handlePostDelete:k=>{T(k,y=>{M.emit("timeline:post-deleted",y),toastSuccess(__t("toast.media.post_deleted"))})}}},components:{TimelineContainer:V,TimelinePublication:q,TimelinePublicationSkeleton:j,ContentTabs:z,TabsLink:G,FeedUpdate:J,AdCard:K,FollowRecommendation:H}}),W={class:"sticky top-0 popup-background-tr z-10"},X={key:1},Y={key:0},Z={key:1,class:"py-32"},tt={class:"text-lab-sc text-par-s text-center"},et={key:2};function ot(t,o,r,T,s,_){const l=n("TabsLink"),k=n("ContentTabs"),y=n("FeedUpdate"),g=n("Border"),v=n("TimelinePublicationSkeleton"),F=n("TimelinePublication"),U=n("FollowRecommendation"),S=n("AdCard"),A=n("TimelineContainer");return e(),c(A,null,{default:m(()=>[u("div",W,[i(k,{cols:2},{default:m(()=>[i(l,{link:{name:"explore_posts"}},{default:m(()=>[P(C(t.$t("labels.explore")),1)]),_:1}),i(l,{link:{name:"explore_people"}},{default:m(()=>[P(C(t.$t("labels.people")),1)]),_:1})]),_:1}),t.newPosts.length?(e(),c(y,{key:0,posts:t.newPosts,onClick:t.applyNewPosts},null,8,["posts","onClick"])):f("",!0),i(g)]),t.state.isLoading?(e(),a(h,{key:0},w(15,p=>i(v,{key:p})),64)):(e(),a("div",X,[t.posts.length?(e(),a("div",Y,[(e(!0),a(h,null,w(t.posts,(p,d)=>(e(),a(h,{key:p.id},[i(F,{postData:p,onDelete:st=>t.handlePostDelete(p)},null,8,["postData","onDelete"]),(d+1)%35===0?(e(),c(U,{key:d})):f("",!0),(d+1)%10===0?(e(),a(h,{key:1},[(e(),c(S,{key:d})),i(g,{height:"h-2",opacity:"opacity-30"})],64)):f("",!0)],64))),128))])):(e(),a("div",Z,[u("p",tt,C(t.$t("empty_state.empty")),1)])),t.state.isLoadingContent?(e(),a("div",et,[i(g),o[0]||(o[0]=u("div",{class:"flex justify-center my-4"},[u("div",{class:"colibri-primary-animation"})],-1))])):f("",!0)]))]),_:1})}const xt=$(Q,[["render",ot]]);export{xt as default};
